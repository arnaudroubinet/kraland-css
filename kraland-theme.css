/* ============================================================================
   1. CSS VARIABLES
   ============================================================================ */

:root {
  --kr-primary: #8b0f0e;
  --kr-primary-dark: #700b09;
  --kr-gold: #C69100;
  --kr-highlight: #c41e3a;
  --kr-highlight-reverse: #f9d9de;
  --kr-surface: #fff;
  --kr-text: #0f1724;
  --kr-muted: #6b7280;
  --kr-navbar-bg: #111315;
  --kr-radius: .5rem;
  --kr-avatar-size: 120px;

  /* Variables pour le dark mode */
  --kr-bg-page: #f5f5f5;
  --kr-bg-surface: #fff;
  --kr-bg-elevated: #fff;
  --kr-bg-hover: rgb(0,0,0,0.02);
  --kr-bg-active: rgb(0,0,0,0.05);
  --kr-text-primary: #0f1724;
  --kr-text-secondary: #6b7280;
  --kr-text-muted: #9ca3af;
  --kr-text-inverse: #fff;
  --kr-border-default: rgb(0,0,0,0.08);
  --kr-border-strong: rgb(0,0,0,0.15);
  --kr-shadow-sm: 0 1px 2px rgb(0,0,0,0.05);
  --kr-shadow-md: 0 4px 6px rgb(0,0,0,0.07);
  --kr-shadow-lg: 0 10px 15px rgb(0,0,0,0.1);

  /* Couleurs spécifiques */
  --kr-white: #fff;
  --kr-focus-ring: rgb(164,18,13,0.22);
  --kr-focus-ring-light: rgb(164,18,13,0.18);
  --kr-alert-info-bg: rgb(164,18,13,0.06);
  --kr-alert-info-border: rgb(164,18,13,0.14);
  --kr-btn-shadow: rgb(165,18,13,0.12);
  --kr-badge-danger: #dc3545;
  --kr-badge-danger-border: #bd2130;
  --kr-badge-pnj: #d9534f;
  --kr-bootstrap-blue: #337ab7;
  
  /* Couleurs nations (.f1-.f9) */
  --kr-nation-1: #C41E3A;
  --kr-nation-2: #C69100;
  --kr-nation-3: #FF0;
  --kr-nation-4: #0033A0;
  --kr-nation-5: #0B6623;
  --kr-nation-6: #6A0DAD;
  --kr-nation-7: #6B7280;
  --kr-nation-8: #0A6B2D;
  --kr-nation-9: #a70;
  
  /* Couleurs nations fonds (.c1-.c12) - reproduit depuis la feuille de style principale */
  --kr-nation-bg-1: rgb(255, 128, 128);
  --kr-nation-bg-2: rgb(170, 112, 0);
  --kr-nation-bg-3: rgb(255, 255, 128);
  --kr-nation-bg-4: rgb(128, 128, 255);
  --kr-nation-bg-5: rgb(128, 255, 128);
  --kr-nation-bg-6: rgb(204, 128, 255);
  --kr-nation-bg-7: rgb(170, 170, 170);
  --kr-nation-bg-8: rgb(115, 151, 115);
  --kr-nation-bg-9: rgb(170, 170, 68);
  --kr-nation-bg-10: rgb(204, 255, 255);

  /* CLASSES KRALAND - Fonds nations (.c1-.c12) */
  .c1  { background-color: var(--kr-nation-bg-1) !important; }
  .c2  { background-color: var(--kr-nation-bg-2) !important; }
  .c3  { background-color: var(--kr-nation-bg-3) !important; }
  .c4  { background-color: var(--kr-nation-bg-4) !important; }
  .c5  { background-color: var(--kr-nation-bg-5) !important; }
  .c6  { background-color: var(--kr-nation-bg-6) !important; }
  .c7  { background-color: var(--kr-nation-bg-7) !important; }
  .c8  { background-color: var(--kr-nation-bg-8) !important; }
  .c9  { background-color: var(--kr-nation-bg-9) !important; }
  .c10 { background-color: var(--kr-nation-bg-10) !important; }
  /* Forcer texte noir sur les labels nationaux (lisibilité) */
  .mini.c1, .mini.c2, .mini.c3, .mini.c4, .mini.c5, .mini.c6, .mini.c7, .mini.c8, .mini.c9, .mini.c10 {
    color: #000 !important;
    text-shadow: none !important;
  }

  
  /* ============================================
     MOBILE ADAPTATION - VARIABLES (TASK-1.1)
     ============================================ */

  /* Hauteurs fixes mobile */
  --mobile-header-height: 56px;
  --mobile-tab-bar-height: 48px;
  --mobile-touch-target: 44px;
  
  /* Espacements */
  --mobile-spacing-xs: 4px;
  --mobile-spacing-sm: 8px;
  --mobile-spacing-md: 12px;
  --mobile-spacing-lg: 16px;
  --mobile-spacing-xl: 24px;
  
  /* Bordures */
  --mobile-radius: 8px;
  --mobile-radius-lg: 16px;
  
  /* Z-index */
  --z-header: 1000;
  --z-tab-bar: 999;
  --z-bottom-sheet: 998;
  --z-drawer: 1001;
  
  /* Transitions */
  --transition-fast: 0.15s ease;
  --transition-normal: 0.3s ease;
  --transition-slow: 0.5s ease;
  
  /* Couleurs des jauges (Bootstrap success/info/warning) */
  --kr-gauge-pv: #28a745; /* Vert Bootstrap success */
  --kr-gauge-pm: #007bff; /* Bleu Bootstrap info */
  --kr-gauge-pp: #ffc107; /* Jaune Bootstrap warning */
  
  /* Overlays et transparence pour navbar sombre */
  --kr-overlay-light-10: rgba(255, 255, 255, 0.1);
  --kr-overlay-light-05: rgba(255, 255, 255, 0.05);
  --kr-overlay-light-20: rgba(255, 255, 255, 0.2);
  --kr-overlay-dark-20: rgba(0, 0, 0, 0.2);
  --kr-overlay-dark-30: rgba(0, 0, 0, 0.3);
  --kr-overlay-dark-125: rgba(0, 0, 0, 0.125);
}

html.kr-theme-variant-empire-brun {
  --kr-primary: #5E3B2D;
  --kr-highlight: #C69100;
}

html.kr-theme-variant-paladium {
  --kr-primary: #D4AF37; 
  --kr-highlight: #044c17; 
}

html.kr-theme-variant-theocratie-seelienne {
  --kr-primary: #0033A0;
  --kr-highlight: #2d5fcb;
}

html.kr-theme-variant-paradigme-vert {
  --kr-primary: #0B6623;
  --kr-highlight: #063803;
}

html.kr-theme-variant-khanat-elmerien {
  --kr-primary: #6A0DAD;
  --kr-highlight: #7b4c9c;
}

html.kr-theme-variant-confederation-libre {
  --kr-primary: #6B7280;
  --kr-highlight: #475369;
}

html.kr-theme-variant-royaume-ruthvenie {
  --kr-primary: #0A6B2D;
  --kr-highlight: #C41E3A; 
}

html.kr-theme-variant-empire-brun-dark {
  --kr-primary: #7a5240;
  --kr-primary-dark: #5E3B2D;
  --kr-highlight: #d4a574;
  --kr-highlight-reverse: #1a0f0a;

  /* Dark mode surfaces */
  --kr-bg-page: #12100d;
  --kr-bg-surface: #1e1a15;
  --kr-bg-elevated: #2a251f;
  --kr-bg-hover: rgba(255, 255, 255, 0.03);
  --kr-bg-active: rgba(255, 255, 255, 0.06);

  /* Color scheme */
  color-scheme: dark;

  /* Dark mode texte */
  --kr-text-primary: #f5f1ed;
  --kr-text-secondary: #b8a997;
  --kr-text-muted: #8a7968;
  --kr-text-inverse: #12100d;

  /* Dark mode bordures */
  --kr-border-default: rgb(255,255,255,0.08);
  --kr-border-strong: rgb(255,255,255,0.15);

  /* Dark mode ombres */
  --kr-shadow-sm: 0 1px 3px rgb(0,0,0,0.4);
  --kr-shadow-md: 0 4px 8px rgb(0,0,0,0.5);
  --kr-shadow-lg: 0 10px 20px rgb(0,0,0,0.6);
  
  /* Dark mode form controls */
  --kr-form-bg: #3a332b;
  --kr-form-bg-focus: #423a31;
  
  /* Couleurs nations mode sombre (.f1-.f9) */
  --kr-nation-1: #ff8080;
  --kr-nation-2: #d4a574;
  --kr-nation-3: #ffe066;
  --kr-nation-4: #74b9ff;
  --kr-nation-5: #55efc4;
  --kr-nation-6: #a29bfe;
  --kr-nation-7: #b2bec3;
  --kr-nation-8: #81c784;
  --kr-nation-9: #c4b958;
}

html.kr-theme-variant-paladium-dark {
  --kr-primary: #e6c76e;
  --kr-primary-dark: #D4AF37;
  --kr-highlight: #4a9d5f;
  --kr-highlight-reverse: #021a0a;

  /* Dark mode surfaces */
  --kr-bg-page: #0f0e0a;
  --kr-bg-surface: #1a1810;
  --kr-bg-elevated: #252015;
  --kr-bg-hover: rgba(255, 255, 255, 0.03);
  --kr-bg-active: rgba(255, 255, 255, 0.06);

  /* Color scheme */
  color-scheme: dark;

  /* Dark mode texte */
  --kr-text-primary: #f5f3e8;
  --kr-text-secondary: #c4b896;
  --kr-text-muted: #938567;
  --kr-text-inverse: #0f0e0a;

  /* Dark mode bordures */
  --kr-border-default: rgb(255,255,255,0.08);
  --kr-border-strong: rgb(255,255,255,0.15);

  /* Dark mode ombres */
  --kr-shadow-sm: 0 1px 3px rgb(0,0,0,0.4);
  --kr-shadow-md: 0 4px 8px rgb(0,0,0,0.5);
  --kr-shadow-lg: 0 10px 20px rgb(0,0,0,0.6);
  
  /* Dark mode form controls */
  --kr-form-bg: #3a3420;
  --kr-form-bg-focus: #43392a;
  
  /* Couleurs nations mode sombre (.f1-.f9) */
  --kr-nation-1: #ff8080;
  --kr-nation-2: #e6c76e;
  --kr-nation-3: #ffe066;
  --kr-nation-4: #74b9ff;
  --kr-nation-5: #55efc4;
  --kr-nation-6: #a29bfe;
  --kr-nation-7: #b2bec3;
  --kr-nation-8: #81c784;
  --kr-nation-9: #c4b958;
}

html.kr-theme-variant-theocratie-seelienne-dark {
  --kr-primary: #5a8fd9;
  --kr-primary-dark: #2d5fcb;
  --kr-highlight: #80b3ff;
  --kr-highlight-reverse: #000d1f;

  /* Dark mode surfaces */
  --kr-bg-page: #0a0e15;
  --kr-bg-surface: #12182a;
  --kr-bg-elevated: #1a2438;
  --kr-bg-hover: rgba(255, 255, 255, 0.03);
  --kr-bg-active: rgba(255, 255, 255, 0.06);

  /* Color scheme */
  color-scheme: dark;

  /* Dark mode texte */
  --kr-text-primary: #e8f0ff;
  --kr-text-secondary: #9db5d6;
  --kr-text-muted: #6b7f9e;
  --kr-text-inverse: #0a0e15;

  /* Dark mode bordures */
  --kr-border-default: rgb(255,255,255,0.08);
  --kr-border-strong: rgb(255,255,255,0.15);

  /* Dark mode ombres */
  --kr-shadow-sm: 0 1px 3px rgb(0,0,0,0.4);
  --kr-shadow-md: 0 4px 8px rgb(0,0,0,0.5);
  --kr-shadow-lg: 0 10px 20px rgb(0,0,0,0.6);
  
  /* Dark mode form controls */
  --kr-form-bg: #2a3447;
  --kr-form-bg-focus: #323d54;
  
  /* Couleurs nations mode sombre (.f1-.f9) */
  --kr-nation-1: #ff8080;
  --kr-nation-2: #d4a574;
  --kr-nation-3: #ffe066;
  --kr-nation-4: #80b3ff;
  --kr-nation-5: #55efc4;
  --kr-nation-6: #a29bfe;
  --kr-nation-7: #b2bec3;
  --kr-nation-8: #81c784;
  --kr-nation-9: #c4b958;
}

html.kr-theme-variant-paradigme-vert-dark {
  --kr-primary: #4d9c61;
  --kr-primary-dark: #2a7a3d;
  --kr-highlight: #70c784;
  --kr-highlight-reverse: #021508;

  /* Dark mode surfaces */
  --kr-bg-page: #0a120d;
  --kr-bg-surface: #0f1a13;
  --kr-bg-elevated: #1a2820;
  --kr-bg-hover: rgba(255, 255, 255, 0.03);
  --kr-bg-active: rgba(255, 255, 255, 0.06);

  /* Color scheme */
  color-scheme: dark;

  /* Dark mode texte */
  --kr-text-primary: #e8f5ed;
  --kr-text-secondary: #a0c4ab;
  --kr-text-muted: #6d8a75;
  --kr-text-inverse: #0a120d;

  /* Dark mode bordures */
  --kr-border-default: rgb(255,255,255,0.08);
  --kr-border-strong: rgb(255,255,255,0.15);

  /* Dark mode ombres */
  --kr-shadow-sm: 0 1px 3px rgb(0,0,0,0.4);
  --kr-shadow-md: 0 4px 8px rgb(0,0,0,0.5);
  --kr-shadow-lg: 0 10px 20px rgb(0,0,0,0.6);
  
  /* Dark mode form controls */
  --kr-form-bg: #2a3d30;
  --kr-form-bg-focus: #324539;
  
  /* Couleurs nations mode sombre (.f1-.f9) */
  --kr-nation-1: #ff8080;
  --kr-nation-2: #d4a574;
  --kr-nation-3: #ffe066;
  --kr-nation-4: #74b9ff;
  --kr-nation-5: #70c784;
  --kr-nation-6: #a29bfe;
  --kr-nation-7: #b2bec3;
  --kr-nation-8: #81c784;
  --kr-nation-9: #c4b958;
}

html.kr-theme-variant-khanat-elmerien-dark {
  --kr-primary: #96c;
  --kr-primary-dark: #7b4c9c;
  --kr-highlight: #b794d9;
  --kr-highlight-reverse: #1a0425;

  /* Dark mode surfaces */
  --kr-bg-page: #0f0a15;
  --kr-bg-surface: #1a121f;
  --kr-bg-elevated: #251a2d;
  --kr-bg-hover: rgba(255, 255, 255, 0.03);
  --kr-bg-active: rgba(255, 255, 255, 0.06);

  /* Color scheme */
  color-scheme: dark;

  /* Dark mode texte */
  --kr-text-primary: #f0e8ff;
  --kr-text-secondary: #bba0d6;
  --kr-text-muted: #857299;
  --kr-text-inverse: #0f0a15;

  /* Dark mode bordures */
  --kr-border-default: rgb(255,255,255,0.08);
  --kr-border-strong: rgb(255,255,255,0.15);

  /* Dark mode ombres */
  --kr-shadow-sm: 0 1px 3px rgb(0,0,0,0.4);
  --kr-shadow-md: 0 4px 8px rgb(0,0,0,0.5);
  --kr-shadow-lg: 0 10px 20px rgb(0,0,0,0.6);
  
  /* Dark mode form controls */
  --kr-form-bg: #3a2f47;
  --kr-form-bg-focus: #443854;
  
  /* Couleurs nations mode sombre (.f1-.f9) */
  --kr-nation-1: #ff8080;
  --kr-nation-2: #d4a574;
  --kr-nation-3: #ffe066;
  --kr-nation-4: #74b9ff;
  --kr-nation-5: #55efc4;
  --kr-nation-6: #b794d9;
  --kr-nation-7: #b2bec3;
  --kr-nation-8: #81c784;
  --kr-nation-9: #c4b958;
}

html.kr-theme-variant-confederation-libre-dark {
  --kr-primary: #9ca3af;
  --kr-primary-dark: #6b7280;
  --kr-highlight: #c2c9d6;
  --kr-highlight-reverse: #0f1115;

  /* Dark mode surfaces */
  --kr-bg-page: #0e1013;
  --kr-bg-surface: #16181c;
  --kr-bg-elevated: #1f2228;
  --kr-bg-hover: rgba(255, 255, 255, 0.03);
  --kr-bg-active: rgba(255, 255, 255, 0.06);

  /* Color scheme */
  color-scheme: dark;

  /* Dark mode texte */
  --kr-text-primary: #e8eaed;
  --kr-text-secondary: #b8bcc4;
  --kr-text-muted: #7e8591;
  --kr-text-inverse: #0e1013;

  /* Dark mode bordures */
  --kr-border-default: rgb(255,255,255,0.08);
  --kr-border-strong: rgb(255,255,255,0.15);

  /* Dark mode ombres */
  --kr-shadow-sm: 0 1px 3px rgb(0,0,0,0.4);
  --kr-shadow-md: 0 4px 8px rgb(0,0,0,0.5);
  --kr-shadow-lg: 0 10px 20px rgb(0,0,0,0.6);
  
  /* Dark mode form controls */
  --kr-form-bg: #2d3139;
  --kr-form-bg-focus: #363a43;
  
  /* Couleurs nations mode sombre (.f1-.f9) */
  --kr-nation-1: #ff8080;
  --kr-nation-2: #d4a574;
  --kr-nation-3: #ffe066;
  --kr-nation-4: #74b9ff;
  --kr-nation-5: #55efc4;
  --kr-nation-6: #a29bfe;
  --kr-nation-7: #c2c9d6;
  --kr-nation-8: #81c784;
  --kr-nation-9: #c4b958;
}

html.kr-theme-variant-royaume-ruthvenie-dark {
  --kr-primary: #4a9d61;
  --kr-primary-dark: #2a7a3d;
  --kr-highlight: #ff6b85;
  --kr-highlight-reverse: #1a0408;

  /* Dark mode surfaces */
  --kr-bg-page: #0d1210;
  --kr-bg-surface: #141a16;
  --kr-bg-elevated: #1d2621;
  --kr-bg-hover: rgba(255, 255, 255, 0.03);
  --kr-bg-active: rgba(255, 255, 255, 0.06);

  /* Color scheme */
  color-scheme: dark;

  /* Dark mode texte */
  --kr-text-primary: #ecf5f0;
  --kr-text-secondary: #a5c4b0;
  --kr-text-muted: #708a79;
  --kr-text-inverse: #0d1210;

  /* Dark mode bordures */
  --kr-border-default: rgb(255,255,255,0.08);
  --kr-border-strong: rgb(255,255,255,0.15);

  /* Dark mode ombres */
  --kr-shadow-sm: 0 1px 3px rgb(0,0,0,0.4);
  --kr-shadow-md: 0 4px 8px rgb(0,0,0,0.5);
  --kr-shadow-lg: 0 10px 20px rgb(0,0,0,0.6);
  
  /* Dark mode form controls */
  --kr-form-bg: #2d3d33;
  --kr-form-bg-focus: #36463b;
  
  /* Couleurs nations mode sombre (.f1-.f9) */
  --kr-nation-1: #ff8080;
  --kr-nation-2: #d4a574;
  --kr-nation-3: #ffe066;
  --kr-nation-4: #74b9ff;
  --kr-nation-5: #55efc4;
  --kr-nation-6: #a29bfe;
  --kr-nation-7: #b2bec3;
  --kr-nation-8: #70c784;
  --kr-nation-9: #c4b958;
}


/* ============================================================================
   2. LAYOUT OVERRIDES
   ============================================================================ */

/* Hide top header with Kraland logo */
#top {
  display: none !important;
}


html {
  height: auto !important; /* Force HTML à grandir avec le contenu */
}

body {
  min-height: 100vh !important; /* Le body fait au moins la hauteur du viewport pour les pages courtes */
  height: auto !important; /* Laisser le body grandir avec le contenu */
  display: flex;
  flex-direction: column;
  margin: 0 !important; /* Pas de margin pour éviter le décalage de 60px */
  padding-top: 60px; /* Compenser la navigation fixe (60px) */
}

/* La navigation en haut est en position fixed, donc elle sort du flux */
nav.navbar {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 1030 !important; /* Au-dessus du contenu */
  height: auto !important; /* Laisser la hauteur s'adapter au contenu */
  max-height: 60px !important; /* Limiter la hauteur maximale */
}

/* Le contenu principal occupe l'espace disponible */
#content {
  flex: 1 0 auto;
}

footer {
  /* Footer en position normale, collé en bas grâce au flexbox */
  flex-shrink: 0;
  width: 100%;
}

/* Option pour masquer la citation du footer */
html.kr-hide-footer-quote .footer-quote {
  display: none !important;
}

/* Increase container width: remove 150px from each side */
.container {
  max-width: 1608px !important;
  width: 1608px !important;
}



/* Show skills panel (no longer collapsed by default) */
#skills-panel {
  display: block !important;
  border: 1px solid rgb(0, 0, 0, 0.06) !important;
  border-radius: 5px !important;
  background-color: var(--kr-white) !important;
}


/* ============================================================================
   3. NAVIGATION
   ============================================================================ */

/* Navbar brand (logo) alignment */
.navbar-brand {
  display: flex !important;
  align-items: center !important;
  padding-top: 0 !important;
  padding-bottom: 0 !important;
}

.navbar-brand img.kr-logo {
  height: 28px;
  vertical-align: middle;
}

.navbar-nav > li > a{
  color: var(--kr-white) !important;
}


/* ============================================================================
   4. FORMS
   ============================================================================ */

.form-control.form-control {
  border-radius: .4rem;
  border: 1px solid rgb(0,0,0,0.08);
  padding: .6rem .8rem;
  font-size: .95rem;
}

.form-control:focus {
  box-shadow: 0 0 0 .18rem var(--kr-focus-ring);
  border-color: var(--kr-primary);
  outline: none;
}

textarea.form-control.form-control {
  font-size: 1.4rem !important;
  line-height: 1.6 !important;
}

.form-group label {
  color: var(--kr-text);
  font-weight: 600;
}



input[type="checkbox"],
input[type="radio"] {
  accent-color: var(--kr-primary) !important;
}

input[type="checkbox"]:focus,
input[type="radio"]:focus {
  outline: none;
  box-shadow: 0 0 0 .12rem var(--kr-focus-ring-light) !important;
}

input[type="checkbox"]:checked {
  border-color: var(--kr-primary) !important;
}

/* ============================================================================
   5. BADGES, LABELS & ALERTS
   Consolidated color remapping for theme
   ============================================================================ */

/* Badges & labels - info/primary variants use red */
.label,
.badge {
  background-color: var(--kr-primary);
  color: var(--kr-white);
  border-color: var(--kr-primary-dark);
}

.bg-info {
  background-color: var(--kr-primary);
  color: var(--kr-white);
}

/* Badge danger - notification alert always red on all themes */
.badge-danger {
  background-color: var(--kr-badge-danger) !important;
  color: var(--kr-white) !important;
  border-color: var(--kr-badge-danger-border) !important;
}

/* Alerts - info variant */
.alert.alert-info {
  background-color: var(--kr-alert-info-bg);
  border-color: var(--kr-alert-info-border);
  color: var(--kr-text);
}

.alert strong,
.alert p {
  color: var(--kr-text);
}


/* ============================================================================
   6. LIST GROUPS
   ============================================================================ */

.list-group-item {
  border: none;
  padding: .6rem .75rem;
}

.list-group-item.btn {
  border: none !important;
}

.list-group-item.active,
.list-group-item.active:focus,
.list-group-item.active:hover,
.list-group-item.active a {
  background-color: var(--kr-primary) !important;
  border-color: var(--kr-primary-dark) !important;
  color: var(--kr-surface) !important;
}

/* Keep hover for non-active items subtle and themed */
.list-group-item:hover {
  color: var(--kr-primary-dark);
  background-color: rgb(0,0,0,0.02);
}

/* ============================================================================
   7. AVATARS
   Ensure avatars are displayed at least the configured size and crop nicely
   ============================================================================ */
.img-circle {
  width: var(--kr-avatar-size);
  height: var(--kr-avatar-size);
  min-width: var(--kr-avatar-size);
  min-height: var(--kr-avatar-size);
  object-fit: cover;
  display: inline-block;
  border-radius: 50%;
}

/* Fix: Override Bootstrap .img-responsive on avatars to prevent stretching */
.img-circle.img-responsive,
.img-circle.img-thumbnail {
  max-width: none !important;
  width: var(--kr-avatar-size);
  height: var(--kr-avatar-size);
}


/* Ensure layout doesn't break: allow the author column to accommodate larger avatars */
.col-md-3.sidebar .avatar,
.col-md-2.sidebar .avatar {
  margin-bottom: 0.5rem;
}

/* Align list-group user items with their avatar to prevent overflow */
.list-group a.list-group-item.ds_user,
.list-group-item.ds_user {
  position: relative;
  min-height: var(--kr-avatar-size) !important;
  padding-right: calc(var(--kr-avatar-size) + 1rem) !important;
  display: flex !important;
  align-items: center !important;
}

.list-group-item.ds_user .pull-right {
  position: absolute !important;
  right: .75rem !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
}

/* ============================================================================
   7.1 PLAYER HEADER SECTION - FIX BOOTSTRAP GRID
   
   Le HTML utilise des classes .nopadding qui cassent le système de grille Bootstrap.
   On restaure ici les paddings standards pour que les .row et .col- fonctionnent correctement.
   ============================================================================ */

/* Restaurer le padding Bootstrap standard (15px) pour toutes les colonnes dans le header */
#player-header-section .nopadding,
#player-header-section .nopadding-right,
#player-main-panel .nopadding,
#player-main-panel .nopadding-right,
#player-vitals-section .nopadding,
#player-vitals-section .nopadding-right {
  padding-left: 15px !important;
  padding-right: 15px !important;
}

/* Exception : le bouton avatar peut avoir moins de padding pour rester centré */
#player-main-panel > .row > .nopadding:first-child {
  padding-left: 10px !important;
  padding-right: 10px !important;
}

/* Corriger le padding-left inline sur player-vitals-section */
#player-vitals-section[style*="padding-left"] {
  padding-left: 0 !important;
}

/* Structurer correctement player-actions-section qui contient des boutons sans colonnes */
#player-actions-section {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  padding: 0 15px !important;
}

/* Espacement entre les lignes de boutons d'accès rapide */
.kr-quick-access-buttons .col-xs-6 {
  margin-bottom: 10px;
}

#player-actions-section hr {
  width: 100%;
  margin: 0.5rem 0;
}



/* ============================================================================
   8. CAROUSEL
   ============================================================================ */

.carousel-caption {
  background: linear-gradient(180deg, rgb(0,0,0,0.55), rgb(0,0,0,0.35));
  padding: 1.4rem;
  padding-bottom: 56px;
  border-radius: .6rem;
  color: var(--kr-white);
}

.item img[class*="-slide"] {
  display: block;
  margin: 0 auto;
  max-width: 100%;
  height: auto;
}

a.carousel-control.left,
a.carousel-control.right{
   background-image: none;
}


/* ============================================================================
   9. MODALS
   Fix modal overflow - prevent modals from extending beyond viewport
   Allow clicking outside to close
   ============================================================================ */

/* Conteneur modal - empêcher le scroll du conteneur */
.modal {
  display: flex !important;
  position: fixed !important; /* Nécessaire pour que la modal reste par-dessus le contenu */
  align-items: flex-start; /* Évite le scroll automatique */
  justify-content: center;
  overflow-y: hidden !important; /* Pas de scroll sur le conteneur modal */
  pointer-events: auto;
  padding-top: 30px; /* Espacement du haut */
}

.modal.in {
  /* Force le scroll à rester en haut lors de l'ouverture */
  overflow-y: hidden !important;
}

/* Dialog avec contraintes de hauteur et son propre scroll */
.modal-dialog {
  width: 900px;
  max-width: 90vw;
  margin: 0 auto 30px; /* Pas de margin-top car géré par padding du parent */
  max-height: calc(100vh - 60px);
  display: flex;
  flex-direction: column;
  pointer-events: auto;
  overflow-y: auto; /* Le dialog peut scroller si nécessaire */
}

/* Content avec structure flex */
.modal-content {
  display: flex;
  flex-direction: column;
  max-height: 100%;
  overflow: hidden;
}

/* Body scrollable - le contenu peut scroller si trop grand */
.modal-body {
  overflow-y: auto;
  flex: 1 1 auto;
}

/* Header et footer restent fixes et toujours visibles */
.modal-header,
.modal-footer {
  flex-shrink: 0;
}

/* ============================================================================
   9b. BOOTBOX ORDER MODAL - MOBILE UX OPTIMIZATION
   Améliore l'utilisabilité mobile de la modale d'ordre
   - Zones tactiles 44px minimum (WCAG 2.1)
   - Grille responsive pour les actions
   - Footer sticky
   - Prévention zoom iOS (font-size 16px+)
   
   ⚠️ MOBILE ONLY - Ne s'applique QUE sur mobile (<768px)
   ============================================================================ */

@media (width <= 767px) {
  /* 1. SELECT PERSONNAGE */
  .bootbox-confirm .modal-body > select:first-of-type,
  .bootbox-confirm select.form-control {
  min-height: var(--mobile-touch-target);
  font-size: 16px !important; /* Évite zoom iOS */
  padding: 8px 12px;
  margin-bottom: var(--mobile-spacing-lg);
  border-radius: var(--mobile-radius);
}

/* 2. ACTIONS PRIMAIRES/SECONDAIRES EN GRILLE */
.bootbox-confirm .panel-heading ul.nav-tabs {
  display: grid !important; /* Override Bootstrap flex */
  grid-template-columns: repeat(2, 1fr); /* 2 colonnes sur mobile */
  gap: var(--mobile-spacing-md) !important;
  padding-left: 0;
  margin-bottom: var(--mobile-spacing-md);
  border-bottom: none !important; /* Retire la bordure des nav-tabs Bootstrap */
}

.bootbox-confirm .panel-heading ul.nav-tabs > li {
  margin: 0 !important;
  padding: 0;
  display: block;
  float: none !important; /* Override Bootstrap float */
}

.bootbox-confirm .panel-heading ul.nav-tabs > li > a {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: var(--mobile-touch-target);
  padding: 12px 16px;
  text-align: center;
  background: var(--kr-bg-elevated);
  border: 1px solid var(--kr-border-default) !important;
  border-radius: var(--mobile-radius) !important;
  font-weight: 500;
  font-size: 0.95rem;
  text-decoration: none;
  transition: all var(--transition-fast);
  margin: 0 !important; /* Override Bootstrap margin */
}

.bootbox-confirm .panel-heading ul.nav-tabs > li.active > a {
  background: var(--kr-primary);
  color: white;
  border-color: var(--kr-primary) !important;
}

.bootbox-confirm .panel-heading ul.nav-tabs > li > a:hover,
.bootbox-confirm .panel-heading ul.nav-tabs > li > a:focus {
  background: var(--kr-bg-hover);
  text-decoration: none;
  transform: translateY(-1px);
  box-shadow: var(--kr-shadow-sm);
  border-color: var(--kr-primary) !important;
}

.bootbox-confirm .panel-heading ul.nav-tabs > li > a:active {
  transform: translateY(0);
  background: var(--kr-bg-active);
}

/* Icônes dans les actions (si présentes) */
.bootbox-confirm .list-inline > li > a > .fa,
.bootbox-confirm .list-inline > li > a > .glyphicon {
  margin-right: 6px;
  font-size: 1.1em;
}

/* 3. TABLEAU RADIO BUTTONS */

/* 3. PANEL ACTIONS - Layout Grid Compact */
.bootbox-confirm .panel-actions {
  padding: var(--mobile-spacing-md);
  background: var(--kr-bg-surface);
  border-radius: var(--mobile-radius);
}

/* Headers "Actions / Diff. / Jet" */
.bootbox-confirm .panel-actions::before {
  content: "Actions";
  display: block;
  font-weight: 600;
  font-size: 0.8125rem;
  color: var(--kr-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: var(--mobile-spacing-sm);
  padding-bottom: var(--mobile-spacing-sm);
  border-bottom: 1px solid var(--kr-border-default);
}

/* ACTIONS GRID - Layout compact à 4 colonnes */
.bootbox-confirm .panel-actions .row.form-group {
  display: grid !important;
  grid-template-columns: 44px 1fr 60px 70px;
  gap: 0;
  padding: 0 !important;
  margin: 0 0 2px !important;
  background: rgba(255, 255, 255, 0.02);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 4px;
  overflow: hidden;
  transition: all 0.2s ease;
}

/* Hover sur row */
.bootbox-confirm .panel-actions .row.form-group:hover {
  background: rgba(212, 165, 116, 0.05);
  border-color: rgba(212, 165, 116, 0.3);
  transform: translateX(2px);
}

/* Row checked - highlight fort */
.bootbox-confirm .panel-actions .row.form-group:has(input[type="radio"]:checked) {
  background: rgba(212, 165, 116, 0.12);
  border-color: var(--kr-primary);
  box-shadow: 0 0 0 1px rgba(212, 165, 116, 0.2);
}

/* Cellules du grid */
.bootbox-confirm .panel-actions .row.form-group > div {
  padding: 8px 6px !important;
  margin: 0 !important;
  display: flex !important;
  align-items: center;
  min-height: 44px;
  border-right: 1px solid rgba(255, 255, 255, 0.05);
}

.bootbox-confirm .panel-actions .row.form-group > div:last-child {
  border-right: none;
}

/* Colonne 1 : Radio button (centré) */
.bootbox-confirm .panel-actions .row.form-group > div:nth-child(1) {
  justify-content: center;
  background: rgba(0, 0, 0, 0.1);
}

/* Colonne 2 : Label (aligné à gauche) */
.bootbox-confirm .panel-actions .row.form-group > div:nth-child(2) {
  padding-left: 12px !important;
}

/* Colonnes 3 & 4 : Diff et Jet (alignés à droite, font compact) */
.bootbox-confirm .panel-actions .row.form-group > div:nth-child(3),
.bootbox-confirm .panel-actions .row.form-group > div:nth-child(4) {
  justify-content: center;
  font-weight: 600;
  font-size: 0.875rem;
  color: var(--kr-text-secondary);
  background: rgba(0, 0, 0, 0.15);
}

/* Radio buttons - Style custom */
.bootbox-confirm .panel-actions input[type="radio"] {
  width: 20px !important;
  height: 20px !important;
  min-width: 20px !important;
  min-height: 20px !important;
  cursor: pointer;
  accent-color: var(--kr-primary);
  margin: 0 !important;
  flex-shrink: 0;
}

/* Labels - Style clickable */
.bootbox-confirm .panel-actions label {
  cursor: pointer;
  margin: 0 !important;
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--kr-text-primary);
  transition: color 0.2s ease;
  user-select: none;
}

.bootbox-confirm .panel-actions label:hover {
  color: var(--kr-primary);
}

/* TABLE OBJETS - Style normal conservé */
.bootbox-confirm table {
  width: 100%;
  margin-bottom: var(--mobile-spacing-lg);
  border-collapse: separate;
  border-spacing: 0;
}

.bootbox-confirm table td,
.bootbox-confirm table th {
  padding: 12px 8px;
  vertical-align: middle;
  border-bottom: 1px solid var(--kr-border-default);
}

.bootbox-confirm table th {
  font-weight: 600;
  font-size: 0.875rem;
  color: var(--kr-text-secondary);
  background: var(--kr-bg-elevated);
}

/* 4. CHECKBOXES & BONUS - Ligne horizontale unifiée */
.bootbox-confirm input[type="checkbox"] {
  width: 20px;
  height: 20px;
  min-width: 20px;
  min-height: 20px;
  cursor: pointer;
  accent-color: var(--kr-primary);
  margin: 0;
}

/* Groupes de formulaire en ligne */
.bootbox-confirm .form-group:has(input[type="checkbox"]),
.bootbox-confirm .form-group:has(select[name="bonus"]) {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  min-height: 44px;
  width: auto;
  margin-right: var(--mobile-spacing-md);
  margin-bottom: var(--mobile-spacing-md);
}

.bootbox-confirm .modal-body label {
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  min-height: 44px;
  margin-bottom: 0;
  padding: 10px 0;
}

/* Select Bonus optimisé */
.bootbox-confirm select[name="bonus"] {
  min-height: 44px;
  padding: 10px 12px;
  font-size: 0.9375rem;
  border: 1px solid var(--kr-border-default);
  border-radius: 8px;
  background: var(--kr-bg-surface);
  color: var(--kr-text-primary);
  cursor: pointer;
}

.bootbox-confirm .form-group {
  margin-bottom: var(--mobile-spacing-lg);
}

/* 5. TOOLBAR BBCODE */
.bootbox-confirm .btn-toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: var(--mobile-spacing-md);
}

.bootbox-confirm .btn-toolbar .btn-group {
  margin-right: 0;
  margin-bottom: 4px;
}

.bootbox-confirm .btn-toolbar .btn {
  min-height: var(--mobile-touch-target);
  min-width: var(--mobile-touch-target);
  padding: 8px 12px;
  border-radius: 6px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.bootbox-confirm .btn-toolbar .btn:hover {
  background: var(--kr-bg-hover);
  border-color: var(--kr-primary);
}

/* 6. TEXTAREA MESSAGE */
.bootbox-confirm textarea.form-control {
  min-height: 120px;
  font-size: 16px !important; /* Évite zoom iOS */
  line-height: 1.5;
  resize: vertical;
}

/* ============================================================================
   9c. MODAL ORDRE - OPTIMISATION MOBILE (MOBILE ONLY)
   Structure sticky, zones identifiées, grille d'actions (nav-tabs)
   ============================================================================ */

/* GARDE-FOU : Tous les styles dans media query mobile uniquement */
@media (width <= 768px) {
  /* === STRUCTURE FLEXBOX STICKY === */

  /* IMPORTANT: Cibler uniquement .modal-content, pas .modal-dialog */
  .bootbox-confirm > .modal-dialog {
    display: block !important; /* Annuler tout flex sur modal-dialog */
  }
  
  .bootbox-confirm .modal-content {
    display: flex !important;
    flex-direction: column !important;
    max-height: 90vh !important;
  }
  
  /* Header zone (select + title) - sticky */
  .bootbox-confirm .kraland-modal-header,
  .bootbox-confirm .kraland-character-title {
    position: sticky !important;
    top: 0 !important;
    z-index: 110 !important;
    background: white !important;
    flex-shrink: 0 !important;
  }
  
  .bootbox-confirm .kraland-modal-header {
    padding: 12px 16px 8px !important;
    border-bottom: 1px solid #e0e0e0 !important;
  }
  
  .bootbox-confirm .kraland-character-title {
    padding: 8px 16px !important;
    margin: 0 !important;
    font-size: 18px !important;
  }
  
  /* Actions zone (panel-heading avec nav-tabs) - sticky */
  .bootbox-confirm .kraland-actions-zone {
    position: sticky !important;
    top: 0 !important;
    z-index: 100 !important;
    background: white !important;
    padding: 12px 16px !important;
    border-bottom: 2px solid #f0f0f0 !important;
  }
  
  /* Body scrollable */
  .bootbox-confirm .modal-body {
    flex: 1 !important;
    overflow: hidden auto !important;
    padding: 0 !important;
  }
  
  /* Zone de formulaire (panel-body) - scrollable */
  .bootbox-confirm .kraland-form-zone {
    padding: 16px !important;
  }
  
  /* Footer du panel (coût/durée) - sticky avant footer modal */
  .bootbox-confirm .kraland-action-footer {
    position: sticky !important;
    bottom: 72px !important; /* Hauteur du footer modal */
    z-index: 90 !important;
    background: #f8f8f8 !important;
    padding: 12px 16px !important;
    border-top: 1px solid #e0e0e0 !important;
  }
  
  .bootbox-confirm .kraland-action-footer p {
    margin: 0 !important;
    font-size: 13px !important;
    color: #666 !important;
  }
  
  /* Footer modal sticky (boutons OK/Cancel) */
  .bootbox-confirm .kraland-modal-footer {
    position: sticky !important;
    bottom: 0 !important;
    z-index: 110 !important;
    background: white !important;
    flex-shrink: 0 !important;
    padding: 12px 16px !important;
    border-top: 2px solid #e0e0e0 !important;
    display: flex !important;
    gap: 12px !important;
  }
  
  .bootbox-confirm .kraland-modal-footer .btn {
    flex: 1 !important;
    min-height: 56px !important;
    font-size: 16px !important;
    border-radius: 8px !important;
  }
  
  /* === OPTIMISATION DES NAV-TABS (déjà en grid par forceOrderModalGridLayout) === */

  /* Les nav-tabs sont déjà stylés en grid 2 colonnes par le JS */

  /* On améliore juste le spacing et les couleurs */
  
  .bootbox-confirm .nav.nav-tabs li a {
    font-size: 15px !important;
    font-weight: 500 !important;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
    transition: all 0.2s ease !important;
  }
  
  /* Hover sur les nav-tabs */
  .bootbox-confirm .nav.nav-tabs li a:hover {
    background: #f0f8ff !important;
    text-decoration: none !important;
  }
  
  /* État actif des nav-tabs */
  .bootbox-confirm .nav.nav-tabs li.active a {
    background: #428bca !important;
    border-color: #428bca !important;
    color: white !important;
  }
  
  /* === OPTIMISATIONS FORMULAIRE === */
  
  /* IMPORTANT: Annuler les flex indésirables sur certains éléments Bootstrap SAUF les panels avec tableau */
  .bootbox-confirm .row,
  .bootbox-confirm [class*="col-"],
  .bootbox-confirm .form-group,
  .bootbox-confirm .tab-content {
    display: block !important;
  }
  
  /* EXCEPTION CRITIQUE: Les panels de type info (tableaux Actions) doivent utiliser flexbox */
  .bootbox-confirm .panel-info .panel-heading,
  .bootbox-confirm .panel-info .panel-body,
  .bootbox-confirm .panel-info .panel-footer {
    display: block !important; /* Garder block pour le container */
  }
  
  /* Les ROWS à l'intérieur des panels doivent être en flex pour l'alignement horizontal */
  .bootbox-confirm .panel-info .panel-heading .row,
  .bootbox-confirm .panel-info .panel-body .row,
  .bootbox-confirm .panel-info .panel-footer .row {
    display: flex !important;
    flex-flow: row nowrap !important;
    align-items: center !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  /* Les colonnes dans ces rows doivent avoir leur largeur Bootstrap */
  .bootbox-confirm .panel-info .row > [class*="col-"] {
    flex-shrink: 0 !important;
  }
  
  /* Largeurs spécifiques: Nouvelle répartition sm-0 / sm-7 / sm-3 / sm-3 */

  /* IMPORTANT: Définir les largeurs AVANT les paddings pour éviter les écrasements */
  .bootbox-confirm .panel-info .panel-heading .row > .col-sm-1,
  .bootbox-confirm .panel-info .panel-body .row > .col-sm-1 {
    flex: 0 0 0% !important;
    max-width: 0% !important;
    padding: 0 !important; /* Masquer complètement */
    overflow: hidden !important;
    width: 0 !important;
  }
  
  .bootbox-confirm .panel-info .panel-heading .row > .col-sm-7,
  .bootbox-confirm .panel-info .panel-body .row > .col-sm-7 {
    flex: 0 0 46% !important; /* 46% pour Actions */
    max-width: 46% !important;
  }
  
  /* Premier col-sm-2 (Diff.) devient col-sm-3 visuellement */
  .bootbox-confirm .panel-info .panel-heading .row > .col-sm-2:nth-child(3),
  .bootbox-confirm .panel-info .panel-body .row > .col-sm-2:nth-child(3) {
    flex: 0 0 27% !important; /* 27% pour Diff. */
    max-width: 27% !important;
  }
  
  /* Deuxième col-sm-2 (Jet) devient col-sm-3 visuellement */
  .bootbox-confirm .panel-info .panel-heading .row > .col-sm-2:nth-child(4),
  .bootbox-confirm .panel-info .panel-body .row > .col-sm-2:nth-child(4) {
    flex: 0 0 27% !important; /* 27% pour Jet */
    max-width: 27% !important;
  }
  
  /* ESPACEMENT: Padding pour éviter que les colonnes soient collées (APRÈS les largeurs) */
  .bootbox-confirm .panel-info .panel-heading .row > [class*="col-"]:not(.col-sm-1),
  .bootbox-confirm .panel-info .panel-body .row > [class*="col-"]:not(.col-sm-1) {
    padding-left: 8px !important;
    padding-right: 8px !important;
  }
  
  /* === FOOTER: Layout spécifique pour Maladresse + Bonus === */
  
  /* Footer: Groupement visuel avec widths fixes (proportions: 15% + 25% | 20% + 40%) */

  /* Groupe 1: Checkbox (15%) + Maladresse (25%) = 40% */
  .bootbox-confirm .panel-info .panel-footer .row > .col-sm-1 {
    flex: 0 0 15% !important;
    max-width: 15% !important;
    padding-left: 8px !important;
    padding-right: 4px !important;
  }
  
  .bootbox-confirm .panel-info .panel-footer .row > .col-sm-7 {
    flex: 0 0 25% !important;
    max-width: 25% !important;
    padding-left: 0 !important;
    padding-right: 12px !important; /* Gap avant groupe 2 */
  }
  
  /* Groupe 2: Bonus (20%) + Select (40%) = 60% */
  .bootbox-confirm .panel-info .panel-footer .row > .col-sm-2:nth-child(3) {
    flex: 0 0 20% !important;
    max-width: 20% !important;
    padding-left: 12px !important; /* Gap après groupe 1 */
    padding-right: 4px !important;
  }
  
  .bootbox-confirm .panel-info .panel-footer .row > .col-sm-2:nth-child(4) {
    flex: 0 0 40% !important;
    max-width: 40% !important;
    padding-left: 0 !important;
    padding-right: 8px !important;
  }
  
  /* === Alignement vertical des éléments du footer === */
  .bootbox-confirm .panel-info .panel-footer .row {
    align-items: center !important;
  }
  
  .bootbox-confirm .panel-info .panel-footer input[type="checkbox"],
  .bootbox-confirm .panel-info .panel-footer select,
  .bootbox-confirm .panel-info .panel-footer label {
    vertical-align: middle !important;
  }
  
  /* IMPORTANT: Préserver le comportement normal des tableaux Bootstrap */
  .bootbox-confirm table {
    display: table !important;
    width: 100% !important;
    table-layout: auto !important;
  }
  
  .bootbox-confirm table tbody {
    display: table-row-group !important;
  }
  
  .bootbox-confirm table tr {
    display: table-row !important;
  }
  
  .bootbox-confirm table td,
  .bootbox-confirm table th {
    display: table-cell !important;
    vertical-align: middle !important;
  }
  
  /* Select personnage */
  .bootbox-confirm .kraland-modal-header select {
    width: 100% !important;
    height: 48px !important;
    font-size: 16px !important;
    border-radius: 8px !important;
  }
  
  /* Image personnage dans title */
  .bootbox-confirm .kraland-character-title img {
    width: 60px !important;
    height: 60px !important;
    border-radius: 8px !important;
    object-fit: cover !important;
    margin-right: 12px !important;
  }
  
  /* Panel formulaire */
  .bootbox-confirm .kraland-form-zone .panel {
    border-radius: 8px !important;
    margin-bottom: 16px !important;
  }
  
  /* Inputs et textarea */
  .bootbox-confirm .kraland-form-zone input[type="text"],
  .bootbox-confirm .kraland-form-zone textarea,
  .bootbox-confirm .kraland-form-zone select {
    font-size: 16px !important; /* Évite zoom iOS */
    border-radius: 6px !important;
  }
  
  .bootbox-confirm .kraland-form-zone textarea {
    min-height: 120px !important;
  }
  
}

.bootbox-confirm textarea.form-control:focus {
  border-color: var(--kr-primary);
  box-shadow: 0 0 0 3px var(--kr-focus-ring);
  outline: none;
}

/* ============================================================================
   9d. AMÉLIORATIONS UX MODAL ORDRE (MOBILE ONLY)
   ============================================================================ */

@media (width <= 768px) {
  /* === UX #1: ALERTE REPLIABLE === */
  .bootbox-confirm .kr-alert-collapsible {
    padding: 0 !important;
    margin-bottom: 12px !important;
    border-radius: 8px !important;
    overflow: hidden !important;
  }
  
  .bootbox-confirm .kr-alert-toggle {
    width: 100% !important;
    padding: 12px 16px !important;
    background: #e3f2fd !important;
    border: none !important;
    color: #1565c0 !important;
    font-size: 15px !important;
    font-weight: 600 !important;
    text-align: left !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    cursor: pointer !important;
    transition: background 0.2s ease !important;
  }
  
  .bootbox-confirm .kr-alert-toggle:active {
    background: #bbdefb !important;
  }
  
  .bootbox-confirm .kr-alert-toggle i {
    font-size: 18px !important;
  }
  
  .bootbox-confirm .kr-alert-content {
    padding: 12px 16px !important;
    background: white !important;
    border-top: 1px solid #e0e0e0 !important;
    animation: slide-down 0.2s ease !important;
  }
  
  @keyframes slide-down {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* === UX #2: NAV-TABS ÉTAT ACTIF RENFORCÉ === */
  .bootbox-confirm .nav.nav-tabs li.active a {
    background: linear-gradient(135deg, #428bca 0%, #3071a9 100%) !important;
    border-color: #428bca !important;
    color: white !important;
    font-weight: 600 !important;
    box-shadow: 0 2px 8px rgba(66, 139, 202, 0.4) !important;
    transform: translateY(-1px) !important;
  }
  
  .bootbox-confirm .nav.nav-tabs li a:active {
    transform: translateY(0) !important;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2) !important;
  }
  
  /* === UX #3: TEXTAREA AGRANDI === */
  .bootbox-confirm .kraland-form-zone textarea#message {
    min-height: 160px !important;
    resize: vertical !important;
    font-size: 16px !important;
    line-height: 1.5 !important;
    padding: 12px !important;
  }
  
  /* === UX #4: FOOTER EN BADGES === */
  .bootbox-confirm .kr-action-badges {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 8px !important;
    align-items: center !important;
  }
  
  .bootbox-confirm .kr-badge {
    display: inline-flex !important;
    align-items: center !important;
    gap: 6px !important;
    padding: 6px 12px !important;
    border-radius: 16px !important;
    font-size: 13px !important;
    font-weight: 500 !important;
    white-space: nowrap !important;
  }
  
  .bootbox-confirm .kr-badge i {
    font-size: 14px !important;
  }
  
  .bootbox-confirm .kr-badge-cost {
    background: #fff3cd !important;
    color: #856404 !important;
    border: 1px solid #ffeaa7 !important;
  }
  
  .bootbox-confirm .kr-badge-duration {
    background: #d1ecf1 !important;
    color: #0c5460 !important;
    border: 1px solid #b8daff !important;
  }
  
  .bootbox-confirm .kr-badge-potential {
    background: #f8d7da !important;
    color: #721c24 !important;
    border: 1px solid #f5c6cb !important;
  }
  
  /* === UX #5: BOUTON OK RENFORCÉ === */
  .bootbox-confirm .kr-btn-primary-enhanced {
    background: linear-gradient(135deg, #5cb85c 0%, #449d44 100%) !important;
    border-color: #449d44 !important;
    color: white !important;
    font-weight: 700 !important;
    font-size: 18px !important;
    box-shadow: 0 4px 12px rgba(92, 184, 92, 0.4) !important;
    transition: all 0.2s ease !important;
  }
  
  .bootbox-confirm .kr-btn-primary-enhanced:active {
    transform: translateY(2px) !important;
    box-shadow: 0 2px 6px rgba(92, 184, 92, 0.3) !important;
  }
  
  .bootbox-confirm .kr-btn-secondary-subtle {
    background: #f5f5f5 !important;
    border-color: #ddd !important;
    color: #666 !important;
    font-weight: 500 !important;
  }
  
  .bootbox-confirm .kr-btn-secondary-subtle:active {
    background: #e0e0e0 !important;
  }
  
  /* === UX #6: SELECT GROUPÉ === */
  .bootbox-confirm .kraland-modal-header select optgroup {
    font-weight: 700 !important;
    font-size: 14px !important;
    color: #428bca !important;
    padding: 8px 0 !important;
  }
  
  .bootbox-confirm .kraland-modal-header select option {
    padding: 8px 12px !important;
    font-size: 15px !important;
  }
  
}

/* 7. ALERT D'AIDE */
.bootbox-confirm .alert {
  font-size: 0.875rem;
  padding: 12px;
  margin-bottom: var(--mobile-spacing-lg);
  border-radius: var(--mobile-radius);
  background: var(--kr-alert-info-bg);
  border: 1px solid var(--kr-alert-info-border);
}

.bootbox-confirm .alert .close {
  font-size: 1.5rem;
  line-height: 1;
  opacity: 0.5;
}

/* 8. FOOTER STICKY */
.bootbox-confirm .modal-footer {
  position: sticky;
  bottom: 0;
  background: var(--kr-bg-surface);
  border-top: 2px solid var(--kr-border-strong);
  padding: var(--mobile-spacing-lg);
  z-index: 100;
  box-shadow: 0 -4px 8px rgba(0,0,0,0.05);
  display: flex;
  flex-direction: column;
  gap: var(--mobile-spacing-md);
}

/* Info coût/durée/potentiel */
.bootbox-confirm .modal-footer p {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--kr-text-primary);
  margin-bottom: 0;
  padding: var(--mobile-spacing-sm) var(--mobile-spacing-md);
  background: var(--kr-bg-elevated);
  border-radius: var(--mobile-radius);
  border-left: 3px solid var(--kr-primary);
}

/* Boutons footer */
.bootbox-confirm .modal-footer .btn {
  min-height: var(--mobile-touch-target);
  min-width: 100px;
  font-size: 1rem;
  padding: 10px 24px;
  border-radius: var(--mobile-radius);
  font-weight: 500;
}

.bootbox-confirm .modal-footer > div {
  display: flex;
  gap: var(--mobile-spacing-md);
  justify-content: flex-end;
}
} /* Fin @media (width < 768px) pour BOOTBOX ORDER MODAL */

/*
  Pagination est utilisé dans les rapports
*/
.pagination > li.active > a{
  color: var(--kr-surface);
  background-color: var(--kr-primary-dark);
  border-color: var(--kr-primary-dark);
}

.pagination > li > a{
  color: var(--kr-primary);
}

.pagination > li.active > a:hover{
  color: var(--kr-surface);
  background-color: var(--kr-primary);
  border-color: var(--kr-primary);
}

.pagination > li > a:hover{
  color: var(--kr-primary);
}

/*
  .bg-primary est utilisé dans les rapports
*/
.bg-primary {
  background-color: var(--kr-primary) !important;
  color: var(--kr-surface) !important;
}

a:link,
a:visited {
  color: var(--kr-highlight);
  text-decoration: none;
  transition: color .12s ease, opacity .12s ease;
}

a:hover,
a:focus {
  color: var(--kr-primary-dark);
  text-decoration: underline;
  outline: none;
}

button.btn-primary,
a.btn-primary {
  background-color: var(--kr-primary);
  border-color: var(--kr-primary-dark);
  color: var(--kr-highlight-reverse);
  box-shadow: 0 6px 18px var(--kr-btn-shadow);
}

button.btn-primary:hover,
button.btn-primary:focus,
a.btn-primary:hover,
a.btn-primary:focus {
  background-color: var(--kr-primary-dark);
}

/* ============================================================================
   HIDE UNWANTED HR ELEMENT
   Supprime la ligne horizontale bleue dans le liste des ordres de la fiche de personnage
   ============================================================================ */

hr[style*="border-top: 1px solid"][style*="337ab7"] {
  display: none !important;
}

/* ============================================================================
   10. FOOTER - BACK TO TOP
   Position the back-to-top button on the right side of the footer
   ============================================================================ */

footer .container.white {
  position: relative;
}

.container.white .kraland-back-to-top {
  position: fixed; /* Fixed au lieu d'absolute pour ne pas ajouter de hauteur au footer */
  right: 20px;
  bottom: 20px;
  z-index: 1000;
  transform: none; /* Pas de transform nécessaire avec fixed */
}

/* ============================================================================
   11. DASHBOARD FLEX CARDS - Groupes de joueurs
   Système de cartes en grid avec toutes les informations visibles
   ============================================================================ */

.dashboard.dashboard-flex {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

/* Sections (Mon groupe / Autres personnages) */
.dashboard-section {
  background: var(--kr-surface);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgb(0,0,0,0.08);
}

.dashboard-section-header {
  background: var(--kr-primary);
  color: var(--kr-white);
  padding: 3px 8px;
  font-size: 9px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 5px;
}

/* Boutons de groupe dans l'en-tête */
.dashboard-group-buttons {
  display: flex;
  gap: 6px;
}

.dashboard-group-buttons .btn {
  background-color: rgb(255, 255, 255, 0.15);
  border: 1px solid rgb(255, 255, 255, 0.25);
  color: var(--kr-white);
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.dashboard-group-buttons .btn:hover {
  background-color: rgb(255, 255, 255, 0.25);
  border-color: rgb(255, 255, 255, 0.4);
  transform: scale(1.05);
}

.dashboard-group-buttons .btn i {
  font-size: 12px;
}

/* Titre du groupe */
.dashboard-group-title {
  flex: 1;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Grilles de cartes */
.dashboard-cards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px;
  padding: 12px;
}

.dashboard-cards-large {
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
}

/* Cartes individuelles */
.dashboard-card {
  background: var(--kr-white);
  border: 1px solid rgb(0,0,0,0.08);
  border-radius: 6px;
  overflow: hidden;
  transition: all 0.2s ease;
  position: relative;
  display: flex;
  flex-direction: column;
}

.dashboard-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgb(0,0,0,0.12);
  border-color: var(--kr-primary);
}

.dashboard-card-large {
  min-height: 90px;
}

/* Lien wrapper */
.dashboard-card-link {
  display: flex;
  flex-direction: column;
  text-decoration: none;
  color: inherit;
  flex: 1;
}

.dashboard-card-link:hover {
  text-decoration: none;
}

/* Header avec avatar et nom */
.dashboard-card-header {
  display: flex;
  align-items: center;
  background: rgb(0,0,0,0.02);
}

/* Wrapper pour l'avatar avec cercle de PV */
.dashboard-card-avatar-wrapper {
  position: relative;
  width: 82px;
  height: 82px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Cercle SVG de progression des PV */
.dashboard-card-hp-circle {
  position: absolute;
  top: 0;
  left: 0;
  width: 82px;
  height: 82px;
  pointer-events: none;
  z-index: 1;
}

.dashboard-card-avatar {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--kr-primary);
  flex-shrink: 0;
  position: relative;
  z-index: 2;
}

.dashboard-card-large .dashboard-card-avatar {
  width: 70px;
  height: 70px;
}

/* Conteneur pour le drapeau et le nom */
.dashboard-card-name-container {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
  min-width: 0;
}

/* Drapeau de nationalité dans le header */
.dashboard-card-world {
  width: 20px;
  height: 10px;
  object-fit: contain;
  flex-shrink: 0;
}

.dashboard-card-name {
  font-size: 11px;
  font-weight: 600;
  color: var(--kr-text);
  line-height: 1.2;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  flex: 1;
}

.dashboard-card-large .dashboard-card-name {
  font-size: 13px;
}

/* Body avec statut uniquement (monde dans les actions) */
.dashboard-card-body {
  padding: 0 8px 5px;
  display: flex;
  flex-direction: column;
  gap: 3px;
  flex: 1;
  min-height: 0;
}

.dashboard-card-status {
  font-size: 9px;
  color: var(--kr-muted);
  line-height: 1.2;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: center;
}

.dashboard-card-large .dashboard-card-status {
  font-size: 11px;
  white-space: normal;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

/* Barre de HP */
.dashboard-card-hp {
  height: 6px;
  background: rgb(0,0,0,0.08);
  position: relative;
  margin: 0;
}

.dashboard-card-hp-fill {
  height: 100%;
  transition: width 0.3s ease, background-color 0.3s ease;
  border-radius: 0;
}

/* Badge PNJ */
.dashboard-card-pnj {
  position: absolute;
  top: 8px;
  right: 8px;
  background: var(--kr-badge-pnj);
  color: var(--kr-white);
  font-size: 8px;
  font-weight: 600;
  padding: 2px 5px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  z-index: 1;
}

/* Boutons d'actions individuelles par personnage */
.dashboard-card-actions {
  position: absolute;
  bottom: 4px;
  right: 4px;
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 4px;
  opacity: 0.7;
  transition: opacity 0.2s ease;
  z-index: 2;
}

.dashboard-card:hover .dashboard-card-actions {
  opacity: 1;
}

/* Adapter les divs internes pour qu'elles soient empilées verticalement */
.dashboard-card-actions > div {
  display: flex;
  flex-direction: column;
  gap: 2px;
  margin: 0 !important;
  padding: 0 !important;
  height: auto !important;
}

.dashboard-card-actions > div > div {
  margin: 0 !important;
  padding: 0 !important;
  height: auto !important;
}

/* Liens d'action compacts */
.dashboard-card-actions a {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 4px 6px !important;
  background-color: rgb(0, 0, 0, 0.6);
  border-radius: 3px;
  transition: background-color 0.2s ease;
  min-width: 24px;
  height: 24px;
}

.dashboard-card-actions a:hover {
  background-color: rgb(0, 0, 0, 0.8);
}

.dashboard-card-actions a i {
  color: var(--kr-white);
  font-size: 12px;
  margin: 0;
}

/* Responsive */
@media (width <= 768px) {
  .dashboard-cards-grid {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 8px;
  }
  
  .dashboard-cards-large {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }
}


/* ============================================================================
   12. EDITEUR DE TEXTE
   Styles pour les boutons de l'éditeur BBCode
   ============================================================================ */

/* Style de base pour tous les boutons de l'éditeur, sauf la palette de couleurs */
.btn-toolbar .btn:not(.dropdown-menu *) {
  background-color: var(--kr-surface) !important;
  background-image: none !important;
  color: var(--kr-primary) !important;
  border: 1px solid rgb(0,0,0,0.06) !important;
  box-shadow: none !important;
}

.btn-toolbar .btn:not(.dropdown-menu *) i,
.btn-toolbar .btn:not(.dropdown-menu *) .fa,
.btn-toolbar .btn:not(.dropdown-menu *) .fas,
.btn-toolbar .btn:not(.dropdown-menu *) .far {
  color: inherit !important;
}

/* ============================================================================
   13. DARK MODE (Tous les thèmes)
   Styles mutualisés pour tous les thèmes en mode sombre
   ============================================================================ */

/* === BODY & BACKGROUNDS === */
html[class*="-dark"] body {
  background-color: var(--kr-bg-page);
  color: var(--kr-text-primary);
}

/* === PANELS === */
html[class*="-dark"] .panel,
html[class*="-dark"] .panel-default {
  background-color: var(--kr-bg-surface);
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .panel-heading {
  background-color: var(--kr-bg-elevated);
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .panel-body {
  background-color: var(--kr-bg-surface);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .panel-footer {
  background-color: var(--kr-bg-elevated);
  border-color: var(--kr-border-default);
}

/* === WELLS === */
html[class*="-dark"] .well {
  background-color: var(--kr-bg-elevated);
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary);
}

/* === THEME SELECTOR TAMPERMONKEY === */
html[class*="-dark"] .kr-tamper-theme label {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .kr-tamper-theme .control-label {
  color: var(--kr-text-secondary);
}

html[class*="-dark"] .kr-tamper-theme h4 {
  color: var(--kr-text-primary);
}

/* === MODALS === */
html[class*="-dark"] .modal-content {
  background-color: var(--kr-bg-surface);
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .modal-header,
html[class*="-dark"] .modal-body,
html[class*="-dark"] .modal-footer {
  background-color: var(--kr-bg-surface);
  color: var(--kr-text-primary);
  border-color: var(--kr-border-default);
}

/* === FORMS === */
html[class*="-dark"] .form-control {
  background-color: var(--kr-form-bg);
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .form-control::placeholder {
  color: var(--kr-text-muted);
}

html[class*="-dark"] .form-control:focus {
  background-color: var(--kr-form-bg-focus);
  border-color: var(--kr-primary);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .form-group label,
html[class*="-dark"] label {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .input-group-addon {
  background-color: var(--kr-bg-elevated);
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary);
}

/* === BUTTONS === */
html[class*="-dark"] .btn-primary {
  background-color: var(--kr-primary);
  border-color: var(--kr-primary-dark);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .btn-primary:hover,
html[class*="-dark"] .btn-primary:focus,
html[class*="-dark"] .btn-primary:active {
  background-color: var(--kr-primary-dark);
  border-color: var(--kr-primary-dark);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .btn-default {
  background-color: var(--kr-bg-elevated);
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .btn-default:hover {
  background-color: var(--kr-bg-active);
  border-color: var(--kr-border-strong);
}

html[class*="-dark"] .btn-default:focus,
html[class*="-dark"] .btn-default:active {
  background-color: var(--kr-bg-hover);
  border-color: var(--kr-border-strong);
  color: var(--kr-text-primary);
}

/* === LIST GROUPS === */
html[class*="-dark"] .list-group-item {
  background-color: var(--kr-bg-surface);
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .list-group-item:hover {
  background-color: var(--kr-bg-hover);
}

html[class*="-dark"] .list-group-item-heading {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .list-group-item-text {
  color: var(--kr-text-secondary);
}

/* === TABLES === */
html[class*="-dark"] .table {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .table > thead > tr > th,
html[class*="-dark"] .table > tbody > tr > th,
html[class*="-dark"] .table > tfoot > tr > th {
  background-color: var(--kr-bg-elevated);
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .table > tbody > tr > td {
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .table-striped > tbody > tr:nth-of-type(odd) {
  background-color: var(--kr-bg-hover);
}

/* Override for tables with forum-like styling */
html[class*="-dark"] .table.table-striped > tbody > tr {
  background-color: var(--kr-bg-page);
}

html[class*="-dark"] .table.table-striped > tbody > tr:nth-of-type(odd) {
  background-color: var(--kr-bg-elevated);
}

html[class*="-dark"] .table-hover > tbody > tr:hover {
  background-color: var(--kr-bg-active);
}

/* === DROPDOWNS === */
html[class*="-dark"] .dropdown-menu {
  background-color: var(--kr-bg-elevated);
  border-color: var(--kr-border-strong);
}

html[class*="-dark"] .dropdown-menu > li > a {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .dropdown-menu > li > a:hover,
html[class*="-dark"] .dropdown-menu > li > a:focus {
  background-color: var(--kr-bg-hover);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .dropdown-menu > .active > a,
html[class*="-dark"] .dropdown-menu > .active > a:hover,
html[class*="-dark"] .dropdown-menu > .active > a:focus {
  background-color: var(--kr-primary);
  color: var(--kr-text-inverse);
}

/* ============================================================================
   SMILEYS DROPDOWN - NORMALISATION
   ============================================================================ */

/* Phase 1 : Normalisation des images à taille uniforme (32x32px) */
.dropdown-menu table img,
.btn-toolbar .dropdown-menu table img {
  width: 32px !important;
  height: 32px !important;
  object-fit: contain !important; /* Préserve le ratio sans déformation */
  display: block !important; /* Élimine l'espace inline */
  flex-shrink: 0 !important; /* Empêche rétrécissement */
}

/* === NAVIGATION === */
html[class*="-dark"] .nav-tabs {
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .nav-tabs > li > a {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .nav-tabs > li > a:hover {
  background-color: var(--kr-bg-hover);
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .nav-tabs > li.active > a,
html[class*="-dark"] .nav-tabs > li.active > a:hover,
html[class*="-dark"] .nav-tabs > li.active > a:focus {
  background-color: var(--kr-bg-surface);
  border-color: var(--kr-border-default) var(--kr-border-default) transparent;
  color: var(--kr-text-primary);
}

/* === ALERTS === */
html[class*="-dark"] .alert {
  border-color: var(--kr-border-default);
  color: var(--kr-text-primary) !important;
}

html[class*="-dark"] .alert * {
  color: inherit !important;
}

html[class*="-dark"] .alert a {
  color: var(--kr-primary) !important;
  text-decoration: underline;
}

html[class*="-dark"] .alert-info {
  background-color: rgb(122, 82, 64, 0.15);
  border-color: rgb(122, 82, 64, 0.3);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .alert-success {
  background-color: rgb(34, 197, 94, 0.15);
  border-color: rgb(34, 197, 94, 0.3);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .alert-warning {
  background-color: rgb(245, 158, 11, 0.15);
  border-color: rgb(245, 158, 11, 0.3);
  color: var(--kr-text-primary);
}

html[class*="-dark"] .alert-danger {
  background-color: rgb(239, 68, 68, 0.15);
  border-color: rgb(239, 68, 68, 0.3);
  color: var(--kr-text-primary);
}

/* === PROGRESS === */
html[class*="-dark"] .progress {
  background-color: var(--kr-bg-elevated);
}

/* === DASHBOARD CARDS === */
html[class*="-dark"] .dashboard-card {
  background: var(--kr-bg-surface);
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .dashboard-card:hover {
  box-shadow: var(--kr-shadow-md);
}

html[class*="-dark"] .dashboard-card-header {
  background: var(--kr-bg-hover);
}

html[class*="-dark"] .dashboard-card-name {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .dashboard-card-status {
  color: var(--kr-text-muted);
}

html[class*="-dark"] .dashboard-section {
  background: var(--kr-bg-surface);
}

html[class*="-dark"] .dashboard-card-hp {
  background: var(--kr-bg-elevated);
}

/* === MINI-CHAT === */
html[class*="-dark"] .chat li {
  border-bottom-color: var(--kr-border-default);
}

html[class*="-dark"] .panel-body-scroll {
  background-color: var(--kr-bg-surface);
}

html[class*="-dark"] #flap {
  background-color: var(--kr-bg-elevated);
}

html[class*="-dark"] #flap a.open,
html[class*="-dark"] #flap a.closed {
  background: var(--kr-bg-elevated);
  color: var(--kr-text-primary);
}

/* === MAP === */
html[class*="-dark"] .map-box {
  background-color: var(--kr-bg-surface);
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .map-box-title {
  background-color: var(--kr-primary);
  color: var(--kr-text-inverse);
}

html[class*="-dark"] .map-box-content {
  color: var(--kr-text-primary);
}

html[class*="-dark"] .map-box-bottom {
  background-color: var(--kr-primary);
  color: var(--kr-text-inverse);
}

/* === CLASSES KRALAND .f1-.f9 (couleurs nations) === */
html[class*="-dark"] .f1 { color: var(--kr-nation-1); }
html[class*="-dark"] .f2 { color: var(--kr-nation-2); }
html[class*="-dark"] .f3 { color: var(--kr-nation-3); }
html[class*="-dark"] .f4 { color: var(--kr-nation-4); }
html[class*="-dark"] .f5 { color: var(--kr-nation-5); }
html[class*="-dark"] .f6 { color: var(--kr-nation-6); }
html[class*="-dark"] .f7 { color: var(--kr-nation-7); }
html[class*="-dark"] .f8 { color: var(--kr-nation-8); }
html[class*="-dark"] .f9 { color: var(--kr-nation-9); }

/* === CLASSES KRALAND .c1-.c10 (fonds nations) === */
html[class*="-dark"] .c1  { background-color: var(--kr-nation-bg-1); }
html[class*="-dark"] .c2  { background-color: var(--kr-nation-bg-2); }
html[class*="-dark"] .c3  { background-color: var(--kr-nation-bg-3); }
html[class*="-dark"] .c4  { background-color: var(--kr-nation-bg-4); }
html[class*="-dark"] .c5  { background-color: var(--kr-nation-bg-5); }
html[class*="-dark"] .c6  { background-color: var(--kr-nation-bg-6); }
html[class*="-dark"] .c7  { background-color: var(--kr-nation-bg-7); }
html[class*="-dark"] .c8  { background-color: var(--kr-nation-bg-8); }
html[class*="-dark"] .c9  { background-color: var(--kr-nation-bg-9); }
html[class*="-dark"] .c10 { background-color: var(--kr-nation-bg-10); }

/* === COULEURS HTML KRALAND (balises <font color="">) === */
/* Surcharge des couleurs spécifiques utilisées par Kraland pour le dark mode */
/* Ajustement minimal pour conserver les teintes d'origine */

html[class*="-dark"] font[color="#f4ac00"],
html[class*="-dark"] font[color="f4ac00"] {
  color: #ffbe33 !important; /* yellow - Légèrement éclairci, garde la teinte or */
}

html[class*="-dark"] font[color="#f77400"],
html[class*="-dark"] font[color="f77400"] {
  color: #ff8833 !important; /* orange - Éclairci mais garde l'orange vif */
}

html[class*="-dark"] font[color="#ed6161"],
html[class*="-dark"] font[color="ed6161"] {
  color: #ff7a7a !important; /* fuchsia - Légèrement éclairci, garde le rose-rouge */
}

html[class*="-dark"] font[color="#d50000"],
html[class*="-dark"] font[color="d50000"] {
  color: #ff3333 !important; /* red - Rouge vif éclairci */
}

html[class*="-dark"] font[color="olive"] {
  color: #b3b333 !important; /* olive - Éclairci mais garde le jaune-vert olive */
}

html[class*="-dark"] font[color="#219c5a"],
html[class*="-dark"] font[color="219c5a"] {
  color: #33cc77 !important; /* lightgreen - Éclairci, garde le vert vif */
}

html[class*="-dark"] font[color="#006f00"],
html[class*="-dark"] font[color="006f00"] {
  color: #00bb00 !important; /* green - Vert pur éclairci */
}

html[class*="-dark"] font[color="teal"] {
  color: #33cccc !important; /* teal - Teal éclairci */
}

html[class*="-dark"] font[color="#5577bc"],
html[class*="-dark"] font[color="5577bc"] {
  color: #7799dd !important; /* lightblue - Légèrement éclairci, garde le bleu */
}

html[class*="-dark"] font[color="#2b2be4"],
html[class*="-dark"] font[color="2b2be4"] {
  color: #5555ff !important; /* blue - Bleu vif éclairci */
}

html[class*="-dark"] font[color="navy"] {
  color: #5555cc !important; /* navy - Navy éclairci mais garde le bleu foncé */
}

html[class*="-dark"] font[color="purple"] {
  color: #cc55cc !important; /* purple - Violet éclairci */
}

html[class*="-dark"] font[color="#4B0082"],
html[class*="-dark"] font[color="4B0082"],
html[class*="-dark"] font[color="4b0082"] {
  color: #8855cc !important; /* indigo - Indigo éclairci, garde le violet-bleu */
}

html[class*="-dark"] font[color="maroon"] {
  color: #cc5555 !important; /* maroon - Bordeaux éclairci */
}

html[class*="-dark"] font[color="#5e432d"],
html[class*="-dark"] font[color="5e432d"] {
  color: #aa7755 !important; /* brown - Marron éclairci, garde la teinte chaude */
}

html[class*="-dark"] font[color="gray"] {
  color: #aaaaaa !important; /* gray - Gris éclairci */
}

html[class*="-dark"] font[color="#5a5a5a"],
html[class*="-dark"] font[color="5a5a5a"] {
  color: #999999 !important; /* darkgray - Éclairci mais garde le gris moyen */
}

html[class*="-dark"] font[color="#000000"],
html[class*="-dark"] font[color="000000"] {
  color: #cccccc !important; /* black - Gris clair (noir impossible en dark) */
}

/* === CLASSES DE COULEURS === */
html[class*="-dark"] .red {
  color: #ff3333 !important; /* red - Rouge vif éclairci */
}

html[class*="-dark"] .blue {
  color: #3388ff !important; /* blue - Bleu France, bon contraste */
}

/* === COULEURS PALETTE DE SÉLECTION (boutons background-color) === */
/* Surcharge des background-color des boutons de la palette de couleurs */

html[class*="-dark"] [style*="background-color:#f4ac00"],
html[class*="-dark"] [style*="background-color: #f4ac00"] {
  background-color: #ffbe33 !important; /* yellow */
}

html[class*="-dark"] [style*="background-color:#f77400"],
html[class*="-dark"] [style*="background-color: #f77400"] {
  background-color: #ff8833 !important; /* orange */
}

html[class*="-dark"] [style*="background-color:#ed6161"],
html[class*="-dark"] [style*="background-color: #ed6161"] {
  background-color: #ff7a7a !important; /* fuchsia */
}

html[class*="-dark"] [style*="background-color:#d50000"],
html[class*="-dark"] [style*="background-color: #d50000"] {
  background-color: #ff3333 !important; /* red */
}

html[class*="-dark"] [style*="background-color:#808000"],
html[class*="-dark"] [style*="background-color: #808000"] {
  background-color: #b3b333 !important; /* olive */
}

html[class*="-dark"] [style*="background-color:#219c5a"],
html[class*="-dark"] [style*="background-color: #219c5a"] {
  background-color: #33cc77 !important; /* lightgreen */
}

html[class*="-dark"] [style*="background-color:#006f00"],
html[class*="-dark"] [style*="background-color: #006f00"] {
  background-color: #00bb00 !important; /* green */
}

html[class*="-dark"] [style*="background-color:#008080"],
html[class*="-dark"] [style*="background-color: #008080"] {
  background-color: #33cccc !important; /* teal */
}

html[class*="-dark"] [style*="background-color:#5577bc"],
html[class*="-dark"] [style*="background-color: #5577bc"] {
  background-color: #7799dd !important; /* lightblue */
}

html[class*="-dark"] [style*="background-color:#2b2be4"],
html[class*="-dark"] [style*="background-color: #2b2be4"] {
  background-color: #5555ff !important; /* blue */
}

html[class*="-dark"] [style*="background-color:#000080"],
html[class*="-dark"] [style*="background-color: #000080"] {
  background-color: #5555cc !important; /* navy */
}

html[class*="-dark"] [style*="background-color:#800080"],
html[class*="-dark"] [style*="background-color: #800080"] {
  background-color: #cc55cc !important; /* purple */
}

html[class*="-dark"] [style*="background-color:#4B0082"],
html[class*="-dark"] [style*="background-color: #4B0082"],
html[class*="-dark"] [style*="background-color:#4b0082"],
html[class*="-dark"] [style*="background-color: #4b0082"] {
  background-color: #8855cc !important; /* indigo */
}

html[class*="-dark"] [style*="background-color:#800000"],
html[class*="-dark"] [style*="background-color: #800000"] {
  background-color: #cc5555 !important; /* maroon */
}

html[class*="-dark"] [style*="background-color:#5e432d"],
html[class*="-dark"] [style*="background-color: #5e432d"] {
  background-color: #aa7755 !important; /* brown */
}

html[class*="-dark"] [style*="background-color:#808080"],
html[class*="-dark"] [style*="background-color: #808080"] {
  background-color: #aaaaaa !important; /* gray */
}

html[class*="-dark"] [style*="background-color:#5a5a5a"],
html[class*="-dark"] [style*="background-color: #5a5a5a"] {
  background-color: #999999 !important; /* darkgray */
}

html[class*="-dark"] [style*="background-color:#000000"],
html[class*="-dark"] [style*="background-color: #000000"] {
  background-color: #cccccc !important; /* black */
}

/* === SCROLLBARS === */
html[class*="-dark"] ::-webkit-scrollbar-track {
  background-color: var(--kr-bg-page);
}

html[class*="-dark"] ::-webkit-scrollbar-thumb {
  background-color: var(--kr-text-muted);
}

html[class*="-dark"] ::-webkit-scrollbar-thumb:hover {
  background-color: var(--kr-text-secondary);
}

/* === SELECTION === */
html[class*="-dark"] ::selection {
  background-color: var(--kr-primary);
  color: var(--kr-text-inverse);
}

/* === FOOTER === */
html[class*="-dark"] footer {
  background-color: var(--kr-bg-elevated);
  border-top: 1px solid var(--kr-border-default);
}

html[class*="-dark"] .footer-quote {
  color: var(--kr-text-secondary);
}

/* === SKILLS PANEL === */
html[class*="-dark"] #skills-panel {
  background-color: var(--kr-bg-surface) !important;
  border-color: var(--kr-border-default) !important;
}

/* === SEPARATORS === */
html[class*="-dark"] hr {
  display: none;
}

/* === CAROUSEL === */
html[class*="-dark"] .carousel-control {
  color: var(--kr-primary);
  opacity: 0.7;
}

html[class*="-dark"] .carousel-control:hover,
html[class*="-dark"] .carousel-control:focus {
  color: var(--kr-highlight);
  opacity: 0.9;
}

html[class*="-dark"] .carousel-indicators li {
  background-color: var(--kr-border-default);
  border-color: var(--kr-border-default);
}

html[class*="-dark"] .carousel-indicators .active {
  background-color: var(--kr-primary);
  border-color: var(--kr-primary);
}

/* === LIENS === */
html[class*="-dark"] a:link,
html[class*="-dark"] a:visited {
  color: var(--kr-highlight);
}

html[class*="-dark"] a:hover,
html[class*="-dark"] a:focus {
  color: var(--kr-primary);
}

/* === BOUTONS DE NAVIGATION PREV/NEXT === */
html[class*="-dark"] a.prev,
html[class*="-dark"] a.next {
  background-color: var(--kr-bg-elevated) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
}

html[class*="-dark"] a.prev:hover,
html[class*="-dark"] a.next:hover {
  background-color: var(--kr-bg-hover) !important;
  border-color: var(--kr-border-strong) !important;
  color: var(--kr-highlight) !important;
}

/* === BOUTONS WARNING === */

/* Adaptation des boutons warning pour le thème sombre */
html[class*="-dark"] .btn-warning {
  background-color: var(--kr-primary) !important;
  border-color: var(--kr-primary-dark) !important;
  color: var(--kr-text-inverse) !important;
}

html[class*="-dark"] .btn-warning:hover {
  background-color: var(--kr-highlight) !important;
  border-color: var(--kr-primary) !important;
}

/* === ICÔNES DE COMPÉTENCES ET CARACTÉRISTIQUES === */

/* Réduction du contraste des icônes blanches */
html[class*="-dark"] img[src*="/mat/94/"] {
  filter: none;
  opacity: 0.85;
}

html[class*="-dark"] img[src*="/mat/94/"]:hover {
  filter: none;
  opacity: 1;
}

/* === ICÔNES DE BÂTIMENTS === */

/* Réduction du contraste des icônes blanches */
html[class*="-dark"] img[src*="/bat/bat"] {
  filter: none;
  opacity: 0.85;
}

html[class*="-dark"] img[src*="/bat/bat"]:hover {
  filter: none;
  opacity: 1;
}

/* === ICÔNES DE VOCATIONS === */

/* Réduction du contraste des icônes blanches */
html[class*="-dark"] img[src*="/voc/"] {
  filter: none;
  opacity: 0.85;
}

html[class*="-dark"] img[src*="/voc/"]:hover {
  filter: none;
  opacity: 1;
}

/* ============================================================================
   HORLOGE À DOUBLE TOUR (0-48H)
   ============================================================================ */

/* Système d'horloge circulaire qui supporte jusqu'à 48 heures avec deux tours de cadran.
   Le premier tour (0-24h) s'affiche sur le cercle principal.
   Le deuxième tour (24-48h) s'affiche sur un cercle extérieur plus visible.
*/

/* Container de l'horloge */
.c100 {
  position: relative !important;
  width: 80px !important;
  height: 80px !important;
  border-radius: 50% !important;
  background-color: var(--kr-bg-elevated, #f5f5f5) !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  overflow: visible !important;
}

/* Masquer l'ancien système à base de .slice, .bar, .fill */
.c100 .slice,
.c100 .bar,
.c100 .fill {
  display: none !important;
}

/* Texte de l'heure au centre */
.c100 > span {
  position: relative !important;
  z-index: 10 !important;
  font-size: 20px !important;
  font-weight: 600 !important;
  color: var(--kr-text-primary, #333) !important;
  text-align: center !important;
}

/* Fond circulaire après */
.c100::after {
  content: '' !important;
  position: absolute !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  width: 68px !important;
  height: 68px !important;
  border-radius: 50% !important;
  background-color: var(--kr-bg-elevated, #f5f5f5) !important;
  z-index: 5 !important;
}

/* Cercle de progression - Premier tour (0-24h) */
.c100::before {
  content: '' !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  border-radius: 50% !important;
  background: conic-gradient(
    var(--clock-color, #8B0000) 0deg,
    var(--clock-color, #8B0000) calc(var(--clock-deg, 0) * 1deg),
    transparent calc(var(--clock-deg, 0) * 1deg),
    transparent 360deg
  ) !important;
  z-index: 1 !important;
  transition: none !important;
}

/* Deuxième tour (24-48h) - Cercle extérieur avec bordure reprenant la couleur de l'horloge */
.c100[data-second-lap="true"]::before {
  box-shadow: 
    0 0 0 1px var(--kr-bg-elevated, #f5f5f5),
    0 0 0 5px var(--clock-color, #32CD32),
    inset 0 0 0 2px var(--clock-color, #32CD32) !important;
}

/* Classes de pourcentage p0 à p100 pour la compatibilité */
.c100.p0 { --clock-deg: 0; }
.c100.p1 { --clock-deg: 3.6; }
.c100.p2 { --clock-deg: 7.2; }
.c100.p3 { --clock-deg: 10.8; }
.c100.p4 { --clock-deg: 14.4; }
.c100.p5 { --clock-deg: 18; }
.c100.p6 { --clock-deg: 21.6; }
.c100.p7 { --clock-deg: 25.2; }
.c100.p8 { --clock-deg: 28.8; }
.c100.p9 { --clock-deg: 32.4; }
.c100.p10 { --clock-deg: 36; }
.c100.p11 { --clock-deg: 39.6; }
.c100.p12 { --clock-deg: 43.2; }
.c100.p13 { --clock-deg: 46.8; }
.c100.p14 { --clock-deg: 50.4; }
.c100.p15 { --clock-deg: 54; }
.c100.p16 { --clock-deg: 57.6; }
.c100.p17 { --clock-deg: 61.2; }
.c100.p18 { --clock-deg: 64.8; }
.c100.p19 { --clock-deg: 68.4; }
.c100.p20 { --clock-deg: 72; }
.c100.p21 { --clock-deg: 75.6; }
.c100.p22 { --clock-deg: 79.2; }
.c100.p23 { --clock-deg: 82.8; }
.c100.p24 { --clock-deg: 86.4; }
.c100.p25 { --clock-deg: 90; }
.c100.p26 { --clock-deg: 93.6; }
.c100.p27 { --clock-deg: 97.2; }
.c100.p28 { --clock-deg: 100.8; }
.c100.p29 { --clock-deg: 104.4; }
.c100.p30 { --clock-deg: 108; }
.c100.p31 { --clock-deg: 111.6; }
.c100.p32 { --clock-deg: 115.2; }
.c100.p33 { --clock-deg: 118.8; }
.c100.p34 { --clock-deg: 122.4; }
.c100.p35 { --clock-deg: 126; }
.c100.p36 { --clock-deg: 129.6; }
.c100.p37 { --clock-deg: 133.2; }
.c100.p38 { --clock-deg: 136.8; }
.c100.p39 { --clock-deg: 140.4; }
.c100.p40 { --clock-deg: 144; }
.c100.p41 { --clock-deg: 147.6; }
.c100.p42 { --clock-deg: 151.2; }
.c100.p43 { --clock-deg: 154.8; }
.c100.p44 { --clock-deg: 158.4; }
.c100.p45 { --clock-deg: 162; }
.c100.p46 { --clock-deg: 165.6; }
.c100.p47 { --clock-deg: 169.2; }
.c100.p48 { --clock-deg: 172.8; }
.c100.p49 { --clock-deg: 176.4; }
.c100.p50 { --clock-deg: 180; }
.c100.p51 { --clock-deg: 183.6; }
.c100.p52 { --clock-deg: 187.2; }
.c100.p53 { --clock-deg: 190.8; }
.c100.p54 { --clock-deg: 194.4; }
.c100.p55 { --clock-deg: 198; }
.c100.p56 { --clock-deg: 201.6; }
.c100.p57 { --clock-deg: 205.2; }
.c100.p58 { --clock-deg: 208.8; }
.c100.p59 { --clock-deg: 212.4; }
.c100.p60 { --clock-deg: 216; }
.c100.p61 { --clock-deg: 219.6; }
.c100.p62 { --clock-deg: 223.2; }
.c100.p63 { --clock-deg: 226.8; }
.c100.p64 { --clock-deg: 230.4; }
.c100.p65 { --clock-deg: 234; }
.c100.p66 { --clock-deg: 237.6; }
.c100.p67 { --clock-deg: 241.2; }
.c100.p68 { --clock-deg: 244.8; }
.c100.p69 { --clock-deg: 248.4; }
.c100.p70 { --clock-deg: 252; }
.c100.p71 { --clock-deg: 255.6; }
.c100.p72 { --clock-deg: 259.2; }
.c100.p73 { --clock-deg: 262.8; }
.c100.p74 { --clock-deg: 266.4; }
.c100.p75 { --clock-deg: 270; }
.c100.p76 { --clock-deg: 273.6; }
.c100.p77 { --clock-deg: 277.2; }
.c100.p78 { --clock-deg: 280.8; }
.c100.p79 { --clock-deg: 284.4; }
.c100.p80 { --clock-deg: 288; }
.c100.p81 { --clock-deg: 291.6; }
.c100.p82 { --clock-deg: 295.2; }
.c100.p83 { --clock-deg: 298.8; }
.c100.p84 { --clock-deg: 302.4; }
.c100.p85 { --clock-deg: 306; }
.c100.p86 { --clock-deg: 309.6; }
.c100.p87 { --clock-deg: 313.2; }
.c100.p88 { --clock-deg: 316.8; }
.c100.p89 { --clock-deg: 320.4; }
.c100.p90 { --clock-deg: 324; }
.c100.p91 { --clock-deg: 327.6; }
.c100.p92 { --clock-deg: 331.2; }
.c100.p93 { --clock-deg: 334.8; }
.c100.p94 { --clock-deg: 338.4; }
.c100.p95 { --clock-deg: 342; }
.c100.p96 { --clock-deg: 345.6; }
.c100.p97 { --clock-deg: 349.2; }
.c100.p98 { --clock-deg: 352.8; }
.c100.p99 { --clock-deg: 356.4; }
.c100.p100 { --clock-deg: 360; }

/* === INDICATEUR CIRCULAIRE DE TEMPS === */

/* Adaptation pour le thème sombre */
html[class*="-dark"] .c100 {
  background-color: var(--kr-bg-elevated) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
}

html[class*="-dark"] .c100::after {
  background-color: var(--kr-bg-elevated) !important;
}

html[class*="-dark"] .c100 > span {
  color: var(--kr-text-primary) !important;
  font-size: 20px !important;
  font-weight: 600 !important;
  line-height: 80px !important;
  width: 80px !important;
  height: 80px !important;
}

html[class*="-dark"] .c100 .slice {
  border-color: var(--kr-bg-elevated) !important;
}

html[class*="-dark"] .c100 .bar {
  border-color: var(--kr-primary) !important;
}

html[class*="-dark"] .c100 .fill {
  border-color: var(--kr-bg-elevated) !important;
}

/* Pagination */
html[class*="-dark"] .pagination {
  background-color: transparent !important;
}

html[class*="-dark"] .pagination > li > a,
html[class*="-dark"] .pagination > li > span {
  background-color: var(--kr-bg-elevated) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
}

html[class*="-dark"] .pagination > li.disabled > a,
html[class*="-dark"] .pagination > li.disabled > span {
  background-color: var(--kr-bg-surface) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-muted) !important;
  opacity: 0.6 !important;
}

html[class*="-dark"] .pagination > li > a:hover,
html[class*="-dark"] .pagination > li > span:hover {
  background-color: var(--kr-bg-hover) !important;
  border-color: var(--kr-border-strong) !important;
  color: var(--kr-primary) !important;
}

html[class*="-dark"] .pagination > .active > a,
html[class*="-dark"] .pagination > .active > span {
  background-color: var(--kr-primary) !important;
  border-color: var(--kr-primary) !important;
  color: var(--kr-text-inverse) !important;
}

html[class*="-dark"] .pagination > .active > a:hover,
html[class*="-dark"] .pagination > .active > span:hover {
  background-color: var(--kr-primary) !important;
  border-color: var(--kr-primary) !important;
  color: var(--kr-text-inverse) !important;
}

/* DataTables Pagination */
html[class*="-dark"] .dataTables_paginate {
  background-color: transparent !important;
}

html[class*="-dark"] .dataTables_paginate .paginate_button {
  background-color: var(--kr-bg-elevated) !important;
  border: 1px solid var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
  background-image: none !important;
  box-shadow: none !important;
}

html[class*="-dark"] .dataTables_paginate .paginate_button.current {
  background-color: var(--kr-primary) !important;
  border-color: var(--kr-primary) !important;
  color: var(--kr-text-inverse) !important;
}

html[class*="-dark"] .dataTables_paginate .paginate_button.disabled,
html[class*="-dark"] .dataTables_paginate .paginate_button.disabled:hover {
  background-color: var(--kr-bg-surface) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-muted) !important;
  opacity: 0.6 !important;
  cursor: not-allowed !important;
}

html[class*="-dark"] .dataTables_paginate .paginate_button:not(.disabled):hover {
  background-color: var(--kr-bg-hover) !important;
  border-color: var(--kr-border-strong) !important;
  color: var(--kr-primary) !important;
}

html[class*="-dark"] .dataTables_paginate .paginate_button.current:hover {
  background-color: var(--kr-primary) !important;
  border-color: var(--kr-primary) !important;
  color: var(--kr-text-inverse) !important;
}

/* DataTables - Wrapper et conteneur */
html[class*="-dark"] .dataTables_wrapper {
  color: var(--kr-text-primary);
}

/* DataTables - Info, Filter, Length */
html[class*="-dark"] .dataTables_info,
html[class*="-dark"] .dataTables_filter,
html[class*="-dark"] .dataTables_length {
  color: var(--kr-text-secondary) !important;
}

html[class*="-dark"] .dataTables_filter label,
html[class*="-dark"] .dataTables_length label {
  color: var(--kr-text-secondary);
}

/* DataTables - Inputs et Selects */
html[class*="-dark"] .dataTables_filter input,
html[class*="-dark"] .dataTables_length select {
  background-color: var(--kr-bg-elevated) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
}

html[class*="-dark"] .dataTables_filter input:focus,
html[class*="-dark"] .dataTables_length select:focus {
  background-color: var(--kr-bg-elevated) !important;
  border-color: var(--kr-primary) !important;
  outline: none !important;
}

/* DataTables - Table principale */
html[class*="-dark"] table.dataTable {
  background-color: transparent !important;
  color: var(--kr-text-primary) !important;
}

/* DataTables - En-têtes */
html[class*="-dark"] table.dataTable thead th,
html[class*="-dark"] table.dataTable thead td {
  background-color: var(--kr-bg-elevated) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
}

html[class*="-dark"] table.dataTable thead th.sorting,
html[class*="-dark"] table.dataTable thead th.sorting_asc,
html[class*="-dark"] table.dataTable thead th.sorting_desc {
  background-color: var(--kr-bg-elevated) !important;
}

html[class*="-dark"] table.dataTable thead th.sorting:hover,
html[class*="-dark"] table.dataTable thead th.sorting_asc:hover,
html[class*="-dark"] table.dataTable thead th.sorting_desc:hover {
  background-color: var(--kr-bg-hover) !important;
}

/* DataTables - Corps de table (lignes) */
html[class*="-dark"] table.dataTable tbody tr {
  background-color: var(--kr-bg-surface) !important;
}

html[class*="-dark"] table.dataTable tbody tr.odd {
  background-color: var(--kr-bg-surface) !important;
}

html[class*="-dark"] table.dataTable tbody tr.even {
  background-color: var(--kr-bg-hover) !important;
}

html[class*="-dark"] table.dataTable tbody tr:hover {
  background-color: var(--kr-bg-active) !important;
}

/* DataTables - Cellules */
html[class*="-dark"] table.dataTable tbody td {
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
}

/* DataTables - Message "Aucune donnée" */
html[class*="-dark"] table.dataTable tbody td.dataTables_empty {
  background-color: var(--kr-bg-surface) !important;
  color: var(--kr-text-secondary) !important;
}

/* DataTables - Footer */
html[class*="-dark"] table.dataTable tfoot th,
html[class*="-dark"] table.dataTable tfoot td {
  background-color: var(--kr-bg-elevated) !important;
  border-color: var(--kr-border-default) !important;
  color: var(--kr-text-primary) !important;
}




/* ============================================================================
   MAP PAGE FIX - Carte au dessus des tableaux
   ============================================================================ */

/* Donner une hauteur au conteneur de la carte pour que le contenu en dessous 
   ne se superpose pas. La carte utilise des éléments en position absolue. */
body > div:has([id^="c"]) {
  display: block;
  position: relative;
  min-height: 550px; /* Hauteur de la carte + marge */
}

/* La balise MAP vide ne doit pas prendre de place */
body > map {
  display: none;
}


/* ============================================================================
   MOBILE RESPONSIVE - Compatibilité mobile (<768px)
   Ces styles ne s'appliquent QUE sur mobile et ne modifient PAS le desktop
   ============================================================================ */

@media (width <= 767px) {
  /* ==========================================================================
     FIX : Empêcher le scroll automatique vers les ancres au chargement
     ========================================================================== */
  
  html {
    overflow-anchor: none !important; /* Désactive l'ancrage automatique du scroll */
  }
  
  /* ==========================================================================
     PHASE 1 : CONTAINER RESPONSIVE
     Supprime le débordement horizontal causé par la largeur fixe
     ========================================================================== */
  
  .container {
    max-width: 100% !important;
    width: 100% !important;
    padding-left: 15px !important;
    padding-right: 15px !important;
  }
  
  
  /* ==========================================================================
     PHASE 2 : NAVBAR MOBILE AMÉLIORÉE
     Améliore l'ergonomie du menu hamburger et des icônes
     ========================================================================== */
  
  /* Fix du layout du header pour que logo et hamburger soient bien alignés */
  .navbar-header {
    display: flex !important;
    justify-content: center !important; /* Logo au centre */
    align-items: center !important;
    width: 100vw !important; /* Prend toute la largeur du viewport */
    position: relative !important; /* Pour positionner le toggle en absolu */
    margin-left: calc(-50vw + 50%) !important; /* Centre par rapport au viewport */
    margin-right: calc(-50vw + 50%) !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    height: 60px !important; /* Hauteur fixe pour centrage vertical */
  }
  
  .navbar-brand {
    float: none !important;
    margin: 0 !important; /* Centré par flexbox */
    display: flex !important;
    align-items: center !important;
    padding: 15px !important; /* Ajout d'un padding pour ne pas coller aux bords */
  }
  
  /* Boutons plus grands pour touch (minimum 44x44px recommandé) */
  .navbar-toggle {
    position: absolute !important; /* Position absolue pour le placer en haut à droite */
    right: 15px !important; /* Aligné à droite avec espacement */
    top: 50% !important;
    transform: translateY(-50%) !important; /* Centrage vertical parfait */
    padding: 8px !important;
    min-width: 48px !important;
    min-height: 48px !important;
    width: 48px !important;
    height: 48px !important;
    float: none !important;
    margin: 0 !important;
    border-radius: 12px !important; /* Coins plus arrondis, style moderne */
    border: none !important; /* Pas de bordure pour un style épuré */
    background: rgba(255, 255, 255, 0.15) !important;
    backdrop-filter: blur(10px) !important; /* Effet de flou moderne */
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 4px !important; /* Espacement réduit entre les barres */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important; /* Animation fluide */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important; /* Ombre légère */
  }
  
  .navbar-toggle:hover,
  .navbar-toggle:focus {
    background: rgba(255, 255, 255, 0.25) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
    transform: translateY(-50%) scale(1.05) !important; /* Léger effet de zoom */
  }
  
  .navbar-toggle:active {
    transform: translateY(-50%) scale(0.98) !important; /* Effet d'appui */
  }
  
  /* Barres du hamburger plus stylées et modernes */
  .navbar-toggle .icon-bar {
    width: 22px !important;
    height: 2px !important; /* Plus fines pour un look moderne */
    border-radius: 2px !important;
    background-color: #fff !important;
    display: block !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
  }
  
  /* Animation subtile au hover - Les barres s'écartent légèrement */
  .navbar-toggle:hover .icon-bar:nth-child(2) {
    width: 18px !important;
    margin-left: 4px !important;
  }
  
  .navbar-toggle:hover .icon-bar:nth-child(4) {
    width: 18px !important;
  }
  
  /* Menu déroulant pleine largeur - Respecte le comportement Bootstrap */
  .navbar-collapse {
    width: 100% !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
  }
  
  /* Quand le menu est ouvert (classe .in ajoutée par Bootstrap) */
  .navbar-collapse.in {
    overflow-y: auto !important;
    max-height: calc(100vh - 60px) !important;
  }
  
  /* Items de navigation plus espacés */
  .navbar-nav > li > a {
    padding: 15px 20px !important;
    font-size: 16px !important;
  }
  
  /* Icônes de la barre (notifications, messages) */
  .navbar-nav.navbar-right > li > a {
    padding: 15px 12px !important;
  }
  
  /* Logo plus petit sur mobile */
  .navbar-brand img.kr-logo {
    height: 24px !important;
  }
  
  
  /* ==========================================================================
     PHASE 3 : PAGE D'ACCUEIL MOBILE
     Réorganise les blocs pour une lecture verticale fluide
     ========================================================================== */
  
  /* Empiler les colonnes verticalement (sauf dans les modales) */
  body.mobile-mode > .container > .row > [class*="col-md-"],
  body.mobile-mode > .container > .row > [class*="col-sm-"],
  body.mobile-mode .container:not(.bootbox) > .row > [class*="col-md-"],
  body.mobile-mode .container:not(.bootbox) > .row > [class*="col-sm-"] {
    width: 100% !important;
    float: none !important;
    padding-left: 10px !important;
    padding-right: 10px !important;
    margin-bottom: 15px !important;
  }
  
  /* Carousel responsive */
  .carousel {
    margin-bottom: 20px !important;
  }
  
  .carousel .carousel-caption {
    position: relative !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: rgba(0, 0, 0, 0.7) !important;
    padding: 15px !important;
  }
  
  .carousel .carousel-caption h1 {
    font-size: 1.5rem !important;
    line-height: 1.3 !important;
  }
  
  .carousel .carousel-caption p {
    font-size: 0.95rem !important;
  }
  
  /* Images du carousel */
  .carousel-inner > .item > img {
    width: 100% !important;
    height: auto !important;
  }
  
  /* Masquer les statistiques (Membres actifs, Personnages actifs, etc.) en mobile */
  a.list-group-item.ds_users,
  a.list-group-item.ds_characters,
  a.list-group-item.ds_online {
    display: none !important;
  }
  
  /* N'afficher qu'une seule nouvelle en mode mobile */
  .panel-body.panel-news ul.demo li.news-item:nth-child(n+2) {
    display: none !important;
  }
  
  /* Réduire la taille des flèches de navigation dans la section nouvelles */
  .panel-default ul.pagination.pull-right > li > a {
    font-size: 12px !important;
    padding: 6px 10px !important;
    min-width: 32px !important;
    min-height: 32px !important;
    line-height: 1.2 !important;
  }
  
  /* Header "Nouvelles" avec croix à droite */
  .list-group-item.active {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 10px 15px !important;
  }
  
  #slide-submenu {
    flex-shrink: 0 !important;
    margin-left: 10px !important;
    cursor: pointer !important;
    font-size: 18px !important;
    line-height: 1 !important;
    padding: 4px 8px !important;
    background: transparent !important;
    border: none !important;
    color: inherit !important;
    transition: opacity 0.2s ease !important;
  }
  
  #slide-submenu:hover {
    opacity: 0.7 !important;
  }
  
  /* Masquer le contenu quand replié */
  #player-header-section.kr-news-collapsed .panel.panel-default {
    display: none !important;
  }
  
  /* Stats cards en grille 3 colonnes */
  .dashboard-cards-grid {
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 8px !important;
  }
  
  /* Cartes de dashboard plus compactes */
  .dashboard-card {
    padding: 10px !important;
  }
  
  .dashboard-card h4 {
    font-size: 1.1rem !important;
  }
  
  /* Panels responsive */
  .panel {
    margin-bottom: 15px !important;
  }
  
  .panel-heading {
    padding: 10px 15px !important;
    display: flex !important;
    align-items: center !important;
    flex-wrap: wrap !important;
    gap: 10px !important;
  }
  
  .panel-heading .pull-right {
    float: none !important;
    margin-left: auto !important;
    display: flex !important;
    align-items: center !important;
  }
  
  .panel-body {
    padding: 15px !important;
  }
  
  /* Réduire l'espace entre pagination et messages sur les pages de forum */
  .pagination {
    margin: 10px 0 !important;
  }
  
  /* Uniformiser la taille des boutons de pagination */
  .pagination > li > a,
  .pagination > li > span {
    width: 44px !important;
    height: 44px !important;
    min-width: 44px !important;
    min-height: 44px !important;
    max-width: 44px !important;
    max-height: 44px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 !important;
    line-height: 1 !important;
    box-sizing: border-box !important;
  }
  
  /* Réduire l'espace sous le h1 sur les pages de thread */
  h1.page-header {
    margin-bottom: 10px !important;
  }
  
  /* Ancres de messages ne doivent pas prendre d'espace */
  a[name^="msg"] {
    position: absolute !important;
    width: 0 !important;
    height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
  
  /* Wells plus compacts */
  .well {
    padding: 15px !important;
    margin-bottom: 15px !important;
  }
  
  /* Alerts responsive */
  .alert {
    padding: 12px 15px !important;
    margin-bottom: 15px !important;
  }
  
  /* Mini-chat : masqué par défaut sur mobile, accessible via bouton flottant */
  #flap {
    position: fixed !important;
    top: 0 !important;
    right: -100% !important;
    width: 85% !important;
    max-width: 320px !important;
    height: 100vh !important;
    z-index: 1050 !important;
    transition: right 0.3s ease !important;
    overflow-y: auto !important;
    background: var(--kr-bg-surface) !important;
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.3) !important;
  }
  
  #flap.mobile-open {
    right: 0 !important;
  }
  
  /* Bouton MC visible pour ouvrir le chat */
  a[href*="#flap"] {
    display: flex !important;
    position: fixed !important;
    bottom: 20px !important;
    right: 20px !important;
    z-index: 1000 !important;
    background: var(--kr-primary) !important;
    color: white !important;
    border-radius: 50% !important;
    width: 56px !important;
    height: 56px !important;
    align-items: center !important;
    justify-content: center !important;
    text-align: center !important;
    box-shadow: var(--kr-shadow-lg) !important;
    font-size: 18px !important;
    font-weight: bold !important;
    text-decoration: none !important;
  }
  
  
  /* ==========================================================================
     PHASE 4 : PAGE PLATEAU DE JEU MOBILE
     Réorganise l'interface de jeu pour le mobile
     ========================================================================== */
  
  /* === PANNEAU DE COMPÉTENCES === */

  /* Masquer le panneau latéral, accessible via bouton */
  #skills-panel {
    position: fixed !important;
    top: 0 !important;
    left: -100% !important;
    width: 85% !important;
    max-width: 320px !important;
    height: 100vh !important;
    z-index: 1050 !important;
    transition: left 0.3s ease !important;
    overflow-y: auto !important;
    background: var(--kr-bg-surface) !important;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3) !important;
    padding: 15px !important;
  }
  
  #skills-panel.mobile-open {
    left: 0 !important;
  }
  
  /* Conteneur parent du skills-panel */
  .col-md-1:has(#skills-panel) {
    position: static !important;
    width: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
  }
  
  /* Grille des compétences plus compacte sur mobile */
  #skills-panel .grid-transformed {
    display: grid !important;
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 8px !important;
  }
  
  /* === PANNEAU PERSONNAGE === */

  /* Toutes les colonnes en pleine largeur (page principale uniquement, pas les modales) */
  body.mobile-mode > .container > .row > .col-md-3,
  body.mobile-mode > .container > .row > .col-md-6,
  body.mobile-mode > .container > .row > .col-md-8,
  body.mobile-mode > .container > .row > .col-md-1 {
    width: 100% !important;
    float: none !important;
    padding-left: 15px !important;
    padding-right: 15px !important;
  }
  
  /* Avatar réduit */
  .panel-heading img {
    max-width: 60px !important;
    max-height: 60px !important;
  }
  
  /* Stats du personnage */
  .panel-body > div {
    margin-bottom: 10px !important;
  }
  
  /* Barres de progression */
  .progress {
    height: 24px !important;
    margin-bottom: 8px !important;
  }
  
  .progress-bar {
    font-size: 12px !important;
    line-height: 24px !important;
  }
  
  /* === CARTE DU JEU === */

  /* Carte avec scroll horizontal si nécessaire */
  .panel-body:has(map),
  .panel-body:has([id^="c"]) {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
    padding: 10px !important;
  }
  
  /* Conteneur de carte */
  body > div:has([id^="c"]) {
    min-height: 400px !important;
  }
  
  /* Images de la carte */
  map + img,
  [id^="c"] img {
    max-width: none !important;
    height: auto !important;
  }
  
  /* === LISTE DES PERSONNAGES === */

  /* En liste verticale compacte */
  .list-group {
    margin-bottom: 15px !important;
  }
  
  .list-group-item {
    padding: 10px 12px !important;
    min-height: 44px !important;
    justify-content: space-between !important;
    display: flex !important;
    align-items: center !important;
    gap: 10px !important;
  }
  
  /* Avatars de la liste réduits */
  .list-group-item img {
    width: 40px !important;
    height: 40px !important;
    flex-shrink: 0 !important;
  }
  
  /* Texte des items */
  .list-group-item-heading {
    font-size: 14px !important;
    margin-bottom: 4px !important;
  }
  
  .list-group-item-text {
    font-size: 12px !important;
  }
  
  /* === PANNEAU COMMERCE === */

  /* Items du commerce en liste compacte */
  .panel-body h4 {
    font-size: 1rem !important;
    margin-top: 15px !important;
    margin-bottom: 10px !important;
  }
  
  /* Items de commerce */
  .panel-body a {
    display: flex !important;
    align-items: center !important;
    padding: 8px !important;
    gap: 10px !important;
    font-size: 14px !important;
    margin-bottom: 5px !important;
    border-radius: 4px !important;
  }
  
  .panel-body a:hover {
    background-color: var(--kr-bg-hover) !important;
  }
  
  .panel-body a img {
    width: 32px !important;
    height: 32px !important;
    flex-shrink: 0 !important;
  }
  
  /* Tables responsive */
  .table-responsive {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
    margin-bottom: 15px !important;
  }
  
  /* Tables plus compactes */
  .table > thead > tr > th,
  .table > tbody > tr > th,
  .table > tfoot > tr > th,
  .table > thead > tr > td,
  .table > tbody > tr > td,
  .table > tfoot > tr > td {
    padding: 8px !important;
    font-size: 13px !important;
  }
  
  
  /* ==========================================================================
     PHASE 5 : ÉLÉMENTS TOUCH-FRIENDLY
     Assure que tous les éléments interactifs sont cliquables facilement
     ========================================================================== */
  
  /* Taille minimale des zones cliquables (44x44px minimum recommandé) */
  a:not(.list-group-item), 
  button, 
  .btn,
  input[type="button"],
  input[type="submit"],
  input[type="reset"] {
    min-height: 44px !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  
  /* Boutons de formulaire */
  .btn {
    padding: 12px 20px !important;
    font-size: 16px !important;
  }
  
  .btn-xs {
    min-height: 32px !important;
    padding: 6px 12px !important;
    font-size: 14px !important;
  }
  
  .btn-sm {
    min-height: 38px !important;
    padding: 8px 16px !important;
    font-size: 14px !important;
  }
  
  .btn-lg {
    min-height: 50px !important;
    padding: 14px 24px !important;
    font-size: 18px !important;
  }
  
  /* Formulaires */
  .form-control {
    height: 44px !important;
    font-size: 16px !important; /* Évite le zoom iOS */
    padding: 10px 12px !important;
  }
  
  textarea.form-control {
    height: auto !important;
    min-height: 100px !important;
  }
  
  select.form-control {
    height: 44px !important;
  }
  
  /* Checkboxes et radios plus grands */
  input[type="checkbox"],
  input[type="radio"] {
    width: 20px !important;
    height: 20px !important;
    margin: 4px !important;
  }
  
  /* Labels cliquables */
  label {
    display: inline-block !important;
    padding: 5px 0 !important;
    cursor: pointer !important;
  }
  
  /* Espacement entre éléments cliquables */
  .btn + .btn {
    margin-top: 8px !important;
    margin-left: 0 !important;
  }
  
  .btn-group-vertical > .btn {
    margin-top: 0 !important;
    margin-bottom: 8px !important;
  }
  
  /* Boutons groupés en colonne sur mobile */
  .btn-group {
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
  }
  
  .btn-group > .btn {
    width: 100% !important;
    margin-bottom: 8px !important;
  }
  
  /* Pagination plus grande */
  .pagination > li > a,
  .pagination > li > span {
    padding: 12px 16px !important;
    font-size: 16px !important;
  }
  
  /* Breadcrumb responsive */
  .breadcrumb {
    padding: 10px 15px !important;
    font-size: 14px !important;
  }
  
  /* Tabs plus grandes */
  .nav-tabs > li > a {
    padding: 12px 16px !important;
    font-size: 16px !important;
  }
  
  /* Dropdown menu */
  .dropdown-menu > li > a {
    padding: 12px 20px !important;
    font-size: 16px !important;
  }
  
  /* Modal responsive */
  .modal-dialog {
    width: auto !important;
    margin: 10px !important;
  }
  
  .modal-content {
    border-radius: 8px !important;
  }
  
  .modal-header {
    padding: 15px !important;
  }
  
  .modal-body {
    padding: 15px !important;
  }
  
  .modal-footer {
    padding: 15px !important;
  }
  
  /* Popover et tooltip responsive */
  .popover {
    max-width: calc(100vw - 40px) !important;
  }
  
  .tooltip {
    font-size: 14px !important;
  }
  
  /* Footer responsive */
  .footer {
    padding: 15px !important;
    font-size: 14px !important;
  }
  
  /* Typographie mobile */
  h1 { font-size: 1.75rem !important; }
  h2 { font-size: 1.5rem !important; }
  h3 { font-size: 1.25rem !important; }
  h4 { font-size: 1.1rem !important; }
  h5 { font-size: 1rem !important; }
  h6 { font-size: 0.9rem !important; }
  
  /* Espacement vertical */
  .row {
    margin-left: -10px !important;
    margin-right: -10px !important;
  }
  
  /* Masquer les éléments non essentiels sur mobile */
  .hidden-xs {
    display: none !important;
  }
  
  /* Afficher les éléments mobile uniquement */
  .visible-xs,
  .visible-xs-block,
  .visible-xs-inline,
  .visible-xs-inline-block {
    display: block !important;
  }
  
  .visible-xs-inline {
    display: inline !important;
  }
  
  .visible-xs-inline-block {
    display: inline-block !important;
  }
}


/* ==========================================================================
   OVERLAY MOBILE - Pour fermer les panneaux latéraux
   ========================================================================== */

.kr-mobile-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1040;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.kr-mobile-overlay.active {
  display: block;
  opacity: 1;
}

/* Bouton de fermeture dans les panneaux mobiles */
.kr-mobile-close {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 40px;
  height: 40px;
  background: var(--kr-primary);
  color: white;
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 10;
  font-size: 20px;
}

.kr-mobile-close:hover {
  background: var(--kr-primary-dark);
}

/* Bouton pour ouvrir le panneau de compétences sur mobile */
.kr-mobile-skills-toggle {
  position: fixed !important;
  bottom: 90px !important;
  right: 20px !important;
  z-index: 1000 !important;
  width: 56px !important;
  height: 56px !important;
  border-radius: 50% !important;
  padding: 0 !important;
  display: none !important;
  box-shadow: var(--kr-shadow-lg) !important;
}

@media (width <= 767px) {
  .kr-mobile-skills-toggle {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
}

/* ============================================
   TASK-1.1 - BREAKPOINTS (Bootstrap 3)
   ============================================ */

/* Bootstrap 3 utilise ces breakpoints précis :
   - xs: < 768px (mobile)
   - sm: >= 768px (tablet)
   - md: >= 992px (desktop)
   - lg: >= 1200px (large desktop)
*/

/* Mobile First approach */

/* Default styles = mobile (< 768px) */

/* Small devices (tablets, >= 768px) */
@media (width >= 768px) {
  /* Retour progressif au layout desktop */
  body.mobile-mode {
    /* Désactiver progressivement les adaptations mobiles */
  }
}

/* Medium devices (desktops, >= 992px) */
@media (width >= 992px) {
  /* Layout desktop complet */
  body.mobile-mode {
    /* Annuler complètement les adaptations mobiles */
  }
}

/* Large devices (large desktops, >= 1200px) */
@media (width >= 1200px) {
  /* Layout large desktop si nécessaire */
}

/* ============================================
   TASK-1.1 - CLASSES UTILITAIRES MOBILE
   ============================================ */

/* Masquer certains éléments en mode mobile */
@media (width <= 767px) {
  body.mobile-mode .desktop-only,
  body.mobile-mode .mobile-hidden {
    display: none;
  }
}

/* Masquer certains éléments en mode desktop */
@media (width >= 768px) {
  body.mobile-mode .mobile-only {
    display: none;
  }
}

/* Classes utilitaires supplémentaires compatibles BS3 */
@media (width < 768px) {
  .visible-xs-block { display: block; }
  .visible-xs-inline { display: inline; }
  .visible-xs-inline-block { display: inline-block; }
  .hidden-xs { display: none; }
}

/* ============================================
   TASK-1.4 - MINI-PROFIL COLLAPSIBLE
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Container du mini-profil */
    .mobile-mini-profile {
      position: relative;
      background: var(--kr-bg-surface) !important;
      border-bottom: 1px solid var(--kr-border-default) !important;
      padding: 12px;
      cursor: pointer;
      transition: all var(--transition-normal);
    }
    
    .mobile-mini-profile:active {
      background: var(--kr-bg-hover) !important;
    }
    
    /* État replié (défaut) */
    .mobile-mini-profile.collapsed {
      min-height: 72px;
    }
    
    /* État déplié */
    .mobile-mini-profile.expanded {
      min-height: 200px;
    }
    
    /* Header toujours visible */
    .mobile-mini-profile-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    
    /* Avatar */
    .mobile-mini-profile .avatar {
      width: 48px !important;
      height: 48px !important;
      border-radius: 4px;
      flex-shrink: 0;
      transition: all var(--transition-normal);
      object-fit: cover;
    }
    
    .mobile-mini-profile.expanded .avatar {
      width: 64px !important;
      height: 64px !important;
    }
    
    /* Info principale */
    .mobile-mini-profile-info {
      flex: 1;
      min-width: 0;
    }
    
    .mobile-mini-profile-name-row {
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      gap: 8px !important;
      margin-bottom: 2px !important;
    }
    
    .mobile-mini-profile-name {
      font-weight: 600 !important;
      font-size: 14px !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      color: var(--kr-text-primary) !important;
      flex: 1 !important;
    }
    
    .mobile-mini-profile-manage-btn {
      min-width: 44px !important;
      min-height: 44px !important;
      padding: 8px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      font-size: 20px !important;
      flex-shrink: 0 !important;
      border: none !important;
      background: var(--kr-bg-surface) !important;
    }
    
    .mobile-mini-profile-manage-btn:active {
      background: var(--kr-bg-hover) !important;
    }
    
    .mobile-mini-profile-money {
      display: flex !important;
      align-items: center !important;
      gap: 4px !important;
      font-size: 13px !important;
      color: var(--kr-text-secondary) !important;
    }
    
    .mobile-mini-profile-clock {
      font-size: 12px !important;
      color: var(--kr-text-muted) !important;
      margin-left: 8px !important;
    }
    
    /* Bouton settings */
    .mobile-mini-profile-settings {
      position: absolute !important;
      top: 12px !important;
      right: 12px !important;
      width: 32px !important;
      height: 32px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      background: var(--kr-bg-hover) !important;
      border-radius: 50% !important;
      cursor: pointer !important;
      font-size: 16px !important;
      z-index: 10 !important;
      text-decoration: none !important;
    }
    
    .mobile-mini-profile-settings:hover {
      background: var(--kr-bg-active) !important;
    }
    
    /* Jauges compactes (toujours visibles) */
    .mobile-mini-profile-gauges-compact {
      display: flex !important;
      gap: 8px !important;
      font-size: 11px !important;
      margin-top: 4px !important;
    }
    
    .mobile-gauge-compact {
      flex: 1 !important;
      display: flex !important;
      align-items: center !important;
      gap: 2px !important;
    }
    
    .mobile-gauge-compact-label {
      font-weight: 600 !important;
      min-width: 20px !important;
      font-size: 10px !important;
    }
    
    .mobile-gauge-compact-bar {
      flex: 1 !important;
      height: 6px !important;
      background: var(--kr-border-default) !important;
      border-radius: 3px !important;
      overflow: hidden !important;
      position: relative !important;
    }
    
    .mobile-gauge-compact-fill {
      position: absolute !important;
      left: 0 !important;
      top: 0 !important;
      height: 100% !important;
      transition: width var(--transition-normal) !important;
    }
    
    .mobile-gauge-compact-fill.pv {
      background: var(--kr-gauge-pv) !important;
    }
    
    .mobile-gauge-compact-fill.pm {
      background: var(--kr-gauge-pm) !important;
    }
    
    .mobile-gauge-compact-fill.pp {
      background: var(--kr-gauge-pp) !important;
    }
    
    .mobile-gauge-compact-value {
      font-size: 10px !important;
      color: var(--kr-text-secondary) !important;
      white-space: nowrap !important;
      min-width: 20px !important;
      text-align: right !important;
    }
    
    /* Détails (visibles uniquement si déplié) */
    .mobile-mini-profile-details {
      max-height: 0 !important;
      overflow: hidden !important;
      transition: max-height var(--transition-normal) !important;
    }
    
    .mobile-mini-profile.expanded .mobile-mini-profile-details {
      max-height: 1200px !important;
    }
    
    /* Jauges détaillées */
    .mobile-mini-profile-gauges-full {
      margin: 12px 0 !important;
      padding: 12px !important;
      background: var(--kr-bg-surface) !important;
      border: 1px solid var(--kr-border-default) !important;
      border-radius: 4px !important;
    }
    
    .mobile-gauge-full {
      margin-bottom: 8px !important;
    }
    
    .mobile-gauge-full:last-child {
      margin-bottom: 0 !important;
    }
    
    .mobile-gauge-full-header {
      display: flex !important;
      justify-content: space-between !important;
      font-size: 12px !important;
      font-weight: 600 !important;
      margin-bottom: 4px !important;
    }
    
    .mobile-gauge-full-bar {
      height: 12px !important;
      background: var(--kr-border-default) !important;
      border-radius: 6px !important;
      overflow: hidden !important;
      position: relative !important;
    }
    
    .mobile-gauge-full-fill {
      position: absolute !important;
      left: 0 !important;
      top: 0 !important;
      height: 100% !important;
      transition: width var(--transition-normal) !important;
    }
    
    .mobile-gauge-full-fill.pv {
      background: var(--kr-gauge-pv) !important;
    }
    
    .mobile-gauge-full-fill.pm {
      background: var(--kr-gauge-pm) !important;
    }
    
    .mobile-gauge-full-fill.pp {
      background: var(--kr-gauge-pp) !important;
    }
    
    /* Caractéristiques */
    .mobile-mini-profile-characteristics {
      display: grid !important;
      grid-template-columns: repeat(6, 1fr) !important;
      gap: 0 !important;
      margin: 12px 0 !important;
      padding: 12px !important;
      background: var(--kr-bg-surface) !important;
      border: 1px solid var(--kr-border-default) !important;
      border-radius: 4px !important;
    }
    
    .mobile-characteristic-badge {
      min-width: 44px !important;
      min-height: 44px !important;
      margin: 4px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    .mobile-characteristic-badge:active {
      background: var(--kr-bg-hover) !important;
    }
    
    /* Compétences */
    .mobile-mini-profile-skills {
      max-height: 350px !important;
      overflow-y: auto !important;
      -webkit-overflow-scrolling: touch !important;
      margin: 12px 0 !important;
      padding: 12px !important;
      background: var(--kr-bg-surface) !important;
      border: 1px solid var(--kr-border-default) !important;
      border-radius: 4px !important;
      display: grid !important;
      grid-template-columns: repeat(auto-fill, minmax(44px, 1fr)) !important;
      gap: 8px !important;
    }
    
    .mobile-skill-item {
      min-height: 44px !important;
      margin: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    .mobile-skill-item:active {
      background: var(--kr-bg-hover) !important;
    }
    
    /* Masquer le profil original en mobile */
    #player-header-section {
      display: none !important;
    }
    
    /* Masquer la section actions originale en mobile */
    #player-actions-section {
      display: none !important;
    }
  }
}

/* ============================================
   TASK-1.6 - MASQUER 18 COMPÉTENCES
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Masquer le panel des 18 compétences */

    /* Les compétences sont accessibles via l'onglet "Personnage" (/jouer/perso) */
    .panel-body.grid-transformed {
      display: none !important;
    }
    
    /* Masquer le bouton "Afficher les compétences" */
    .kr-mobile-skills-toggle {
      display: none !important;
    }
    
    /* Masquer l'overlay des compétences si présent */
    .kr-mobile-overlay {
      display: none !important;
    }
  }
}

/* ============================================
   TASK-1.5 - ACTIONS RAPIDES (Bootstrap 3)
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Container actions - Utilise btn-group-justified BS3 */
    .mobile-quick-actions.btn-group-justified {
      display: flex !important;
      flex-direction: row !important;
      width: 100% !important;
      border-bottom: 1px solid var(--kr-border-default) !important;
      background: var(--kr-bg-surface) !important;
    }
    
    /* Wrapper btn-group requis par BS3 justified */
    .mobile-quick-actions .btn-group {
      flex: 1 1 0 !important;
      display: flex !important;
    }
    
    /* Bouton d'action individuel - Réutilise btn BS3 */
    .mobile-quick-action.btn {
      display: flex !important;
      flex-direction: column !important;
      align-items: center !important;
      justify-content: center !important;
      flex: 1 !important;
      width: 100% !important;
      min-height: 60px !important;
      padding: 8px 4px !important;
      background: var(--kr-bg-surface) !important;
      color: var(--kr-text-primary) !important;
      border-radius: 0 !important;
      border-left: none !important;
      border-right: 1px solid var(--kr-border-default) !important;
      border-top: none !important;
      border-bottom: none !important;
      transition: all var(--transition-fast) !important;
    }
    
    .mobile-quick-action.btn:first-child {
      border-left: 1px solid var(--kr-border-default) !important;
    }
    
    .mobile-quick-action.btn:last-child {
      border-right: 1px solid var(--kr-border-default) !important;
    }
    
    .mobile-quick-action.btn:active {
      box-shadow: inset 0 3px 5px var(--kr-overlay-dark-125) !important;
      transform: scale(0.95) !important;
    }
    
    .mobile-quick-action.btn.disabled,
    .mobile-quick-action.btn[disabled] {
      opacity: 0.65 !important;
      cursor: not-allowed !important;
    }
    
    /* Icône */
    .mobile-quick-action-icon {
      font-size: 20px !important;
      margin-bottom: 2px !important;
      display: block !important;
    }
    
    .mobile-quick-action.btn i {
      font-size: 20px !important;
      margin-bottom: 2px !important;
      display: block !important;
    }
    
    /* Label */
    .mobile-quick-action-label {
      font-size: 11px !important;
      display: block !important;
      line-height: 1.2 !important;
      margin-top: 2px !important;
    }
  }
}

/* ============================================
   TASK-1.3 - TAB BAR NAVIGATION (Bootstrap 3)
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Tab bar container - Utilise nav-tabs BS3 */
    .mobile-tab-bar.nav-tabs {
      position: sticky;
      top: var(--mobile-header-height);
      z-index: calc(var(--z-header) - 1);
      background: var(--kr-bg-surface) !important;
      border-bottom: 2px solid var(--kr-border-default) !important;
      margin-bottom: 0;
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
      
      /* Masquer scrollbar */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE/Edge */
    }
    
    .mobile-tab-bar.nav-tabs::-webkit-scrollbar {
      display: none; /* Chrome/Safari */
    }
    
    /* Tabs individuels - Utilise les styles BS3 */
    .mobile-tab-bar.nav-tabs > li {
      flex: 1 1 0; /* Répartition égale */
      float: none;
      min-width: 0; /* Permet le shrink */
    }
    
    .mobile-tab-bar.nav-tabs > li > a {
      min-height: var(--mobile-touch-target);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px 4px;
      margin-right: 0;
      border-radius: 0;
      border: none;
      border-bottom: 3px solid transparent;
      transition: all var(--transition-fast);
      color: var(--kr-text-primary) !important;
      background: transparent !important;
    }
    
    /* Icône de tab */
    .mobile-tab-icon {
      font-size: 18px !important;
      margin-bottom: 4px !important;
      display: block !important;
    }
    
    /* Label de tab */
    .mobile-tab-label {
      font-size: 10px !important;
      display: block !important;
      line-height: 1.2 !important;
      text-align: center !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      max-width: 100% !important;
    }
    
    .mobile-tab-bar.nav-tabs > li > a:hover {
      background: var(--kr-bg-hover) !important;
      border-color: transparent;
    }
    
    .mobile-tab-bar.nav-tabs > li.active > a,
    .mobile-tab-bar.nav-tabs > li.active > a:hover,
    .mobile-tab-bar.nav-tabs > li.active > a:focus {
      color: var(--kr-primary);
      background: transparent;
      border-bottom-color: var(--kr-primary);
      font-weight: 600;
    }
    
    /* Badge notifications (utilise badge BS3) */
    .mobile-tab-bar.nav-tabs .badge {
      margin-left: var(--mobile-spacing-xs);
    }
    
    /* Indicateur de scroll (optionnel) */
    .mobile-tab-bar.nav-tabs::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 20px;
      background: linear-gradient(to right, transparent, var(--kr-bg-surface));
      pointer-events: none;
    }
    
    .mobile-tab-bar.nav-tabs.scrolled-end::after {
      display: none;
    }
  }
}

/* ============================================
   TASK-1.2 - HEADER RESPONSIVE (Bootstrap 3)
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Header principal - Utilise les classes BS3 */
    .navbar,
    .navbar-default,
    .navbar-inverse {
      position: sticky;
      top: 0;
      z-index: var(--z-header);
      background: var(--kr-navbar-bg);
      border-bottom: 1px solid var(--kr-overlay-light-10);
      box-shadow: 0 2px 4px var(--kr-overlay-dark-30);
      margin-bottom: 0;
      min-height: var(--mobile-header-height);
    }
    
    .navbar .container {
      padding-left: 10px;
      padding-right: 10px;
    }
    
    /* Zone gauche - Hamburger (réutilise navbar-toggle BS3) */
    .navbar-toggle {
      display: block;
      margin: 8px 10px;
      padding: 9px 10px;
      border: 1px solid var(--kr-overlay-light-20);
      order: 1;
      margin-right: 0;
      margin-left: auto;
      border-radius: 4px;
      background: transparent;
    }
    
    .navbar-toggle:hover,
    .navbar-toggle:focus {
      background: var(--kr-overlay-light-10);
    }
    
    .navbar-toggle .icon-bar {
      background-color: var(--kr-white);
    }
    
    /* Logo visible dans la navbar à gauche */
    .navbar-header .navbar-brand {
      display: flex !important;
      align-items: center;
      padding: 8px 12px !important;
      margin-right: auto !important;
      height: var(--mobile-header-height);
      min-width: 44px; /* Zone tactile minimum WCAG 2.5.5 */
    }
    
    .navbar-header .navbar-brand img {
      max-height: 32px;
      width: auto;
    }
    
    /* Feedback tactile */
    .navbar-header .navbar-brand:active {
      background: var(--kr-overlay-dark-20);
      transform: scale(0.95);
    }
    
    /* Cacher le logo déplacé sous la navbar */
    .navbar-brand[data-moved-below-navbar] {
      display: none !important;
    }
    
    /* Boutons déplacés dans le header */
    .navbar-header-buttons-left,
    .navbar-header-buttons-right {
      display: flex;
      align-items: center;
      height: var(--mobile-header-height);
    }
    
    .navbar-header-buttons-left {
      order: -1; /* Place à gauche avant le toggle */
      padding-left: 8px;
    }
    
    .navbar-header-buttons-right {
      order: 2; /* Avant le logo */
      margin-left: auto; /* Pousse à droite */
      padding-right: 8px;
    }
    
    .navbar-header-buttons-left li,
    .navbar-header-buttons-right li {
      list-style: none;
      display: inline-block;
      margin: 0 2px;
    }
    
    .navbar-header-buttons-left li a,
    .navbar-header-buttons-right li a {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 44px !important;
      min-height: 44px !important;
      padding: 10px !important;
      font-size: 18px;
      color: var(--kr-white) !important;
      text-decoration: none;
      border-radius: 4px;
      transition: background-color 150ms ease;
      position: relative;
    }
    
    .navbar-header-buttons-left li a:active,
    .navbar-header-buttons-right li a:active {
      background-color: var(--kr-overlay-light-10);
    }
    
    /* Badge dans le header */
    .navbar-header-buttons-left .badge,
    .navbar-header-buttons-right .badge {
      position: absolute !important;
      top: 6px !important;
      right: 6px !important;
      min-width: 16px !important;
      height: 16px !important;
      padding: 2px 4px !important;
      font-size: 10px !important;
      line-height: 12px !important;
      border-radius: 8px !important;
    }
    
    /* Réorganiser l'ordre des éléments du header */
    .navbar-header {
      display: flex;
      align-items: center;
      width: 100%;
    }
    
    /* Zone droite - Icônes (conservées telles quelles) */
    .navbar-right {
      margin: 0 !important;
      padding: 8px 0 !important;
      border-top: 1px solid var(--kr-overlay-light-10) !important;
    }
    
    .navbar-right > li > a {
      padding: 15px 10px;
    }
    
    /* Menu mobile - Utilise navbar-collapse BS3 */
    .navbar-collapse {
      border-top: 1px solid var(--kr-overlay-light-10);
      box-shadow: inset 0 1px 0 var(--kr-overlay-light-05);
      max-height: calc(100vh - var(--mobile-header-height));
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .navbar-collapse.in,
    .navbar-collapse.collapsing {
      overflow-y: auto;
      height: auto !important; /* Force hauteur auto pour éviter les problèmes de collapse.js */
    }
    
    /* Navigation dans le collapse */
    .navbar-nav {
      margin: 0;
      padding: 8px 0;
    }
    
    /* Liens principaux du menu - optimisés pour le tactile */
    .navbar-nav > li > a {
      min-height: 44px !important; /* WCAG 2.5.5 - zone tactile minimum */
      padding: 14px 20px !important;
      font-size: 16px !important; /* Évite le zoom automatique iOS */
      line-height: 1.5 !important;
      display: flex !important;
      align-items: center !important;
      border-bottom: 1px solid var(--kr-overlay-light-05) !important;
      transition: background-color 150ms ease !important;
    }
    
    /* Feedback tactile au toucher */
    .navbar-nav > li > a:active {
      background: var(--kr-overlay-light-10) !important;
      transition: none !important;
    }
    
    /* Masquer les carets (chevrons) en mobile - navigation directe */
    .navbar-nav > li > a .caret {
      display: none !important;
    }
    
    /* Dropdowns dans le menu mobile - masqués par défaut car navigation directe */
    .navbar-nav .dropdown-menu {
      display: none !important; /* Masquer les sous-menus en mobile */
    }
    
    .navbar-right > li {
      display: inline-block !important;
    }
    
    .navbar-right > li > a,
    .navbar-right > li > button {
      min-width: 44px !important; /* Zone tactile minimum */
      min-height: 44px !important;
      padding: 12px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      font-size: 18px !important; /* Icônes plus grandes */
      border-radius: 4px !important;
      margin: 0 4px !important;
    }
    
    .navbar-right > li > a:active,
    .navbar-right > li > button:active {
      background: var(--kr-overlay-light-10) !important;
    }
    
    /* Badge de notification */
    .navbar-right .badge {
      position: absolute !important;
      top: 8px !important;
      right: 8px !important;
      min-width: 18px !important;
      height: 18px !important;
      padding: 2px 5px !important;
      font-size: 11px !important;
      line-height: 14px !important;
    }
  }
}

/* ============================================
   TASK-2.2 - ACCORDÉON GROUPES (Base)
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Header de groupe avec accordéon */
    .dashboard-section-header-accordion {
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: background-color var(--transition-fast);
    }
    
    .dashboard-section-header-accordion:active {
      background-color: var(--kr-overlay-light-05);
    }
    
    /* Icône chevron pour l'accordéon */
    .dashboard-section-header-accordion .accordion-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%) rotate(0deg);
      transition: transform var(--transition-normal);
      color: var(--kr-text-secondary);
      font-size: 14px;
      pointer-events: none;
    }
    
    /* Rotation de l'icône quand le groupe est ouvert */
    .dashboard-section-header-accordion.expanded .accordion-icon {
      transform: translateY(-50%) rotate(-180deg);
    }
    
    /* Grille de membres collapsible */
    .dashboard-cards-grid {
      overflow: hidden;
      transition: max-height var(--transition-normal) ease-in-out,
                  opacity var(--transition-normal) ease-in-out,
                  margin var(--transition-fast);
      max-height: 5000px; /* Grande valeur pour le contenu étendu */
      opacity: 1;
    }
    
    /* État collapsed */
    .dashboard-cards-grid.collapsed {
      max-height: 0;
      opacity: 0;
      margin: 0;
      pointer-events: none;
    }
    
    /* Espacement pour les groupes */
    .dashboard-section {
      margin-bottom: 10px;
    }
    
    /* Mon groupe - style spécial */
    .dashboard-section-mygroup .dashboard-section-header {
      background: var(--kr-bg-hover);
      border-left: 3px solid var(--kr-primary);
    }
  }
}

/* ============================================
   TASK-2.3 - CARDS PERSOS (Mobile Optimized)
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Grille de cartes compacte */
    .dashboard-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 8px;
      padding: 10px;
      background: var(--kr-bg-surface);
    }
    
    /* Carte de personnage compacte */
    .dashboard-card {
      position: relative;
      width: 100%;
      min-height: 140px;
      margin: 0;
    }
    
    /* Lien principal de la carte */
    .dashboard-card-link {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 4px;
      background: var(--kr-bg-hover);
      border: 1px solid var(--kr-border-default);
      border-radius: 8px;
      text-decoration: none;
      transition: all var(--transition-fast);
    }
    
    .dashboard-card-link:hover,
    .dashboard-card-link:active {
      background: var(--kr-bg-active);
      border-color: var(--kr-primary);
      transform: translateY(-1px);
    }
    
    /* Header avec avatar */
    .dashboard-card-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      margin-bottom: 6px;
    }
    
    /* Wrapper d'avatar avec cercle HP */
    .dashboard-card-avatar-wrapper {
      position: relative;
      width: 60px;
      height: 60px;
      margin-bottom: 4px;
    }
    
    /* Cercle de vie (HP) */
    .dashboard-card-hp-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px !important;
      height: 60px !important;
    }
    
    .dashboard-card-hp-circle circle {
      stroke-width: 2 !important;
    }
    
    /* Avatar du personnage */
    .dashboard-card-avatar {
      position: relative;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      margin: 5px;
      z-index: 1;
    }
    
    /* Container du nom */
    .dashboard-card-name-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      gap: 2px;
    }
    
    /* Icône du monde */
    .dashboard-card-world {
      width: 14px;
      height: 14px;
      opacity: 0.6;
    }
    
    /* Nom du personnage */
    .dashboard-card-name {
      font-size: 11px;
      font-weight: 500;
      color: var(--kr-text-primary);
      text-align: center;
      line-height: 1.2;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      word-break: break-all;
    }
    
    /* Body avec statut */
    .dashboard-card-body {
      width: 100%;
      padding: 0 2px;
    }
    
    /* Statut du personnage */
    .dashboard-card-status {
      font-size: 9px;
      color: var(--kr-text-secondary);
      text-align: center;
      font-style: italic;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    /* Badge PNJ */
    .dashboard-card-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background: var(--kr-primary);
      color: var(--kr-text-primary);
      font-size: 8px;
      font-weight: 600;
      padding: 2px 4px;
      border-radius: 4px;
      text-transform: uppercase;
      z-index: 2;
    }
    
    /* Actions (profil, message) */
    .dashboard-card-actions {
      display: flex;
      gap: 8px;
      justify-content: center;
      padding: 6px 4px 4px;
      border-top: 1px solid var(--kr-border-default);
      margin-top: 6px;
    }
    
    .dashboard-card-actions a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: var(--kr-bg-surface);
      border: 1px solid var(--kr-border-default);
      border-radius: 6px;
      color: var(--kr-text-secondary);
      transition: all var(--transition-fast);
      text-decoration: none;
    }
    
    .dashboard-card-actions a:hover {
      background: var(--kr-primary);
      border-color: var(--kr-primary);
      color: var(--kr-text-primary);
      transform: scale(1.1);
    }
    
    .dashboard-card-actions i {
      font-size: 13px;
    }
  }
}

/* ============================================================================
 * TASK-2.5 : Commerce - Accordéon catégories
 * ============================================================================
 */

/* Header de catégorie cliquable */
body.mobile-mode .commerce-category-header {
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  position: relative;
  transition: background-color var(--transition-fast);
}

body.mobile-mode .commerce-category-header:hover {
  background-color: var(--kr-bg-hover);
}

body.mobile-mode .commerce-category-header:active {
  background-color: var(--kr-bg-active);
}

/* Icône chevron */
body.mobile-mode .commerce-category-header .accordion-icon {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  transition: transform var(--transition-normal);
  font-size: 14px;
  color: var(--kr-text-secondary);
}

body.mobile-mode .commerce-category-header.expanded .accordion-icon {
  transform: translateY(-50%) rotate(-180deg);
}

/* Conteneur de produits collapsible */
body.mobile-mode .commerce-products-container {
  max-height: 5000px;
  opacity: 1;
  overflow: hidden;
  transition: max-height var(--transition-normal), opacity var(--transition-normal);
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 8px;
  padding: 8px 0;
}

body.mobile-mode .commerce-products-container.collapsed {
  max-height: 0 !important;
  opacity: 0;
}

/* ============================================================================
 * TASK-2.6 : Commerce - Cards produits compactes
 * ============================================================================
 */

/* Carte produit compacte */
body.mobile-mode .commerce-products-container > a.list-group-item {
  display: flex !important;
  flex-direction: column;
  padding: 8px !important;
  min-height: 120px;
  border-radius: 8px;
  background-color: var(--kr-bg-surface);
  border: 1px solid var(--kr-border-default);
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}

body.mobile-mode .commerce-products-container > a.list-group-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

/* Prix en haut à droite */
body.mobile-mode .commerce-products-container > a.list-group-item .mention {
  position: absolute;
  top: 4px;
  right: 4px;
  float: none !important;
  font-size: 10px;
  line-height: 1.2;
  text-align: right;
  background-color: rgba(0, 0, 0, 0.6);
  padding: 2px 4px;
  border-radius: 4px;
}

body.mobile-mode .commerce-products-container > a.list-group-item .mention .xmini {
  font-size: 9px;
  opacity: 0.8;
}

/* Image centrée */
body.mobile-mode .commerce-products-container > a.list-group-item img {
  float: none !important;
  display: block;
  margin: 0 auto 8px;
  width: 40px;
  height: 40px;
}

/* Titre du produit */
body.mobile-mode .commerce-products-container > a.list-group-item h4 {
  font-size: 11px;
  line-height: 1.3;
  margin: 0 0 4px;
  text-align: center;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  word-break: break-all;
}

/* Description (optionnel, peut être masquée sur mobile) */
body.mobile-mode .commerce-products-container > a.list-group-item p {
  font-size: 9px;
  line-height: 1.2;
  margin: 0;
  text-align: center;
  color: var(--kr-text-secondary);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Masquer l'icône carré de la description */
body.mobile-mode .commerce-products-container > a.list-group-item p i {
  display: none;
}

/* ============================================================================
 * TASK-2.4 : Section bâtiment collapsible
 * ============================================================================
 */

/* Header de section bâtiment cliquable */
body.mobile-mode .building-section-header {
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  position: relative;
  transition: background-color var(--transition-fast);
}

body.mobile-mode .building-section-header:hover {
  background-color: var(--kr-bg-hover);
}

body.mobile-mode .building-section-header:active {
  background-color: var(--kr-bg-active);
}

/* Icône chevron */
body.mobile-mode .building-section-header .accordion-icon {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  transition: transform var(--transition-normal);
  font-size: 14px;
  color: var(--kr-text-secondary);
}

body.mobile-mode .building-section-header.expanded .accordion-icon {
  transform: translateY(-50%) rotate(-180deg);
}

/* Contenu collapsible */
body.mobile-mode .building-section-content {
  max-height: 5000px;
  opacity: 1;
  overflow: hidden;
  transition: max-height var(--transition-normal), opacity var(--transition-normal);
}

body.mobile-mode .building-section-content.collapsed {
  max-height: 0 !important;
  opacity: 0;
}

/* ============================================================================
 * TASK-2.1 : Accès aux pièces en ligne horizontale avec croix directionnelle
 * Style identique aux actions rapides (Dormir, Prier, etc.)
 * ============================================================================ */

/* Conteneur principal : table layout comme mobile-quick-actions */
body.mobile-mode .kr-navigation-row {
  display: table !important;
  width: 100%;
  table-layout: fixed;
  margin-bottom: 5px;
  border-collapse: separate;
  border-spacing: 0;
}

/* Réduire l'espacement du container suivant */
body.mobile-mode .kr-navigation-row + .container {
  padding-top: 10px !important;
}

/* Groupes (croix + cartes) - affichage en cellules de table */
body.mobile-mode .kr-navigation-row > .btn-group {
  display: table-cell !important;
  width: 1%;
  vertical-align: middle;
  float: none !important;
}

/* Croix directionnelle - même style que les actions rapides */
body.mobile-mode .kr-direction-link {
  display: flex !important;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 60px !important;
  padding: 0 !important;
  text-align: center;
  position: relative;
}

body.mobile-mode .kr-direction-link img {
  width: 60px;
  height: 60px;
  display: block;
}

body.mobile-mode .kr-direction-link map {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* Cases des accès aux pièces - même style que mobile-quick-action */
body.mobile-mode .kr-room-link {
  display: flex !important;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 60px !important;
  padding: 0 !important;
  text-align: center;
  font-size: 10px;
  line-height: 1.2;
}

body.mobile-mode .kr-room-link img {
  width: 60px;
  height: 60px;
  display: block;
}

/* Premier élément : bordures arrondies à gauche */
body.mobile-mode .kr-navigation-row > .btn-group:first-child .kr-direction-link,
body.mobile-mode .kr-navigation-row > .btn-group:first-child .kr-room-link {
  border-radius: 4px 0 0 4px;
}

/* Dernier élément : bordures arrondies à droite */
body.mobile-mode .kr-navigation-row > .btn-group:last-child .kr-room-link {
  border-radius: 0 4px 4px 0;
}

/* Éléments du milieu : pas de bordure gauche pour éviter le doublon */
body.mobile-mode .kr-navigation-row > .btn-group:not(:first-child) .kr-direction-link,
body.mobile-mode .kr-navigation-row > .btn-group:not(:first-child) .kr-room-link {
  border-left: none;
}

/* Si un seul élément : bordures arrondies partout */
body.mobile-mode .kr-navigation-row > .btn-group:only-child .kr-direction-link,
body.mobile-mode .kr-navigation-row > .btn-group:only-child .kr-room-link {
  border-radius: 4px;
}

/* ============================================
   GROUPES DE PERSONNAGES - STYLE BARRE
   ============================================ */

@media (width <= 767px) {
  body.mobile-mode {
    /* Mode mobile activé */
  }
  
  /* Retrait padding conteneurs et colonnes Bootstrap en mobile */
  body.mobile-mode .container,
  body.mobile-mode .container-fluid,
  body.mobile-mode [class*="col-"] {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
  
  body.mobile-mode .row {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  /* Conteneur dashboard pleine largeur */
  body.mobile-mode .dashboard {
    margin-left: 0 !important;
    margin-right: 0 !important;
    width: 100% !important;
    padding: 0 !important;
  }
    
    /* Style du panel-group pour ressembler aux barres du dessus */
    .panel-group {
      background: var(--kr-bg-surface) !important;
      border: 1px solid var(--kr-border-default) !important;
      border-left: none !important;
      border-right: none !important;
      border-radius: 0 !important;
      margin-bottom: 5px !important;
      margin-left: -15px !important;
      margin-right: -15px !important;
      width: calc(100% + 30px) !important;
    }
    
    /* Panel individuel */
    .panel-group .panel {
      background: transparent !important;
      border: none !important;
      border-radius: 0 !important;
      margin-bottom: 0 !important;
      box-shadow: none !important;
    }
    
    /* Séparateur entre les panels */
    .panel-group .panel + .panel {
      border-top: 1px solid var(--kr-border-default) !important;
    }
    
    /* Header du groupe - style barre */
    .panel-group .panel-heading {
      background: var(--kr-bg-surface) !important;
      border: none !important;
      border-radius: 0 !important;
      padding: 12px 0 !important;
      margin: 0 !important;
      align-items: center !important;
      transition: background-color var(--transition-fast) !important;
    }
    
    .panel-group .panel-heading:active {
      background: var(--kr-bg-hover) !important;
    }
    
    /* Contenu du groupe */
    .panel-group .panel-collapse {
      border: none !important;
    }
    
    .panel-group .panel-body {
      background: var(--kr-bg-surface) !important;
      border: none !important;
      padding: 10px 0 !important;
    }
    
    /* Titre du groupe */
    .panel-group .panel-title {
      font-size: 14px !important;
      font-weight: 500 !important;
      color: var(--kr-text-primary) !important;
    }
    
    .panel-group .panel-title a {
      display: block !important;
      color: var(--kr-text-primary) !important;
      text-decoration: none !important;
    }
    
    .panel-group .panel-title a:hover {
      color: var(--kr-text-primary) !important;
    }
    
    /* ========================================================================
       MODAL / DIALOG MOBILE OPTIMIZATIONS
       ======================================================================== */
    
    /* Modal backdrop - assombrir légèrement */
    body.mobile-mode .modal-backdrop {
      background-color: rgba(0, 0, 0, 0.6) !important;
    }
    
    /* Modal dialog - pleine largeur avec marges minimales */
    body.mobile-mode .modal-dialog {
      width: 100% !important;
      max-width: calc(100vw - 20px) !important;
      margin: 10px !important;
      max-height: calc(100vh - 20px) !important;
    }
    
    /* Modal content - optimiser l'espace */
    body.mobile-mode .modal-content {
      border-radius: 8px !important;
    }
    
    /* Modal header - plus compact */
    body.mobile-mode .modal-header {
      padding: 15px !important;
    }
    
    body.mobile-mode .modal-header h3 {
      font-size: 18px !important;
      margin: 0 !important;
    }
    
    /* Close button - plus grand pour touch */
    body.mobile-mode .modal-header .close,
    body.mobile-mode .bootbox-close-button {
      width: 44px !important;
      height: 44px !important;
      padding: 10px !important;
      font-size: 28px !important;
      line-height: 24px !important;
      opacity: 0.7 !important;
    }
    
    /* Modal body - plus de padding */
    body.mobile-mode .modal-body {
      padding: 15px !important;
      overflow-y: auto !important;
      -webkit-overflow-scrolling: touch !important;
    }
    
    /* Select dropdown - pleine largeur et plus grand */
    body.mobile-mode .modal-body select {
      width: 100% !important;
      height: 44px !important;
      font-size: 16px !important;
      padding: 10px !important;
      margin-bottom: 15px !important;
      border-radius: 6px !important;
    }
    
    /* Nav tabs (actions buttons) - layout vertical pour mobile */
    body.mobile-mode .modal-body .nav-tabs {
      display: flex !important;
      flex-wrap: wrap !important;
      gap: 10px !important;
      border: none !important;
      margin-bottom: 20px !important;
    }
    
    body.mobile-mode .modal-body .nav-tabs > li {
      flex: 1 1 calc(50% - 5px) !important;
      min-width: 0 !important;
      margin: 0 !important;
      border: none !important;
    }
    
    body.mobile-mode .modal-body .nav-tabs > li > a {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      min-height: 44px !important;
      padding: 12px 10px !important;
      font-size: 15px !important;
      font-weight: 500 !important;
      border: 1px solid var(--kr-border-default) !important;
      border-radius: 6px !important;
      background: var(--kr-bg-secondary) !important;
      color: var(--kr-text-primary) !important;
      text-align: center !important;
      overflow-wrap: break-word !important;
      transition: all 0.2s ease !important;
    }
    
    body.mobile-mode .modal-body .nav-tabs > li.active > a,
    body.mobile-mode .modal-body .nav-tabs > li > a:hover,
    body.mobile-mode .modal-body .nav-tabs > li > a:focus {
      background: var(--kr-primary) !important;
      color: var(--kr-surface) !important;
      border-color: var(--kr-primary) !important;
    }
    
    /* Form groups - meilleur espacement */
    body.mobile-mode .modal-body .form-group {
      margin-bottom: 20px !important;
    }
    
    body.mobile-mode .modal-body label {
      font-size: 15px !important;
      font-weight: 500 !important;
      margin-bottom: 8px !important;
      display: block !important;
    }
    
    /* Inputs et textareas - plus grands */
    body.mobile-mode .modal-body input[type="text"],
    body.mobile-mode .modal-body input[type="number"],
    body.mobile-mode .modal-body textarea {
      width: 100% !important;
      min-height: 44px !important;
      font-size: 16px !important;
      padding: 10px !important;
      border-radius: 6px !important;
    }
    
    body.mobile-mode .modal-body textarea {
      min-height: 120px !important;
      resize: vertical !important;
    }
    
    /* Checkboxes et radios - plus grands touch targets */
    body.mobile-mode .modal-body input[type="checkbox"],
    body.mobile-mode .modal-body input[type="radio"] {
      width: 20px !important;
      height: 20px !important;
      margin-right: 10px !important;
    }
    
    body.mobile-mode .modal-body .checkbox label,
    body.mobile-mode .modal-body .radio label {
      display: flex !important;
      align-items: center !important;
      min-height: 44px !important;
      padding: 8px 0 !important;
      cursor: pointer !important;
    }
    
    /* Tables - améliorer lisibilité */
    body.mobile-mode .modal-body table {
      font-size: 14px !important;
    }
    
    body.mobile-mode .modal-body table td,
    body.mobile-mode .modal-body table th {
      padding: 10px 8px !important;
    }
    
    body.mobile-mode .modal-body table th {
      text-align: center !important;
    }
    
    /* Modal footer - sticky en bas avec boutons pleine largeur */
    body.mobile-mode .modal-footer {
      padding: 15px !important;
      display: flex !important;
      gap: 10px !important;
      border-top: 1px solid var(--kr-border-default) !important;
      background: var(--kr-bg-surface) !important;
    }
    
    body.mobile-mode .modal-footer .btn {
      flex: 1 !important;
      min-height: 48px !important;
      max-height: 48px !important;
      font-size: 16px !important;
      font-weight: 600 !important;
      border-radius: 6px !important;
      padding: 12px 20px !important;
      box-sizing: border-box !important;
      line-height: 1.2 !important;
    }
    
    body.mobile-mode .modal-footer .btn-primary {
      order: 2 !important;
    }
    
    body.mobile-mode .modal-footer .btn-default {
      order: 1 !important;
    }
    
    /* Alert dans modal - meilleur affichage */
    body.mobile-mode .modal-body .alert {
      padding: 12px !important;
      font-size: 14px !important;
      line-height: 1.5 !important;
      margin-bottom: 15px !important;
      border-radius: 6px !important;
    }
    
    /* Avatar/Image dans header - optimiser */
    body.mobile-mode .modal-header img {
      max-width: 60px !important;
      max-height: 60px !important;
      border-radius: 4px !important;
    }
  }

  /* ========================================================================
     MODAL PERSONNAGE MOBILE - UX/UI OPTIMISÉE POUR STRUCTURE RÉELLE
     ======================================================================== */
  @media (width <= 767px) {
    /* ===== 1. SELECT PERSONNAGE - visible, zone tactile agrandie ===== */
    body.mobile-mode .bootbox.modal select[name="top"].form-control {
      min-height: 56px !important;
      font-size: 16px !important;
      padding: 12px 16px !important;
      border-radius: 8px !important;
      border: 2px solid var(--kr-border-default) !important;
      background-color: var(--kr-bg-elevated) !important;
      transition: border-color 0.2s ease !important;
    }
    
    body.mobile-mode .bootbox.modal select[name="top"].form-control:focus {
      border-color: var(--kr-primary) !important;
      outline: none !important;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1) !important;
    }
    
    /* Conteneur du select avec marges */
    body.mobile-mode .bootbox.modal select[name="top"].form-control + br,
    body.mobile-mode .bootbox.modal .row:has(> .col-md-6 > select[name="top"]) {
      margin-bottom: 16px !important;
    }
    
    /* ===== 2. HEADER H3 - avatar + nom compact ===== */
    body.mobile-mode .bootbox.modal h3 {
      display: flex !important;
      align-items: center !important;
      gap: 12px !important;
      padding: 12px 16px !important;
      margin: 0 0 16px !important;
      background: var(--kr-bg-surface) !important;
      border-radius: 8px !important;
      font-size: 18px !important;
      line-height: 1.3 !important;
    }
    
    /* Avatar 48px */
    body.mobile-mode .bootbox.modal h3 img[width="80"] {
      width: 48px !important;
      height: 48px !important;
      max-width: 48px !important;
      max-height: 48px !important;
      border-radius: 6px !important;
      flex-shrink: 0 !important;
      order: -1 !important;
    }
    
    /* Wrapper pull-right dans h3 */
    body.mobile-mode .bootbox.modal h3 .pull-right {
      float: none !important;
      order: -1 !important;
      margin: 0 !important;
    }
    
    /* Liens mini (profil + kramail) */
    body.mobile-mode .bootbox.modal h3 .mini.center {
      display: flex !important;
      gap: 8px !important;
      margin: 0 !important;
      justify-content: flex-start !important;
    }
    
    body.mobile-mode .bootbox.modal h3 .mini.center a {
      min-width: 44px !important;
      min-height: 44px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    /* Bouton groupe (user-friends) */
    body.mobile-mode .bootbox.modal h3 .btn.btn-xs {
      min-width: 44px !important;
      min-height: 44px !important;
      padding: 8px !important;
      margin-left: auto !important;
    }
    
    /* ===== 3. NAVIGATION TABS - fusionner les deux listes en une seule ===== */

    /* Conteneur des listes */
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .panel-heading {
      display: flex !important;
      flex-flow: row nowrap !important;
      overflow: hidden auto !important;
      -webkit-overflow-scrolling: touch !important;
      scrollbar-width: none !important;
      -ms-overflow-style: none !important;
      border-bottom: 2px solid var(--kr-border-default) !important;
      padding: 0 !important;
      margin: 0 !important;
      background: var(--kr-bg-surface) !important;
    }
    
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .panel-heading::-webkit-scrollbar {
      display: none !important;
    }
    
    /* Chaque liste .nav-tabs inline */
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs {
      display: flex !important;
      flex-wrap: nowrap !important;
      flex-shrink: 0 !important;
      border: none !important;
      padding: 0 !important;
      gap: 0 !important;
      margin: 0 !important;
      background: transparent !important;
      position: relative !important;
    }
    
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs::-webkit-scrollbar {
      display: none !important;
    }
    
    /* Tabs individuels - min 88px tactiles */
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs > li {
      flex: 0 0 auto !important;
      min-width: 88px !important;
      width: auto !important;
      height: 44px !important;
      margin: 0 !important;
      border: none !important;
    }
    
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs > li > a {
      padding: 10px 16px !important;
      min-height: 44px !important;
      height: 44px !important;
      font-size: 14px !important;
      font-weight: 500 !important;
      line-height: 1.2 !important;
      white-space: nowrap !important;
      border-radius: 0 !important;
      border: none !important;
      border-bottom: 3px solid transparent !important;
      background: transparent !important;
      color: var(--kr-text-secondary) !important;
      transition: all 0.2s ease !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      text-align: center !important;
      margin: 0 !important;
    }
    
    /* Tab active */
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs > li.active > a,
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs > li.active > a:hover,
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs > li.active > a:focus {
      background: var(--kr-bg-elevated) !important;
      color: var(--kr-primary) !important;
      border: none !important;
      border-bottom: 3px solid var(--kr-primary) !important;
      font-weight: 600 !important;
      height: 44px !important;
    }
    
    /* Feedback tactile tabs */
    body.mobile-mode .bootbox.modal .panel.with-nav-tabs .nav-tabs > li > a:active {
      transform: scale(0.96) !important;
      background: var(--kr-bg-active) !important;
    }
    
    /* ===== 4. PANEL BODY - padding optimisé ===== */
    body.mobile-mode .bootbox.modal .panel-body.panel-order {
      padding: 16px !important;
    }
    
    /* ===== 5. COLONNES FUSIONNÉES EN MODE MOBILE ===== */

    /* Les colonnes sont fusionnées en une seule div par JavaScript */
    body.mobile-mode .bootbox.modal .merged-columns {
      padding: 12px !important;
      font-size: 14px !important;
      line-height: 1.6 !important;
    }
    
    /* Styles pour l'en-tête du tableau */
    body.mobile-mode .bootbox.modal .panel-heading {
      background: var(--kr-bg-elevated) !important;
      border-bottom: 2px solid var(--kr-border-default) !important;
      padding: 0 !important;
      font-weight: 600 !important;
    }
    
    body.mobile-mode .bootbox.modal .panel-heading .merged-columns {
      font-size: 13px !important;
      color: var(--kr-text-secondary) !important;
      text-transform: uppercase !important;
      letter-spacing: 0.5px !important;
    }
    
    /* Footer (ligne Maladresse/Bonus) et Boutons */
    body.mobile-mode .bootbox.modal .panel-footer {
      background: var(--kr-bg-elevated) !important;
      border-top: 1px solid var(--kr-border-default) !important;
      padding: 0 !important;
      display: flex !important;
      gap: 6px !important;
      border: none !important;
    }
    
    body.mobile-mode .bootbox.modal .panel-footer label {
      margin: 0 !important;
      font-size: 14px !important;
    }

    
    body.mobile-mode .bootbox.modal .panel-footer select {
      padding: 6px 8px !important;
      border-radius: 6px !important;
      border: 1px solid var(--kr-border-default) !important;
      font-size: 14px !important;
    }
    
    body.mobile-mode .bootbox.modal .panel-actions .row.form-group {
      margin: 0 0 8px !important;
      background: var(--kr-bg-elevated) !important;
      border: 2px solid var(--kr-border-default) !important;
      border-radius: 8px !important;
      min-height: 56px !important;
      transition: all 0.2s ease !important;
    }
    
    /* Row checked */
    body.mobile-mode .bootbox.modal .panel-actions .row.form-group:has(input[type="radio"]:checked) {
      border-color: var(--kr-primary) !important;
      background: var(--kr-alert-info-bg) !important;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1) !important;
    }
    
    /* Feedback tactile sur la row */
    body.mobile-mode .bootbox.modal .panel-actions .row.form-group:active {
      transform: scale(0.98) !important;
      background: var(--kr-bg-active) !important;
    }
    
    body.mobile-mode .bootbox.modal .panel-actions .row.form-group > div {
      padding: 0 8px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    /* Colonne du radio button - aligné à gauche */
    body.mobile-mode .bootbox.modal .panel-actions .row.form-group > div.col-sm-1 {
      justify-content: flex-start !important;
    }
    
    /* Colonne du label - aligné à gauche */
    body.mobile-mode .bootbox.modal .panel-actions .row.form-group > div.col-sm-7 {
      justify-content: flex-start !important;
    }
    
    /* Radio inputs cachés */
    body.mobile-mode .bootbox.modal .panel-actions input[type="radio"] {
      position: absolute !important;
      opacity: 0 !important;
      width: 0 !important;
      height: 0 !important;
    }
    
    /* Labels comme boutons */
    body.mobile-mode .bootbox.modal .panel-actions label {
      cursor: pointer !important;
      font-weight: normal !important;
      font-size: 15px !important;
      margin: 0 !important;
      padding: 14px 0 !important;
      display: block !important;
      width: 100% !important;
    }
    
    /* Label checked */
    body.mobile-mode .bootbox.modal .panel-actions input[type="radio"]:checked + label {
      font-weight: 600 !important;
    }
    
    /* Colonnes diff/jet plus compactes */
    body.mobile-mode .bootbox.modal .panel-actions .center {
      font-size: 14px !important;
      font-weight: 600 !important;
    }
    
    /* ===== 6. TOOLBAR - boutons tactiles optimisés ===== */
    body.mobile-mode .bootbox.modal .btn-toolbar {
      display: grid !important;
      grid-template-columns: repeat(6, 1fr) !important;
      gap: 4px !important;
      margin: 0 0 16px !important;
      padding: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
    }
    
    body.mobile-mode .bootbox.modal .btn-toolbar .btn-group {
      display: contents !important;
    }
    
    /* Supprimer COMPLÈTEMENT les pseudo-éléments clearfix de Bootstrap 3 */
    body.mobile-mode .bootbox.modal .btn-toolbar::before,
    body.mobile-mode .bootbox.modal .btn-toolbar::after,
    body.mobile-mode .bootbox.modal .btn-toolbar .btn-group::before,
    body.mobile-mode .bootbox.modal .btn-toolbar .btn-group::after,
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown::before,
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown::after,
    body.mobile-mode .bootbox.modal .btn-toolbar span.dropdown::before,
    body.mobile-mode .bootbox.modal .btn-toolbar span.dropdown::after {
      content: none !important;
      display: none !important;
      width: 0 !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    
    /* Tous les boutons directs et liens dans la toolbar */
    body.mobile-mode .bootbox.modal .btn-toolbar > .btn,
    body.mobile-mode .bootbox.modal .btn-toolbar .btn-group > a.btn,
    body.mobile-mode .bootbox.modal .btn-toolbar .btn-group > button.btn,
    body.mobile-mode .bootbox.modal .btn-toolbar .btn-group > .dropdown {
      min-width: 44px !important;
      max-width: none !important;
      width: 100% !important;
      min-height: 44px !important;
      max-height: 44px !important;
      height: 44px !important;
      padding: 8px !important;
      margin: 0 !important;
      font-size: 18px !important;
      line-height: 1 !important;
      border-radius: 4px !important;
      border-width: 1px !important;
      display: grid !important;
      place-items: center !important;
      transition: all 0.2s ease !important;
      box-sizing: border-box !important;
    }
    
    /* Dropdown wrapper - ne pas appliquer de style sur le span dropdown */
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown {
      display: contents !important;
      position: relative !important;
    }
    
    /* Le lien dropdown-toggle à l'intérieur du span dropdown */
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown > a.dropdown-toggle {
      min-width: 44px !important;
      width: 100% !important;
      min-height: 44px !important;
      height: 44px !important;
      padding: 0 !important;
      margin: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      border: none !important;
      background: transparent !important;
      text-decoration: none !important;
    }
    
    /* Le bouton à l'intérieur du dropdown-toggle */
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown > a.dropdown-toggle > .btn {
      min-width: 44px !important;
      width: 100% !important;
      min-height: 44px !important;
      height: 44px !important;
      padding: 8px !important;
      margin: 0 !important;
      font-size: 18px !important;
      line-height: 1 !important;
      border-radius: 4px !important;
      border-width: 1px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      box-sizing: border-box !important;
    }
    
    /* Feedback tactile sur tous les boutons */
    body.mobile-mode .bootbox.modal .btn-toolbar .btn:active,
    body.mobile-mode .bootbox.modal .btn-toolbar .btn-group > a.btn:active,
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown > a.dropdown-toggle:active,
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown > a.dropdown-toggle > .btn:active {
      transform: scale(0.95) !important;
      background: var(--kr-bg-active) !important;
      opacity: 0.8 !important;
    }
    
    /* Dropdown smiley/couleurs - doit apparaître PAR-DESSUS la modal */

    /* NOTE CRITIQUE: Bootstrap JS force position:fixed dynamiquement */

    /* Solution: Sélecteur ultra-spécifique + !important pour override Bootstrap */
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown .dropdown-menu,
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown-menu {
      max-width: 90vw !important;
      max-height: 50vh !important;
      overflow-y: auto !important;
      padding: 12px !important;

      /* CRITIQUE: Garder position: absolute pour le positionnement relatif Bootstrap */

      /* Bootstrap JS essaie de forcer position:fixed - on l'override ici */
      position: absolute !important;

      /* z-index élevé pour passer au-dessus du footer modal */
      z-index: 10000 !important;

      /* Forcer l'affichage VERS LE HAUT (dropup behavior) */
      bottom: 100% !important;
      top: auto !important;

      /* Petit espace entre le bouton et le dropdown */
      margin-bottom: 4px !important;
    }
    
    /* CRITIQUE: Forcer display: block quand le dropdown est ouvert */
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown.open .dropdown-menu,
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown:has([aria-expanded="true"]) .dropdown-menu {
      display: block !important;
    }
    
    /* SOLUTION: Forcer tous les parents à ne PAS créer de contexte d'empilement */

    /* Cela permet au dropdown avec z-index: 10000 de passer au-dessus du footer */
    body.mobile-mode .bootbox.modal .modal-dialog,
    body.mobile-mode .bootbox.modal .modal-content,
    body.mobile-mode .bootbox.modal .modal-body,
    body.mobile-mode .bootbox.modal .modal-footer,
    body.mobile-mode .bootbox.modal .btn-toolbar,
    body.mobile-mode .bootbox.modal .dropdown {
      /* Enlever TOUTES les propriétés qui créent un nouveau contexte d'empilement */
      transform: none !important;
      filter: none !important;
      perspective: none !important;
      will-change: auto !important;
      contain: none !important;

      /* NE PAS mettre de z-index ici, sinon ça crée un nouveau contexte */
      z-index: auto !important;
    }
    
    /* CRITIQUE: Forcer overflow: visible sur les parents pour ne PAS couper le dropdown */
    body.mobile-mode .bootbox.modal .modal-content,
    body.mobile-mode .bootbox.modal .modal-body,
    body.mobile-mode .bootbox.modal .panel-body {
      overflow: visible !important;
    }
    
    /* La modal racine doit garder son z-index pour le backdrop */
    body.mobile-mode .bootbox.modal {
      z-index: 1050 !important;
    }
    
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown-menu table {
      width: 100% !important;
    }
    
    body.mobile-mode .bootbox.modal .btn-toolbar .dropdown-menu table td a {
      min-width: 44px !important;
      min-height: 44px !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    
    /* Backdrop du dropdown sous le dropdown lui-même */
    body.mobile-mode .bootbox.modal .dropdown-backdrop {
      z-index: 1049 !important;
    }
    
    /* ===== 7. TEXTAREA - 120px min + compteur visible ===== */
    body.mobile-mode .bootbox.modal textarea#message,
    body.mobile-mode .bootbox.modal textarea.form-control {
      font-size: 16px !important;
      line-height: 1.5 !important;
      padding: 12px !important;
      border-radius: 8px !important;
      min-height: 120px !important;
      border: 2px solid var(--kr-border-default) !important;
      transition: border-color 0.2s ease !important;
    }
    
    body.mobile-mode .bootbox.modal textarea#message:focus,
    body.mobile-mode .bootbox.modal textarea.form-control:focus {
      border-color: var(--kr-primary) !important;
      outline: none !important;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1) !important;
    }
    
    /* Compteur */
    body.mobile-mode .bootbox.modal .pull-right:has(#car),
    body.mobile-mode .bootbox.modal #car {
      font-size: 13px !important;
      font-weight: 500 !important;
      color: var(--kr-text-secondary) !important;
      margin-top: 4px !important;
    }
    
    /* ===== 8. FOOTER - sticky avec bouton OK 2x ===== */
    body.mobile-mode .bootbox.modal .modal-footer {
      position: sticky !important;
      bottom: 0 !important;
      display: flex !important;
      gap: 10px !important;
      padding: 12px 16px !important;
      padding-bottom: max(12px, env(safe-area-inset-bottom)) !important;
      background: var(--kr-bg-surface) !important;
      border-top: 1px solid var(--kr-border-default) !important;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.08) !important;
      flex-shrink: 0 !important;
      margin: 0 !important;
      z-index: 100 !important; /* Sous le dropdown (z-index: 1050) */
    }
    
    body.mobile-mode .bootbox.modal .modal-footer .btn {
      margin: 0 !important;
      min-height: 50px !important;
      font-size: 16px !important;
      font-weight: 600 !important;
      border-radius: 8px !important;
      transition: all 0.2s ease !important;
      border: none !important;
    }
    
    /* Bouton Cancel - 1x */
    body.mobile-mode .bootbox.modal .modal-footer .btn-default {
      flex: 1 !important;
      order: 1 !important;
    }
    
    /* Bouton OK - 2x plus large */
    body.mobile-mode .bootbox.modal .modal-footer .btn-primary {
      flex: 2 !important;
      order: 2 !important;
      min-height: 52px !important;
    }
    
    body.mobile-mode .bootbox.modal .modal-footer .btn:active {
      transform: scale(0.97) !important;
    }
  }

/* ============================================================================
   MOBILE - PAGE PROFIL/INTERFACE
   ============================================================================ */
@media (width <= 767px) {
  /* Correction de l'affichage des sélecteurs de thème */
  body.mobile-mode #kr-tamper-theme-form .form-group {
    margin-bottom: 20px;
  }
  
  /* Grid pour les options de thème avec images */
  body.mobile-mode #kr-tamper-theme-form .form-group > div[style*="padding-left"] {
    display: grid !important;
    grid-template-columns: 1fr !important;
    gap: 12px !important;
    padding: 0 !important;
  }
  
  /* Chaque option de thème (conteneur label + image) */
  body.mobile-mode #kr-tamper-theme-form .form-group > div > div {
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 8px !important;
    padding: 12px !important;
    background: rgba(255, 255, 255, 0.05) !important;
    border-radius: 8px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
  }
  
  /* Cacher l'icône float left qui crée un conflit */
  body.mobile-mode #kr-tamper-theme-form .form-group .lefticon {
    display: none !important;
  }
  
  /* Image de prévisualisation du thème */
  body.mobile-mode #kr-tamper-theme-form .form-group img {
    width: 100% !important;
    height: auto !important;
    display: block !important;
    border-radius: 4px !important;
    margin: 0 !important;
  }
  
  /* Label du thème */
  body.mobile-mode #kr-tamper-theme-form .form-group label {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    width: 100% !important;
    margin: 0 !important;
    cursor: pointer !important;
    font-size: 14px !important;
    line-height: 1.4 !important;
  }
  
  /* Radio button */
  body.mobile-mode #kr-tamper-theme-form .form-group input[type="radio"] {
    position: static !important;
    flex-shrink: 0 !important;
    margin: 0 !important;
    width: 20px !important;
    height: 20px !important;
  }
  
  /* Checkbox */
  body.mobile-mode #kr-tamper-theme-form .form-group input[type="checkbox"] {
    position: static !important;
    flex-shrink: 0 !important;
    margin: 0 !important;
    width: 20px !important;
    height: 20px !important;
  }
  
  /* Label principal de la section */
  body.mobile-mode #kr-tamper-theme-form .form-group > label.control-label {
    font-size: 16px !important;
    font-weight: 600 !important;
    margin-bottom: 12px !important;
    display: block !important;
    width: 100% !important;
  }

  /* ============================================================================
     FORUM RP - TRANSFORMATION EN CARDS STYLE REDDIT EXPLORE
     Inspiré de la section "Recommandées pour toi" de Reddit
     ============================================================================ */
  
  /* Conteneur principal du forum */
  body.mobile-mode .panel-default {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
  }
  
  /* Header du panel - titre "Jeu (RP)" */
  body.mobile-mode .panel-default > .panel-heading {
    background: var(--kr-bg-surface) !important;
    border: none !important;
    border-radius: var(--mobile-radius) !important;
    padding: var(--mobile-spacing-lg) !important;
    margin-bottom: var(--mobile-spacing-md) !important;
    align-items: center !important;
  }
  
  body.mobile-mode .panel-default > .panel-heading h3 {
    font-size: 20px !important;
    font-weight: 700 !important;
    margin: 0 !important;
    color: var(--kr-text-primary) !important;
  }
  
  /* Cacher le header du tableau (colonnes) */
  body.mobile-mode .panel-default .table > thead {
    display: none !important;
  }
  
  /* Transformer le tbody en container flex vertical */
  body.mobile-mode .panel-default .table > tbody {
    display: flex !important;
    flex-direction: column !important;
    gap: 4px !important;
  }
  
  /* Chaque ligne devient une card avec CSS Grid pour contrôler l'ordre d'affichage */
  body.mobile-mode .panel-default .table > tbody > tr {
    display: grid !important;
    grid-template-columns: 1fr !important;
    grid-template-rows: auto !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: 8px !important;
    padding: 6px !important;
    box-shadow: var(--kr-shadow-sm) !important;
    transition: all var(--transition-fast) !important;
    position: relative !important;
    min-height: auto !important;
  }
  
  /* Effet au tap sur la card */
  body.mobile-mode .panel-default .table > tbody > tr:active {
    background: var(--kr-bg-hover) !important;
    transform: scale(0.98) !important;
  }
  
  /* === RÉORGANISATION DES CELLULES AVEC GRID === */

  /* Utiliser grid-row pour contrôler l'ordre d'affichage */
  body.mobile-mode .panel-default .table > tbody > tr > td {
    display: block !important;
    border: none !important;
    padding: 0 !important;
    width: 100% !important;
  }
  
  /* td:first-child à la ligne 1 (contient titre, mods, description) */

  /* === CELLULE 1 : Titre, Modérateurs, (Description cachée ici) === */

  /* Cette cellule contient 3 éléments dont on doit cacher la description pour la réafficher plus tard */
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child {
    display: flex !important;
    flex-direction: column !important;
    grid-row: 1 !important;
  }
  
  /* td:nth-child(2) et td:nth-child(3) (stats) à la ligne 2 */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(2),
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(3) {
    grid-row: 2 !important;
  }
  
  /* td:nth-child(4) (dernier message) à la ligne 4 */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) {
    grid-row: 4 !important;
  }
  
  /* === TITRE DU FORUM === */
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > p:first-child {
    order: 1 !important;
    margin: 0 !important;
    font-size: 0 !important; /* Masquer le texte brut "→" */
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > p:first-child > a {
    font-size: 15px !important;
    font-weight: 700 !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    line-height: 1.1 !important;
    display: block !important;
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > p:first-child > a:active {
    color: var(--kr-primary) !important;
  }
  
  /* === MODÉRATEURS === */

  /* Afficher les modérateurs juste après le titre */
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > span.tagforum {
    order: 2 !important;
    margin: 0 !important;
    font-size: 11px !important;
    color: var(--kr-text-secondary) !important;
    line-height: 1.2 !important;
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > span.tagforum > .lefticon {
    display: none !important;
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > span.tagforum a {
    color: var(--kr-text-secondary) !important;
    text-decoration: none !important;
    font-weight: 500 !important;
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > span.tagforum a:active {
    color: var(--kr-primary) !important;
    text-decoration: underline !important;
  }
  
  /* === DESCRIPTION === */

  /* La description est maintenant dans un wrapper créé par JavaScript */
  body.mobile-mode .panel-default .table > tbody > tr > td:first-child > p:nth-child(2),
  body.mobile-mode .panel-default .table > tbody > tr > .forum-description-wrapper > p {
    order: 999 !important;
    font-size: 12px !important;
    color: var(--kr-text-secondary) !important;
    line-height: 1.2 !important;
    margin: 0 !important;
  }
  
  /* Description wrapper */
  body.mobile-mode .panel-default .table > tbody > tr > .forum-description-wrapper {
    margin: 0 0 6px !important;
  }
  
  /* === CELLULE 2 & 3 : Stats (Sujets et Messages) === */

  /* Les stats sont maintenant dans un wrapper créé par JavaScript */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(2),
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(3),
  body.mobile-mode .panel-default .table > tbody > tr > .forum-stats-wrapper > td {
    display: inline !important;
    font-size: 11px !important;
    color: var(--kr-text-secondary) !important;
    order: 2 !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  
  /* Stats wrapper */
  body.mobile-mode .panel-default .table > tbody > tr > .forum-stats-wrapper {
    margin: 0 0 2px !important;
  }
  
  /* Ajouter "sujets · " après le premier nombre */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(2)::after,
  body.mobile-mode .panel-default .table > tbody > tr > .forum-stats-wrapper > td:first-child::after {
    content: " sujets · " !important;
  }
  
  /* Ajouter "messages" après le second nombre */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(3)::after,
  body.mobile-mode .panel-default .table > tbody > tr > .forum-stats-wrapper > td:nth-child(2)::after {
    content: " messages" !important;
  }
  
  /* === CELLULE 4 : Dernier message === */

  /* Maintenant que le DOM est réorganisé, la cellule du dernier message est à la fin */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4),
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child {
    order: 5 !important;
    padding-top: 3px !important;
    border-top: 1px solid var(--kr-border-default) !important;
    margin-top: 0 !important;
    font-size: 11px !important;
    color: var(--kr-text-secondary) !important;
    display: block !important;
  }
  
  /* Préfixe "→" avant l'auteur */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4)::before,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child::before {
    content: "→ " !important;
    color: var(--kr-text-secondary) !important;
    font-weight: 400 !important;
    margin-right: 4px !important;
  }
  
  /* Auteur du dernier message - inline */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) > a,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child > a {
    font-size: 12px !important;
    font-weight: 500 !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    display: inline !important;
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) > a:active,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child > a:active {
    color: var(--kr-primary) !important;
    text-decoration: underline !important;
  }
  
  /* Séparateur avant le timestamp */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) > a::after,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child > a::after {
    content: " · " !important;
    color: var(--kr-text-muted) !important;
    font-weight: 400 !important;
  }
  
  /* Timestamp et lien vers le message - inline, pas de bouton */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) > p,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child > p {
    display: inline !important;
    margin: 0 !important;
    font-size: 13px !important;
    color: var(--kr-text-secondary) !important;
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) > p > a,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child > p > a {
    color: var(--kr-text-secondary) !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
    background: none !important;
    border: none !important;
    padding: 0 !important;
    box-shadow: none !important;
    min-width: 20px !important;
    min-height: 20px !important;
  }
  
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) > p > a:active,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child > p > a:active {
    color: var(--kr-primary) !important;
  }
  
  /* Icône flèche dans le lien vers le message - 20x20px */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) > p > a .glyphicon,
  body.mobile-mode .panel-default .table > tbody > tr > td:last-child > p > a .glyphicon {
    display: inline-block !important;
    width: 20px !important;
    height: 20px !important;
    font-size: 14px !important;
    line-height: 20px !important;
    vertical-align: middle !important;
  }
  
  /* Badges/images dans les noms d'utilisateurs */
  body.mobile-mode .panel-default .table > tbody > tr > td:nth-child(4) img {
    vertical-align: middle !important;
    margin: 0 2px !important;
    max-height: 16px !important;
  }
}

/* ============================================================================
   MOBILE MENU DROPDOWNS - Bootstrap 3 native handling
   ============================================================================ */
@media (width <= 767px) {
  /* EN MOBILE : Afficher les dropdown-menu avec la structure Bootstrap 3 */
  
  /* Les dropdown-menu doivent être visibles quand le parent a la classe 'open' */
  .navbar-collapse .dropdown.open > .dropdown-menu {
    display: block !important;
    position: static !important;
    float: none !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    box-shadow: none !important;
    background-color: transparent !important;
  }
  
  /* Styling des items dans le dropdown */
  .navbar-collapse .dropdown.open > .dropdown-menu > li > a {
    display: block !important;
    padding: 10px 15px 10px 25px !important;
    clear: both !important;
    font-weight: 400 !important;
    line-height: 1.4286 !important;
    color: var(--kr-text-primary) !important;
    white-space: nowrap !important;
    background-color: transparent !important;
    border-left: 4px solid transparent !important;
  }
  
  .navbar-collapse .dropdown.open > .dropdown-menu > li > a:hover,
  .navbar-collapse .dropdown.open > .dropdown-menu > li > a:focus {
    color: var(--kr-text-primary) !important;
    background-color: rgba(0, 0, 0, 0.05) !important;
    border-left-color: var(--kr-primary) !important;
  }
  
  .navbar-collapse .dropdown.open > .dropdown-menu > li > a:active {
    color: var(--kr-primary) !important;
    background-color: rgba(0, 0, 0, 0.08) !important;
    border-left-color: var(--kr-primary) !important;
  }
  
  /* Dividers dans le dropdown */
  .navbar-collapse .dropdown.open > .dropdown-menu > .divider {
    height: 1px !important;
    margin: 9px 0 !important;
    background-color: var(--kr-border-default) !important;
  }
  
  /* Dropdown headers */
  .navbar-collapse .dropdown.open > .dropdown-menu > .dropdown-header {
    display: block !important;
    padding: 3px 15px 3px 25px !important;
    font-size: 12px !important;
    line-height: 1.4286 !important;
    color: var(--kr-text-muted) !important;
    white-space: nowrap !important;
    text-transform: uppercase !important;
    font-weight: 600 !important;
  }
  
  /* Active items in dropdown */
  .navbar-collapse .dropdown.open > .dropdown-menu > .active > a,
  .navbar-collapse .dropdown.open > .dropdown-menu > .active > a:hover,
  .navbar-collapse .dropdown.open > .dropdown-menu > .active > a:focus {
    color: var(--kr-primary) !important;
    background-color: rgba(0, 0, 0, 0.1) !important;
    border-left-color: var(--kr-primary) !important;
  }
  
  /* Bootstrap 3 collapse pour les items principaux du menu */
  .navbar-collapse .navbar-nav > li > a {
    padding: 15px !important;
  }
  
  /* Assurer que le caret du dropdown-toggle est visible */
  .navbar-collapse .dropdown > a.dropdown-toggle .caret {
    border-top-color: currentcolor !important;
    border-bottom-color: transparent !important;
  }
  
  /* Quand ouvert, inverser le caret */
  .navbar-collapse .dropdown.open > a.dropdown-toggle .caret {
    border-top-color: transparent !important;
    border-bottom-color: currentcolor !important;
    transform: rotate(180deg) !important;
  }
}


/* ========================================
   FORUM CARDS MOBILE
   Design cards-based pour liste des forums
   ======================================== */

/* Container des cards */
.forums-cards-container {
  display: none; /* Caché par défaut (desktop) */
  padding: 12px 8px;
  background: var(--kr-bg-page);
}

/* Affichage mobile uniquement */
.mobile-mode .forums-cards-container {
  display: block;
}

/* Masquer le tableau sur mobile */
.mobile-mode table[data-mobile-hidden="true"] {
  display: none !important;
}

/* === CARD COMPONENT === */

.forum-card {
  background: var(--kr-bg-surface);
  border-radius: 12px;
  margin: 0 12px 12px;
  transition: background 0.2s ease;
  overflow: hidden;
  border: 1px solid var(--kr-border-default);
}

/* Forcer l'alignement à gauche pour TOUS les descendants */
.forum-card *,
.forum-card-link *,
.forum-card-header *,
.forum-footer * {
  text-align: left !important;
}

.forum-card:active {
  background: var(--kr-bg-hover);
}

.forum-card-link {
  display: flex !important;
  flex-direction: column !important;
  align-items: flex-start !important;
  justify-content: flex-start !important;
  padding: 16px;
  text-decoration: none;
  color: inherit;
  
  /* Touch target minimum 44px */
  min-height: 100px;
  
  /* Active state feedback */
  -webkit-tap-highlight-color: rgba(139, 15, 14, 0.05);
}

.forum-card-link:hover,
.forum-card-link:focus {
  text-decoration: none;
  color: inherit;
}

/* === HEADER === */

.forum-card-header {
  margin-bottom: 8px;
  text-align: left;
}

.forum-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--kr-text-primary);
  line-height: 1.3;
  margin: 0;
  padding: 0;
  text-align: left !important;
}

/* === DESCRIPTION === */

.forum-description {
  font-size: 14px;
  color: var(--kr-text-secondary);
  line-height: 1.5;
  margin: 0 0 8px;
  text-align: left !important;
  
  /* Limitation à 2 lignes */
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* === MODERATEURS === */

.forum-moderators {
  font-size: 12px;
  color: var(--kr-text-muted);
  margin: 0 0 10px;
  font-style: normal;
  font-weight: 400;
  text-align: left !important;
}

/* === FOOTER (Stats + Dernière activité) === */

.forum-footer {
  border-top: 1px solid var(--kr-border-default);
  padding-top: 10px;
  margin-top: auto;
  text-align: left !important;
}

.forum-stats {
  font-size: 13px;
  color: var(--kr-text-muted);
  margin-bottom: 6px;
  white-space: nowrap;
  text-align: left !important;
}

.forum-topics,
.forum-messages {
  font-weight: 600;
  color: var(--kr-text-secondary);
}

.forum-separator {
  margin: 0 4px;
  color: var(--kr-text-muted);
}

.forum-last-activity {
  font-size: 13px;
  color: var(--kr-text-secondary);
  line-height: 1.5;
  text-align: left !important;
}

.last-user {
  font-weight: 600;
  color: var(--kr-text-primary);
}

.last-time {
  color: var(--kr-text-muted);
  font-size: 12px;
}

/* === ÉTATS SPÉCIAUX === */

/* Forum sans activité */
.forum-card:has(.forum-topics:empty) {
  opacity: 0.6;
}

/* Accessibilité: focus visible */
.forum-card-link:focus {
  outline: 2px solid #2196F3;
  outline-offset: 2px;
}

/* === MINI-CHAT FAB === */

.mini-chat-fab {
  position: fixed;
  bottom: 80px;
  right: 16px;
  width: 56px;
  height: 56px;
  background: #2196F3;
  color: white;
  border: none;
  border-radius: 50%;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  cursor: pointer;
  font-size: 14px;
  font-weight: 700;
  transition: all 0.3s ease;
}

.mini-chat-fab:active {
  transform: scale(0.95);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.mini-chat-fab.active {
  background: #f44336;
}

.mini-chat-fab .fab-text {
  display: block;
  line-height: 1;
}

/* Mini-chat en overlay fullscreen */
.mobile-mode .mini-chat-overlay {
  position: fixed !important;
  inset: 56px 0 0 !important; /* Sous le header */
  width: 100% !important;
  height: auto !important;
  z-index: 999 !important;
  background: white;
}

/* === RESPONSIVE === */

/* Tablettes en mode portrait */
@media (width >= 768px) and (width <= 1024px) and (orientation: portrait) {
  .forum-card {
    margin: 12px 24px;
  }
  
  .forum-card-link {
    padding: 20px;
  }
}

/* Desktop: désactiver les cards */
@media (width >= 768px) {
  .forums-cards-container {
    display: none !important;
  }
  
  table[data-mobile-hidden="true"] {
    display: table !important;
  }
  
  .mini-chat-fab {
    display: none;
  }
}

/* ============================================================================
   MOBILE OPTIMISATION - FORUM SUJETS (DataTables)
   ============================================================================ */

@media (max-width: 767px) {
  
  /* === CONTRÔLES DATATABLE (Recherche, Affichage, Pagination) === */
  
  /* Wrapper général */
  .dataTables_wrapper {
    padding: 0 !important;
  }
  
  /* Section contrôles haut (Afficher X lignes + Recherche) */
  .dataTables_length,
  .dataTables_filter {
    display: block !important;
    width: 100% !important;
    margin: 0 0 var(--mobile-spacing-md) !important;
    text-align: left !important;
    float: none !important;
  }
  
  /* Label "Afficher lignes" */
  .dataTables_length label {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    font-size: 14px !important;
    margin: 0 !important;
  }
  
  /* Dropdown "Afficher X lignes" - WCAG 2.5.5 (44px min) */
  .dataTables_length select {
    min-height: var(--mobile-touch-target) !important;
    padding: 10px 32px 10px 12px !important;
    font-size: 16px !important; /* Évite zoom iOS */
    border: 1px solid var(--kr-border-default) !important;
    border-radius: var(--mobile-radius) !important;
    background-color: var(--kr-bg-surface) !important;
    flex: 0 0 auto !important;
    min-width: 80px !important;
  }
  
  /* Label recherche */
  .dataTables_filter label {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    width: 100% !important;
    margin: 0 !important;
    font-size: 14px !important;
  }
  
  /* Input recherche - WCAG 2.5.5 (44px min) */
  .dataTables_filter input {
    flex: 1 !important;
    min-height: var(--mobile-touch-target) !important;
    padding: 10px 16px !important;
    font-size: 16px !important; /* Évite zoom iOS */
    border: 1px solid var(--kr-border-default) !important;
    border-radius: var(--mobile-radius) !important;
    background-color: var(--kr-bg-surface) !important;
    width: 100% !important;
  }
  
  /* Focus sur inputs */
  .dataTables_filter input:focus,
  .dataTables_length select:focus {
    outline: 2px solid var(--kr-primary) !important;
    outline-offset: 2px !important;
    border-color: var(--kr-primary) !important;
  }

  /* ============================================================================
     FORUM RP - TRANSFORMATION EN CARDS STYLE REDDIT EXPLORE
     Inspiré de la section "Recommandées pour toi" de Reddit
     ============================================================================ */
  
  /* Conteneur principal du forum */
  body.page-forum .panel-default {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
  }
  
  /* Header du panel - harmonisé avec kramail (transparent + cuivre) */
  body.page-forum .panel-default > .panel-heading {
    background: transparent !important;
    border: none !important;
    border-bottom: 1px solid var(--kr-border-default) !important;
    border-radius: 0 !important;
    padding: 12px 16px !important;
    margin-bottom: 0 !important;
    align-items: center !important;
  }

  /* Panel body - harmonisé kramail (pas de padding) */
  body.page-forum .panel-default > .panel-body {
    padding: 0 !important;
  }
  
  body.page-forum .panel-default > .panel-heading h3 {
    font-size: 16px !important;
    font-weight: 600 !important;
    margin: 0 !important;
    color: var(--kr-primary) !important;
  }
  
  /* Cacher le header du tableau (colonnes) */
  body.page-forum .panel-default .table > thead {
    display: none !important;
  }
  
  /* Transformer le tbody en container flex vertical */
  body.page-forum .panel-default .table > tbody {
    display: flex !important;
    flex-direction: column !important;
    gap: 8px !important;
  }
  
  /* Chaque ligne devient une card — harmonisé kramail (12px radius/padding, plat sans ombre) */
  body.page-forum .panel-default .table > tbody > tr {
    display: grid !important;
    grid-template-columns: 1fr !important;
    grid-template-rows: auto !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: 12px !important;
    padding: 12px !important;
    transition: background var(--transition-fast) !important;
    position: relative !important;
    min-height: auto !important;
  }
  
  /* Effet au tap sur la card */
  body.page-forum .panel-default .table > tbody > tr:active {
    background: var(--kr-bg-hover) !important;
  }
  
  /* === RÉORGANISATION DES CELLULES AVEC GRID === */

  body.page-forum .panel-default .table > tbody > tr > td {
    display: block !important;
    border: none !important;
    padding: 0 !important;
    width: 100% !important;
  }
  
  /* === CELLULE 1 : Titre, Modérateurs, (Description cachée ici) === */
  body.page-forum .panel-default .table > tbody > tr > td:first-child {
    display: flex !important;
    flex-direction: column !important;
    grid-row: 1 !important;
  }
  
  /* td:nth-child(2) et td:nth-child(3) (stats) à la ligne 2 */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(2),
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(3) {
    grid-row: 2 !important;
  }
  
  /* td:nth-child(4) (dernier message) à la ligne 4 */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) {
    grid-row: 4 !important;
  }
  
  /* === TITRE DU FORUM === */
  body.page-forum .panel-default .table > tbody > tr > td:first-child > p:first-child {
    order: 1 !important;
    margin: 0 !important;
    font-size: 0 !important; /* Masquer le texte brut "→" */
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:first-child > p:first-child > a {
    font-size: 15px !important;
    font-weight: 700 !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    line-height: 1.1 !important;
    display: block !important;
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:first-child > p:first-child > a:active {
    color: var(--kr-primary) !important;
  }
  
  /* === MODÉRATEURS === */
  body.page-forum .panel-default .table > tbody > tr > td:first-child > span.tagforum {
    order: 2 !important;
    margin: 0 !important;
    font-size: 11px !important;
    color: var(--kr-text-secondary) !important;
    line-height: 1.2 !important;
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:first-child > span.tagforum > .lefticon {
    display: none !important;
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:first-child > span.tagforum a {
    color: var(--kr-text-secondary) !important;
    text-decoration: none !important;
    font-weight: 500 !important;
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:first-child > span.tagforum a:active {
    color: var(--kr-primary) !important;
    text-decoration: underline !important;
  }
  
  /* === DESCRIPTION === */
  body.page-forum .panel-default .table > tbody > tr > td:first-child > p:nth-child(2),
  body.page-forum .panel-default .table > tbody > tr > .forum-description-wrapper > p {
    order: 999 !important;
    font-size: 12px !important;
    color: var(--kr-text-secondary) !important;
    line-height: 1.2 !important;
    margin: 0 !important;
  }
  
  /* Description wrapper */
  body.page-forum .panel-default .table > tbody > tr > .forum-description-wrapper {
    margin: 0 0 6px !important;
  }
  
  /* === CELLULE 2 & 3 : Stats (Sujets et Messages) === */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(2),
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(3),
  body.page-forum .panel-default .table > tbody > tr > .forum-stats-wrapper > td {
    display: inline !important;
    font-size: 11px !important;
    color: var(--kr-text-secondary) !important;
    order: 2 !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  
  /* Stats wrapper */
  body.page-forum .panel-default .table > tbody > tr > .forum-stats-wrapper {
    margin: 0 0 2px !important;
  }
  
  /* Ajouter "sujets · " après le premier nombre */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(2)::after,
  body.page-forum .panel-default .table > tbody > tr > .forum-stats-wrapper > td:first-child::after {
    content: " sujets · " !important;
  }
  
  /* Ajouter "messages" après le second nombre */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(3)::after,
  body.page-forum .panel-default .table > tbody > tr > .forum-stats-wrapper > td:nth-child(2)::after {
    content: " messages" !important;
  }
  
  /* === CELLULE 4 : Dernier message === */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4),
  body.page-forum .panel-default .table > tbody > tr > td:last-child {
    order: 5 !important;
    padding-top: 3px !important;
    border-top: 1px solid var(--kr-border-default) !important;
    margin-top: 0 !important;
    font-size: 11px !important;
    color: var(--kr-text-secondary) !important;
    display: block !important;
  }
  
  /* Préfixe "→" avant l'auteur */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4)::before,
  body.page-forum .panel-default .table > tbody > tr > td:last-child::before {
    content: "→ " !important;
    color: var(--kr-text-secondary) !important;
    font-weight: 400 !important;
    margin-right: 4px !important;
  }
  
  /* Auteur du dernier message - inline */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) > a,
  body.page-forum .panel-default .table > tbody > tr > td:last-child > a {
    font-size: 12px !important;
    font-weight: 500 !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    display: inline !important;
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) > a:active,
  body.page-forum .panel-default .table > tbody > tr > td:last-child > a:active {
    color: var(--kr-primary) !important;
    text-decoration: underline !important;
  }
  
  /* Séparateur avant le timestamp */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) > a::after,
  body.page-forum .panel-default .table > tbody > tr > td:last-child > a::after {
    content: " · " !important;
    color: var(--kr-text-muted) !important;
    font-weight: 400 !important;
  }
  
  /* Timestamp et lien vers le message - inline, pas de bouton */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) > p,
  body.page-forum .panel-default .table > tbody > tr > td:last-child > p {
    display: inline !important;
    margin: 0 !important;
    font-size: 13px !important;
    color: var(--kr-text-secondary) !important;
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) > p > a,
  body.page-forum .panel-default .table > tbody > tr > td:last-child > p > a {
    color: var(--kr-text-secondary) !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
    background: none !important;
    border: none !important;
    padding: 0 !important;
    box-shadow: none !important;
    min-width: 20px !important;
    min-height: 20px !important;
  }
  
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) > p > a:active,
  body.page-forum .panel-default .table > tbody > tr > td:last-child > p > a:active {
    color: var(--kr-primary) !important;
  }
  
  /* Icône flèche dans le lien vers le message - 20x20px */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) > p > a .glyphicon,
  body.page-forum .panel-default .table > tbody > tr > td:last-child > p > a .glyphicon {
    display: inline-block !important;
    width: 20px !important;
    height: 20px !important;
    font-size: 14px !important;
    line-height: 20px !important;
    vertical-align: middle !important;
  }
  
  /* Badges/images dans les noms d'utilisateurs */
  body.page-forum .panel-default .table > tbody > tr > td:nth-child(4) img {
    vertical-align: middle !important;
    margin: 0 2px !important;
    max-height: 16px !important;
  }
  
  /* ============================================================================
     TABLEAU → CARDS (FORUMS UNIQUEMENT - exclut kramails)
     ============================================================================ */
  
  /* Masquer le header du tableau - Forums uniquement */
  body.page-forum table.dataTable thead {
    display: none !important;
  }
  
  /* Transformer tbody en flex vertical - Forums uniquement */
  body.page-forum table.dataTable tbody {
    display: flex !important;
    flex-direction: column !important;
    gap: var(--mobile-spacing-md) !important;
  }
  
  /* Chaque <tr> devient une card — harmonisé kramail (12px radius, 12px padding, plat sans ombre) */
  body.page-forum table.dataTable tbody tr {
    display: flex !important;
    flex-direction: column !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: 12px !important;
    padding: 12px !important;
    margin: 0 !important;
    overflow: hidden !important;
    transition: background var(--transition-fast) !important;
    cursor: pointer !important;
  }
  
  /* Feedback tactile card (mobile = pas de hover) */
  body.page-forum table.dataTable tbody tr:active {
    background: var(--kr-bg-hover) !important;
  }
  
  /* === COLONNES VISIBLES (FORUMS) === */
  
  /* Masquer colonnes Msg, Vus, Auteur, Dernier Message - Forums uniquement */
  body.page-forum table.dataTable tbody td:nth-child(2), /* Msg */
  body.page-forum table.dataTable tbody td:nth-child(3), /* Vus */
  body.page-forum table.dataTable tbody td:nth-child(4), /* Auteur */
  body.page-forum table.dataTable tbody td:nth-child(5) /* Dernier Message */ {
    display: none !important;
  }
  
  /* Colonne Sujet (zone unique, comme Sujets permanents) — forums uniquement */
  body.page-forum table.dataTable tbody td:nth-child(1) {
    display: flex !important;
    flex-direction: column !important;
    padding: 0 !important;
    min-height: var(--mobile-touch-target) !important;
    gap: var(--mobile-spacing-sm) !important;
  }
  
  /* === ZONE 1 : TITRE DU SUJET (FORUMS) === */
  
  /* Titre du sujet */
  body.page-forum table.dataTable tbody td:nth-child(1) p {
    margin: 0 0 4px 0 !important;
    padding: 0 !important;
    display: flex !important;
    align-items: flex-start !important;
    gap: 8px !important;
  }
  
  /* Lien titre */
  body.page-forum table.dataTable tbody td:nth-child(1) p a {
    flex: 1 !important;
    font-size: 15px !important;
    font-weight: 600 !important;
    line-height: 1.4 !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    display: block !important;
  }
  
  /* Feedback tactile sur titre */
  body.page-forum table.dataTable tbody td:nth-child(1) p a:active {
    color: var(--kr-primary) !important;
  }
  
  /* === ICÔNES ET PAGINATION : MASQUÉES === */
  
  /* Masquer l'icône folder-open (1ère UL) */
  body.page-forum table.dataTable tbody td:nth-child(1) > ul:first-of-type {
    display: none !important;
  }
  
  /* Masquer la pagination (2ème UL) */
  body.page-forum table.dataTable tbody td:nth-child(1) > ul:nth-of-type(2) {
    display: none !important;
  }
  
  /* Tags */
  body.page-forum table.dataTable tbody td:nth-child(1) .forum-tags {
    display: flex !important;
    flex-wrap: wrap !important;
    gap: 3px !important;
    margin-top: 6px !important;
  }
  
  body.page-forum table.dataTable tbody td:nth-child(1) .forum-tags .glyphicon {
    color: var(--kr-text-muted) !important;
    font-size: 8px !important;
  }
  
  body.page-forum table.dataTable tbody td:nth-child(1) .forum-tags a {
    display: inline-flex !important;
    align-items: center !important;
    padding: 1px 4px !important;
    font-size: 9px !important;
    color: var(--kr-text-secondary) !important;
    background: var(--kr-bg-hover) !important;
    border-radius: 2px !important;
    text-decoration: none !important;
    transition: all var(--transition-fast) !important;
  }
  
  body.page-forum table.dataTable tbody td:nth-child(1) .forum-tags a:active {
    background: var(--kr-bg-active) !important;
  }
  
  /* === STATS TOPICS MOBILE (injectées par JS) — style harmonisé kramail === */
  
  .forum-topic-stats-mobile {
    display: flex !important;
    align-items: center !important;
    gap: 4px !important;
    margin-top: 4px !important;
    font-size: 13px !important;
    color: var(--kr-text-secondary) !important;
  }

  .forum-topic-stats-mobile i {
    font-size: 12px !important;
  }

  .forum-topic-stats-mobile .stats-sep {
    margin: 0 4px !important;
    color: var(--kr-text-muted) !important;
  }
  
  /* === ZONE 2 : DERNIER MESSAGE (forums thread) === */
  
  /* Lien auteur */
  body.page-forum table.dataTable tbody td:nth-child(5) a:first-child {
    font-size: 14px !important;
    font-weight: 600 !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 4px !important;
  }
  
  /* Image nation dans auteur */
  body.page-forum table.dataTable tbody td:nth-child(5) a:first-child img {
    width: 16px !important;
    height: 16px !important;
    vertical-align: middle !important;
  }
  
  /* Paragraphe date/heure */
  body.page-forum table.dataTable tbody td:nth-child(5) p {
    font-size: 13px !important;
    color: var(--kr-text-muted) !important;
    margin: 0 !important;
    display: flex !important;
    align-items: center !important;
    gap: 6px !important;
  }
  
  /* Icône lien vers message */
  body.page-forum table.dataTable tbody td:nth-child(5) p a .glyphicon {
    font-size: 12px !important;
    color: var(--kr-primary) !important;
  }
  
  /* Feedback tactile zone dernier message */
  body.page-forum table.dataTable tbody td:nth-child(5):active {
    background: var(--kr-bg-active) !important;
  }
  
  /* === PAGINATION === */
  
  /* Wrapper pagination */
  .dataTables_paginate {
    display: flex !important;
    justify-content: center !important;
    gap: var(--mobile-spacing-sm) !important;
    margin-top: var(--mobile-spacing-lg) !important;
    padding: 0 !important;
  }
  
  /* Boutons Précédent/Suivant - WCAG 2.5.5 (44px min) */
  .dataTables_paginate .paginate_button {
    min-height: var(--mobile-touch-target) !important;
    min-width: var(--mobile-touch-target) !important;
    padding: 10px 16px !important;
    font-size: 16px !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: var(--mobile-radius) !important;
    background: var(--kr-bg-surface) !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    transition: all var(--transition-fast) !important;
  }
  
  /* État actif */
  .dataTables_paginate .paginate_button.current {
    background: var(--kr-primary) !important;
    color: white !important;
    border-color: var(--kr-primary) !important;
    font-weight: 600 !important;
  }
  
  /* État désactivé */
  .dataTables_paginate .paginate_button.disabled {
    opacity: 0.4 !important;
    cursor: not-allowed !important;
    pointer-events: none !important;
  }
  
  /* Feedback tactile */
  .dataTables_paginate .paginate_button:not(.disabled):not(.current):active {
    background: var(--kr-bg-active) !important;
    transform: scale(0.95) !important;
  }
  
  /* === INFO PAGINATION (Affiche X à Y de Z lignes) === */
  
  .dataTables_info {
    text-align: center !important;
    font-size: 14px !important;
    color: var(--kr-text-secondary) !important;
    margin-top: var(--mobile-spacing-md) !important;
    padding: 0 var(--mobile-spacing-md) !important;
  }
  
  /* === DARK MODE === */
  
  html[class*="-dark"] table.dataTable tbody tr {
    background: var(--kr-bg-surface) !important;
    border-color: var(--kr-border-default) !important;
  }
  
  html[class*="-dark"] table.dataTable tbody td:nth-child(1) {
    border-bottom-color: var(--kr-border-default) !important;
  }
  
  html[class*="-dark"] table.dataTable tbody td:nth-child(5) {
    background: rgba(255, 255, 255, 0.03) !important;
  }
  
  html[class*="-dark"] .dataTables_filter input,
  html[class*="-dark"] .dataTables_length select {
    background: var(--kr-bg-surface) !important;
    border-color: var(--kr-border-default) !important;
    color: var(--kr-text-primary) !important;
  }
  
  html[class*="-dark"] .dataTables_paginate .paginate_button {
    background: var(--kr-bg-surface) !important;
    border-color: var(--kr-border-default) !important;
    color: var(--kr-text-primary) !important;
  }
  
  /* ============================================================================
     KRAMAIL - REFONTE MOBILE
     Redesign complet : tabs alignés, quick actions, DataTable → Cards
     Sélecteurs réels du DOM kraland.org :
       - h1.page-header > span.pull-right > a.btn (tabs + icons)
       - #topics (DataTable), #topics_wrapper
       - .panel.panel-default > .panel-heading + .panel-body
     ============================================================================ */

  /* === 1. H1 PAGE HEADER : layout vertical (scopé kramail) === */
  body.page-kramail h1.page-header {
    display: flex !important;
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 12px !important;
    padding: 12px 16px !important;
    margin: 0 !important;
    border-bottom: none !important;
  }

  /* Le span.pull-right qui contient TOUS les boutons : annuler le float */
  body.page-kramail h1.page-header .pull-right {
    float: none !important;
    display: flex !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: 8px !important;
    width: 100% !important;
  }

  /* === 2. BOUTONS KRAMAIL — Icône-only, carrés 44×44px (scopé kramail) === */
  /* Style commun : tabs (a.btn) + bouton kebab (.btn-group > .btn) */
  body.page-kramail h1.page-header .pull-right > a.btn,
  body.page-kramail h1.page-header .pull-right > .btn-group > .btn {
    width: 44px !important;
    height: 44px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 !important;
    margin: 0 !important;
    font-size: 0 !important;
    line-height: 0 !important;
    box-sizing: border-box !important;
    border-radius: 10px !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    transition: all var(--transition-fast) !important;
  }

  /* Icônes — taille et alignement uniformes */
  body.page-kramail h1.page-header .pull-right > a.btn > i,
  body.page-kramail h1.page-header .pull-right > .btn-group > .btn > i {
    font-size: 18px !important;
    line-height: 1 !important;
  }

  /* Tab actif (btn-primary = onglet sélectionné) */
  body.page-kramail h1.page-header .pull-right > a.btn.btn-primary {
    background: var(--kr-primary) !important;
    border-color: var(--kr-primary) !important;
    color: white !important;
  }

  /* Feedback tactile */
  body.page-kramail h1.page-header .pull-right > a.btn:active,
  body.page-kramail h1.page-header .pull-right > .btn-group > .btn:active {
    transform: scale(0.97) !important;
    opacity: 0.9 !important;
  }

  /* Container du bouton kebab — taille contrainte */
  body.page-kramail h1.page-header .pull-right > .btn-group {
    position: relative !important;
    width: 44px !important;
    height: 44px !important;
  }

  /* Dropdown menu du bouton "+" (scopé kramail) */
  body.page-kramail h1.page-header .pull-right > .btn-group > .dropdown-menu {
    min-width: 260px !important;
    right: 0 !important;
    left: auto !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: 10px !important;
    padding: 8px 0 !important;
    box-shadow: 0 4px 16px rgba(0,0,0,0.4) !important;
  }

  body.page-kramail h1.page-header .pull-right > .btn-group > .dropdown-menu > li > a {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    padding: 12px 16px !important;
    min-height: 44px !important;
    font-size: 15px !important;
    color: var(--kr-text-primary) !important;
    white-space: nowrap !important;
  }

  body.page-kramail h1.page-header .pull-right > .btn-group > .dropdown-menu > li > a:active {
    background: rgba(255,255,255,0.08) !important;
  }

  body.page-kramail h1.page-header .pull-right > .btn-group > .dropdown-menu > li > a .label-simple {
    font-size: 15px !important;
    color: var(--kr-text-primary) !important;
  }

  body.page-kramail h1.page-header .pull-right > .btn-group > .dropdown-menu > li > a input[type="checkbox"] {
    width: 18px !important;
    height: 18px !important;
  }

  /* === 4. PANEL BOÎTE DE RÉCEPTION (scopé kramail) === */
  body.page-kramail .panel.panel-default {
    border: none !important;
    box-shadow: none !important;
    margin: 0 !important;
    background: transparent !important;
  }

  body.page-kramail .panel-heading {
    padding: 12px 16px !important;
    background: transparent !important;
    border-bottom: 1px solid var(--kr-border-default) !important;
  }

  body.page-kramail .panel-heading h3.panel-title {
    font-size: 16px !important;
    font-weight: 600 !important;
    color: var(--kr-primary) !important;
  }

  /* Icône chevron collapse */
  body.page-kramail .panel-heading .glyphicon-chevron-up {
    float: right !important;
    color: var(--kr-text-secondary) !important;
  }

  body.page-kramail .panel-body {
    padding: 0 !important;
  }

  /* === 5. DATATABLE CONTRÔLES (scopé kramail) === */
  /* Cacher "Afficher X lignes" sur mobile - encombre inutilement */
  body.page-kramail #topics_wrapper .dataTables_length {
    display: none !important;
  }

  /* Barre de recherche DataTable - optimisée tactile */
  body.page-kramail #topics_wrapper .dataTables_filter {
    padding: 12px 16px !important;
    text-align: left !important;
    width: 100% !important;
  }

  body.page-kramail #topics_wrapper .dataTables_filter label {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    width: 100% !important;
    margin: 0 !important;
    font-size: 14px !important;
    color: var(--kr-text-secondary) !important;
  }

  body.page-kramail #topics_wrapper .dataTables_filter input[type="search"],
  body.page-kramail #topics_wrapper .dataTables_filter input {
    flex: 1 !important;
    height: 44px !important;
    padding: 0 16px !important;
    font-size: 16px !important; /* Évite zoom iOS */
    border-radius: 22px !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    color: var(--kr-text-primary) !important;
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast) !important;
    -webkit-appearance: none !important;
  }

  body.page-kramail #topics_wrapper .dataTables_filter input:focus {
    outline: none !important;
    border-color: var(--kr-primary) !important;
    box-shadow: 0 0 0 3px rgba(212, 134, 62, 0.15) !important;
  }

  /* Info "Affiche X à Y de Z lignes" */
  body.page-kramail #topics_wrapper .dataTables_info {
    padding: 8px 16px !important;
    font-size: 13px !important;
    color: var(--kr-text-muted) !important;
    text-align: center !important;
  }

  /* Pagination */
  body.page-kramail #topics_wrapper .dataTables_paginate {
    padding: 8px 16px 16px !important;
    text-align: center !important;
  }

  body.page-kramail #topics_wrapper .dataTables_paginate .paginate_button {
    min-height: 44px !important;
    min-width: 44px !important;
    padding: 10px 14px !important;
    margin: 0 4px !important;
    border-radius: 8px !important;
    font-size: 14px !important;
  }

  /* === 6. TABLE #topics → CARDS LAYOUT (scopé kramail) === */
  /* Cacher le thead de la table */
  body.page-kramail #topics thead {
    display: none !important;
  }

  /* Table en layout bloc */
  body.page-kramail #topics {
    display: block !important;
    width: 100% !important;
    border-collapse: separate !important;
  }

  body.page-kramail #topics tbody {
    display: flex !important;
    flex-direction: column !important;
    gap: 8px !important;
    padding: 8px 16px !important;
  }

  /* Chaque TR devient une carte */
  body.page-kramail #topics tbody tr {
    display: grid !important;
    grid-template-columns: 36px 1fr !important;
    grid-template-rows: auto auto !important;
    gap: 4px 10px !important;
    padding: 12px !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: 12px !important;
    cursor: pointer !important;
    transition: background var(--transition-fast) !important;
    min-height: 56px !important;
    position: relative !important;
  }

  /* Feedback tactile carte */
  body.page-kramail #topics tbody tr:active {
    background: var(--kr-bg-hover) !important;
  }

  /* Cellule 1 : Checkbox */
  body.page-kramail #topics tbody td:first-child {
    grid-row: 1 / -1 !important;
    grid-column: 1 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 0 !important;
    width: auto !important;
    border: none !important;
  }

  body.page-kramail #topics tbody td:first-child input[type="checkbox"] {
    width: 20px !important;
    height: 20px !important;
    cursor: pointer !important;
    accent-color: var(--kr-primary) !important;
  }

  /* Cellule 2 : Message (titre + icône) */
  body.page-kramail #topics tbody td:nth-child(2) {
    grid-column: 2 !important;
    grid-row: 1 !important;
    display: block !important;
    padding: 0 !important;
    border: none !important;
    overflow: hidden !important;
  }

  /* Le paragraphe wrapper */
  body.page-kramail #topics tbody td:nth-child(2) p.nomargin {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Le span#ajax-mXXX qui contient icône + titre */
  body.page-kramail #topics tbody td:nth-child(2) span[id^="ajax-m"] {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    overflow: hidden !important;
  }

  /* Icône du message (enveloppe, reply, etc.) */
  body.page-kramail #topics tbody td:nth-child(2) a:first-child i.fa,
  body.page-kramail #topics tbody td:nth-child(2) a:first-child i.far,
  body.page-kramail #topics tbody td:nth-child(2) a:first-child i.fas {
    font-size: 16px !important;
    color: var(--kr-text-secondary) !important;
    flex-shrink: 0 !important;
  }

  /* Lien icône (ne doit pas prendre toute la largeur) */
  body.page-kramail #topics tbody td:nth-child(2) span[id^="ajax-m"] > a:first-child {
    flex-shrink: 0 !important;
    display: flex !important;
    align-items: center !important;
    padding: 0 !important;
    min-height: 0 !important;
  }

  /* Lien titre du message */
  body.page-kramail #topics tbody td:nth-child(2) a:last-of-type {
    font-size: 15px !important;
    font-weight: 500 !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
    line-height: 1.3 !important;
    display: block !important;
    padding: 0 !important;
    min-height: 0 !important;
    flex: 1 !important;
    min-width: 0 !important;
  }

  /* Cacher le span.invisible (doublon du titre pour tri) */
  body.page-kramail #topics tbody td:nth-child(2) span.invisible {
    display: none !important;
  }

  /* Cellule 3 : Auteur - sous le titre à gauche */
  body.page-kramail #topics tbody td:nth-child(3) {
    grid-column: 2 !important;
    grid-row: 2 !important;
    display: inline !important;
    padding: 0 !important;
    border: none !important;
    font-size: 13px !important;
    color: var(--kr-text-secondary) !important;
  }

  body.page-kramail #topics tbody td:nth-child(3) a {
    color: var(--kr-text-secondary) !important;
    text-decoration: none !important;
    font-size: 13px !important;
  }

  /* Cellule 4 : Date - sous le titre à droite (même ligne que auteur) */
  body.page-kramail #topics tbody td:nth-child(4) {
    position: absolute !important;
    right: 12px !important;
    bottom: 12px !important;
    display: block !important;
    padding: 0 !important;
    border: none !important;
    font-size: 12px !important;
    color: var(--kr-text-muted) !important;
    text-align: right !important;
  }

  /* Cacher le span.invisible (date ISO pour tri) dans la cellule date */
  body.page-kramail #topics tbody td:nth-child(4) span.invisible {
    display: none !important;
  }

  /* === BOUTONS ACTIONS TABLE HEADER (+ dropdown) (scopé kramail) === */
  /* Comme le thead est caché, on déplace le btn-group d'actions au-dessus */
  body.page-kramail #topics_wrapper .btn-group {
    display: flex !important;
    gap: 4px !important;
    padding: 8px 16px !important;
  }

  body.page-kramail #topics_wrapper .btn-group .btn {
    min-height: 44px !important;
    min-width: 44px !important;
    padding: 10px !important;
    font-size: 14px !important;
    border-radius: 8px !important;
  }

  /* === DROPDOWN CHANGEMENT DE PERSONNAGE === */

  /* Wrapper titre cliquable */
  .kramail-character-selector {
    position: relative !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    cursor: pointer !important;
    user-select: none !important;
    padding: 8px 12px !important;
    margin: -8px -12px !important;
    border-radius: var(--mobile-radius) !important;
    transition: background var(--transition-fast) !important;
  }

  .kramail-character-selector:active {
    background: var(--kr-bg-active) !important;
  }

  /* Icône dropdown */
  .kramail-dropdown-icon {
    font-size: 12px !important;
    transition: transform var(--transition-fast) !important;
    color: var(--kr-text-secondary) !important;
  }

  /* Container dropdown */
  .kramail-character-dropdown {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    right: auto !important;
    min-width: calc(100vw - 48px) !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: var(--mobile-radius) !important;
    box-shadow: var(--kr-shadow-lg) !important;
    margin-top: 8px !important;
    z-index: 1000 !important;
    overflow: hidden !important;
    max-height: 70vh !important;
    overflow-y: auto !important;
    display: none;
    flex-direction: column !important;
  }

  /* Quand ouvert : afficher en colonne */
  .kramail-character-dropdown[style*="display: block"],
  .kramail-character-dropdown[style*="display:block"] {
    display: flex !important;
  }

  /* Options de personnage — centrées, une par ligne */
  .kramail-character-option {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    text-align: center !important;
    padding: 12px 16px !important;
    min-height: var(--mobile-touch-target) !important;
    text-decoration: none !important;
    color: var(--kr-text-primary) !important;
    border-bottom: 1px solid var(--kr-border-default) !important;
    transition: background var(--transition-fast) !important;
  }

  /* Nom du personnage centré (surcharge inline style) */
  .kramail-character-option > div:first-child {
    justify-content: center !important;
    width: 100% !important;
  }

  /* Catégorie centrée */
  .kramail-character-option > div:last-child {
    text-align: center !important;
  }

  .kramail-character-option:last-child {
    border-bottom: none !important;
  }

  .kramail-character-option:active {
    background: var(--kr-bg-active) !important;
  }

  /* === DARK MODE KRAMAIL === */
  html[class*="-dark"] .kramail-character-dropdown {
    background: var(--kr-bg-surface) !important;
    border-color: var(--kr-border-default) !important;
  }

  html[class*="-dark"] .kramail-character-option {
    color: var(--kr-text-primary) !important;
    border-bottom-color: var(--kr-border-default) !important;
  }

  /* ============================================================================
     MOBILE OPTIMISATION - PAGE MESSAGE KRAMAIL (kramail/post/*)
     Structure originale :
       - h1.page-header (titre seul)
       - div.forum-top > span.pull-right > a.btn×8 (boutons)
       - ul.media-list.forum > li.media.well (message)
         - div.pull-left > div.user-info (avatar + cartouche)
         - div.media-body (destinataires + date + contenu + signature)
       - div.center > ul.pagination (prev/next)
     Structure JS restructurée :
       - h1.page-header contient les boutons (déplacés par JS)
       - li.media.well.kramail-post-restructured (classe ajoutée par JS)
       - .kramail-msg-header (avatar + nom + date — horizontal)
       - .kramail-msg-recipients (envoyé à)
       - .kramail-msg-body (contenu pleine largeur)
     ============================================================================ */

  /* === BOUTONS PAGE MESSAGE — harmonisés avec inbox === */
  /* Le JS déplace les boutons dans h1 .pull-right, même sélecteurs que l'inbox */
  /* (les styles existants h1.page-header .pull-right > a.btn s'appliquent) */

  /* Masquer la barre forum-top originale (vidée par JS) */
  .forum-top:has(.kramail-actions-moved) {
    display: none !important;
  }

  /* === MESSAGE CARD — layout empilé mobile === */
  body.mobile-mode ul.media-list.forum > li.media.well.kramail-post-restructured {
    display: flex !important;
    flex-direction: column !important;
    padding: 0 !important;
    margin: 0 16px 16px !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    border-radius: 12px !important;
    overflow: hidden !important;
    list-style: none !important;
  }

  /* Cacher le pull-left original (avatar+cartouche) — remplacé par header */
  body.mobile-mode li.kramail-post-restructured > .pull-left {
    display: none !important;
  }

  /* Cacher le media-body original — remplacé par la nouvelle structure */
  body.mobile-mode li.kramail-post-restructured > .media-body {
    display: none !important;
  }

  /* --- Header : avatar compact + nom + date (horizontal) --- */
  .kramail-msg-header {
    display: flex !important;
    align-items: center !important;
    gap: 12px !important;
    padding: 12px 16px !important;
    border-bottom: 1px solid var(--kr-border-default) !important;
  }

  .kramail-msg-header .kramail-msg-avatar {
    width: 48px !important;
    height: 48px !important;
    border-radius: 8px !important;
    object-fit: cover !important;
    flex-shrink: 0 !important;
  }

  .kramail-msg-header-info {
    flex: 1 !important;
    min-width: 0 !important;
  }

  .kramail-msg-sender {
    font-size: 15px !important;
    font-weight: 600 !important;
    color: var(--kr-text-primary) !important;
    margin-bottom: 2px !important;
  }

  .kramail-msg-sender a {
    color: inherit !important;
    text-decoration: none !important;
  }

  .kramail-msg-date {
    font-size: 12px !important;
    color: var(--kr-text-muted) !important;
    display: flex !important;
    align-items: center !important;
    gap: 4px !important;
  }

  .kramail-msg-date i {
    font-size: 11px !important;
  }

  /* --- Destinataires --- */
  .kramail-msg-recipients {
    padding: 8px 16px !important;
    font-size: 13px !important;
    color: var(--kr-text-secondary) !important;
    border-bottom: 1px solid var(--kr-border-default) !important;
    line-height: 1.5 !important;
  }

  .kramail-msg-recipients strong {
    color: var(--kr-text-muted) !important;
    font-weight: 500 !important;
  }

  .kramail-msg-recipients a {
    color: var(--kr-primary) !important;
    text-decoration: none !important;
  }

  /* --- Corps du message — pleine largeur --- */
  .kramail-msg-body {
    padding: 16px !important;
    font-size: 15px !important;
    line-height: 1.6 !important;
    color: var(--kr-text-primary) !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
  }

  /* Blockquote modernisée — barre cuivre + fond distinct */
  .kramail-msg-body blockquote,
  .kramail-msg-body .blockquote,
  .kramail-msg-body .quote {
    margin: 12px 0 !important;
    padding: 12px 16px !important;
    border-left: 3px solid var(--kr-primary) !important;
    border-right: none !important;
    border-top: none !important;
    border-bottom: none !important;
    background: rgba(255, 255, 255, 0.03) !important;
    border-radius: 0 8px 8px 0 !important;
    font-size: 14px !important;
    color: var(--kr-text-secondary) !important;
    line-height: 1.5 !important;
  }

  .kramail-msg-body blockquote .fa-quote-left,
  .kramail-msg-body blockquote .text-warning {
    color: var(--kr-primary) !important;
    opacity: 0.6 !important;
    margin-right: 6px !important;
    font-size: 12px !important;
  }

  /* Signature — séparée visuellement */
  .kramail-msg-signature {
    margin-top: 16px !important;
    padding-top: 12px !important;
    border-top: 1px solid var(--kr-border-default) !important;
    font-size: 13px !important;
    color: var(--kr-text-muted) !important;
    line-height: 1.5 !important;
  }

  /* Images dans la signature (icons, smileys) */
  .kramail-msg-signature img.icon {
    max-height: 18px !important;
    vertical-align: middle !important;
  }

  /* === PAGINATION KRAMAIL MESSAGE === */
  body.mobile-mode .center:has(> ul.pagination) {
    padding: 8px 16px 16px !important;
  }

  body.mobile-mode .center > ul.pagination.t {
    display: flex !important;
    justify-content: center !important;
    gap: 8px !important;
    padding: 0 !important;
    margin: 0 !important;
    list-style: none !important;
  }

  body.mobile-mode .center > ul.pagination.t > li {
    list-style: none !important;
  }

  body.mobile-mode .center > ul.pagination.t > li > a {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 44px !important;
    height: 44px !important;
    border-radius: 10px !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    color: var(--kr-text-primary) !important;
    text-decoration: none !important;
    font-size: 16px !important;
    transition: all 0.15s !important;
  }

  body.mobile-mode .center > ul.pagination.t > li > a:active {
    transform: scale(0.97) !important;
    background: var(--kr-primary) !important;
    border-color: var(--kr-primary) !important;
    color: white !important;
  }

  /* ============================================================================
     MOBILE OPTIMISATION - MESSAGES DE FORUM (THREAD)
     Structure restructurée par JS:
     - Row 1: col-xs-4 (user) + col-xs-8 (boutons)
     - Row 2: col-xs-12 (contenu message)
     ============================================================================ */
  
  /* === STRUCTURE PRINCIPALE === */
  
  /* Container du post restructuré */
  ul.media-list.forum > li.media.forum-post-restructured {
    display: block !important;
    padding: 12px 8px !important;
    margin-bottom: 24px !important;
    list-style: none !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
  }
  
  /* Row 1: Header (user + boutons) */
  ul.media-list.forum > li.media .forum-header {
    margin-bottom: 12px !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    display: flex !important;
    flex-wrap: nowrap !important;
  }
  
  /* Row 2: Contenu */
  ul.media-list.forum > li.media .forum-content-row {
    margin-left: 0 !important;
    margin-right: 0 !important;
  }
  
  /* === COLONNE 1: USER INFO === */
  
  .forum-user-section {
    padding: 0 8px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    text-align: center !important;
  }
  
  /* Avatar */
  .forum-user-section img.avatar,
  .forum-user-section .user-info img:first-child {
    max-width: 80px !important;
    height: auto !important;
    border-radius: 4px !important;
    margin-bottom: 8px !important;
  }
  
  /* Nom d'utilisateur - sans ellipsis, wrap autorisé */
  .forum-user-section .cartouche strong,
  .forum-user-section strong a {
    font-size: 13px !important;
    line-height: 1.2 !important;
    display: block !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
    overflow: visible !important;
    text-overflow: clip !important;
    max-width: 100% !important;
    min-height: 0 !important;
  }
  
  /* Conteneur icône de rang + titre (inline) */
  .forum-user-section [data-kr-rank-title] {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 4px !important;
    flex-wrap: nowrap !important;
    margin-top: 4px !important;
    max-width: 100% !important;
  }
  
  .forum-user-section [data-kr-rank-title] img {
    flex-shrink: 0 !important;
    margin: 0 !important;
    max-width: 24px !important;
    max-height: 24px !important;
  }
  
  /* Titre de rang : inline sans ellipsis */
  .forum-user-section [data-kr-rank-title] strong {
    font-size: 10px !important;
    color: #bbb !important;
    font-weight: normal !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
    overflow: visible !important;
    text-overflow: clip !important;
    max-width: none !important;
    line-height: 1.3 !important;
    text-align: center !important;
    flex: 1 1 auto !important;
    min-width: 0 !important;
  }
  
  /* Date mobile ajoutée par JS */
  .forum-user-section .post-date-mobile {
    font-size: 11px !important;
    color: #999 !important;
    margin-top: 4px !important;
    text-align: center !important;
  }
  
  /* Titre/fonction - ellipsis */
  .forum-user-section strong:not(.cartouche strong):not([data-kr-rank-title] strong) {
    font-size: 10px !important;
    color: #bbb !important;
    font-weight: normal !important;
    margin-top: 4px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 100% !important;
  }
  
  /* === COLONNE 2: BOUTONS D'ACTION === */
  
  .forum-actions-section {
    padding: 0 8px !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: flex-end !important;
    gap: 8px !important;
  }
  
  /* Container des boutons */
  .forum-actions-section .pull-right {
    float: none !important;
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    align-items: center !important;
    gap: 8px !important;
    width: 100% !important;
  }
  
  /* Groupes de boutons inline */
  .forum-actions-section .btn-group {
    display: inline-flex !important;
    flex-direction: row !important;
    gap: 0 !important;
    flex-wrap: nowrap !important;
  }
  
  /* Boutons carrés 44x44px (WCAG touch target) */
  .forum-actions-section .btn {
    width: 44px !important;
    height: 44px !important;
    min-width: 44px !important;
    max-width: 44px !important;
    padding: 0 !important;
    margin: 0 !important;
    font-size: 14px !important;
    line-height: 44px !important;
    border: none !important;
    border-radius: 0 !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  
  /* Override Bootstrap min-width */
  .forum-actions-section .btn-group-xs > .btn,
  .forum-actions-section .btn-group-xs .btn {
    min-width: 44px !important;
  }
  
  /* Icônes des boutons */
  .forum-actions-section .btn i {
    font-size: 11px !important;
    line-height: 24px !important;
  }
  
  /* === ROW 2: CONTENU DU MESSAGE === */
  
  .forum-content-row {
    margin-top: 0 !important;
  }
  
  .forum-content-section {
    padding: 12px 8px !important;
    border-top: 1px dashed rgba(255, 255, 255, 0.15) !important;
    font-size: 15px !important;
    line-height: 1.6 !important;
    width: 100% !important;
  }
  
  /* Contenu du message */
  .forum-content-section .forum-msg,
  .forum-content-section > div {
    width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
  }
  
  /* Citations et blockquotes */
  .forum-content-section blockquote {
    margin: 8px 0 !important;
    padding: 8px 12px !important;
    border-left: 3px solid rgba(255, 255, 255, 0.2) !important;
    font-size: 14px !important;
  }
  
  /* Images dans le contenu */
  .forum-content-section img {
    max-width: 100% !important;
    height: auto !important;
  }
  
  /* Spoilers */
  .forum-content-section .spoiler {
    margin: 8px 0 !important;
  }
  
  /* Signature */
  .forum-content-section hr,
  .forum-content-section .signature {
    margin-top: 16px !important;
    padding-top: 16px !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    font-size: 12px !important;
    color: #999 !important;
}

/* ============================================================================
   11. NOUVEAU SUJET - MOBILE OPTIMIZATION
   Optimise la page "Poster un nouveau sujet" pour mobile
   - Toolbar BBCode horizontale scrollable
   - Inputs/buttons 44px minimum (touch target)
   - Font 16px pour éviter zoom iOS
   - Feedback visuel clair
   ============================================================================ */

@media (width <= 768px) {
  /* 0. LAYOUT - Fix Bootstrap grid overflow */
  
  /* Ajouter padding latéral pour ne pas coller au bord */
  .container,
  .container-fluid {
    padding-left: 12px !important;
    padding-right: 12px !important;
  }
  
  /* Réinitialiser les colonnes Bootstrap pour mobile */
  .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6,
  .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12 {
    float: none !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  /* Réinitialiser les form-group qui contiennent les colonnes */
  .form-group {
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 12px !important;
    padding-right: 12px !important;
    margin-bottom: var(--mobile-spacing-lg);
  }

  /* Réinitialiser input-group */
  .input-group {
    display: block !important;
    width: 100% !important;
  }

  /* CRÍTICA: Contenir les débordements de la toolbar dans le form-group */
  .form-group {
    overflow: hidden;
    width: 100%;
  }

  .form-group .col-md-10,
  .form-group .col-sm-10 {
    overflow: hidden;
  }

  /* 1. TOOLBAR BBCODE - Horizontal scrollable */
  
  .btn-toolbar {
    display: flex !important;           /* Override Bootstrap */
    flex-wrap: nowrap;                  /* Pas de wrapping */
    overflow-x: auto;                   /* Scrollbar horizontale */
    overflow-y: hidden;                 /* Pas de scrollbar verticale */
    gap: 4px;
    padding: 8px;
    margin-bottom: var(--mobile-spacing-md);
    background: rgba(0,0,0,0.02);
    border: 1px solid var(--kr-border-default);
    border-radius: var(--mobile-radius);
    -webkit-overflow-scrolling: touch;  /* iOS smooth scrolling */
    white-space: nowrap;                /* Empêche wrap des groupes */
  }

  /* Scrollbar styling (webkit browsers) */
  .btn-toolbar::-webkit-scrollbar {
    height: 4px;
  }

  .btn-toolbar::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.05);
    border-radius: 2px;
  }

  .btn-toolbar::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.15);
    border-radius: 2px;
  }

  /* Groupes de boutons - Layout horizontal */
  .btn-toolbar .btn-group {
    display: flex !important;           /* Override Bootstrap flex-column */
    flex-direction: row !important;
    flex-shrink: 0;                     /* Empêche compression */
    gap: 0;
    margin: 0 !important;
    margin-right: 8px;
    padding-right: 8px;
    border-right: 1px solid var(--kr-border-default);
  }

  .btn-toolbar .btn-group:last-child {
    margin-right: 0;
    padding-right: 0;
    border-right: none;
  }

  /* Boutons BBCode - Touch targets 44px */
  .btn-toolbar .btn {
    min-width: var(--mobile-touch-target) !important;
    width: var(--mobile-touch-target);
    height: var(--mobile-touch-target);
    padding: 0 !important;
    margin: 0 !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-size: 16px;                    /* Visible sur petit écran */
    border-radius: 6px;
    transition: all var(--transition-fast);
    flex-shrink: 0;
  }

  .btn-toolbar .btn:hover {
    background: rgba(139, 15, 14, 0.1);
    border-color: var(--kr-primary);
    color: var(--kr-primary);
  }

  .btn-toolbar .btn:active {
    background: rgba(139, 15, 14, 0.2);
    transform: scale(0.95);
  }

  .btn-toolbar .btn:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px rgba(139, 15, 14, 0.1);
    border-color: var(--kr-primary);
  }

  /* 2. FORM CONTROLS - Inputs, textareas, selects */

  .form-control {
    font-size: 16px !important;         /* iOS zoom prevention - CRITIQUE */
    min-height: var(--mobile-touch-target) !important;
    padding: 12px var(--mobile-spacing-md) !important;
    border-radius: var(--mobile-radius) !important;
    line-height: 1.5;
  }

  .form-control:focus {
    outline: none;
    border-color: var(--kr-primary);
    box-shadow: 0 0 0 3px rgba(139, 15, 14, 0.1);
  }

  /* Textarea - Priorité message */
  textarea.form-control {
    min-height: 150px !important;
    font-family: monospace;
    resize: vertical;
    line-height: 1.6;
  }

  /* Select - Styled au même niveau */
  select.form-control {
    height: auto;
    min-height: var(--mobile-touch-target);
  }

  /* 3. FORM GROUPS - Stack vertical */

  .form-group {
    margin-bottom: var(--mobile-spacing-lg);
  }

  .form-group label {
    display: block;
    margin-bottom: var(--mobile-spacing-sm);
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--kr-text);
  }

  .form-group label .required {
    color: var(--kr-primary);
  }

  /* 4. CHECKBOXES - Inline avec spacing tactile */

  .form-group .checkbox {
    display: inline-flex;
    align-items: center;
    gap: var(--mobile-spacing-md);
    min-height: var(--mobile-touch-target);
    margin-right: var(--mobile-spacing-lg);
    margin-bottom: 0;
    padding: 8px 0;
  }

  .form-group .checkbox input[type="checkbox"] {
    width: 20px !important;
    height: 20px !important;
    min-width: 20px;
    min-height: 20px;
    margin: 0 !important;
    cursor: pointer;
    accent-color: var(--kr-primary);
    flex-shrink: 0;
  }

  .form-group .checkbox label {
    display: inline;
    margin: 0;
    font-weight: 500;
    cursor: pointer;
    font-size: 16px;
    text-transform: none;
    letter-spacing: normal;
    padding: 8px 0;
  }

  /* 5. BOUTON ENVOYER - Sticky footer */

  button.btn-primary.pull-right {
    position: fixed !important;
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 90;
    width: 100% !important;
    height: 56px !important;
    margin: 0 !important;
    padding: 12px 16px !important;
    border-radius: 0 !important;
    font-size: 16px;
    font-weight: 600;
    border: none !important;
  }

  button.btn-primary.pull-right:active {
    background: var(--kr-primary-dark);
    transform: scale(0.98);
  }

  /* Padding au dernier form-group pour éviter overlap avec footer */
  .form-group:last-of-type {
    padding-bottom: 60px;
  }

  /* 6. ACCORDION/COLLAPSE - Options & Sondage */

  .panel-group {
    overflow: hidden;
    width: 100%;
  }

  .panel-title {
    font-size: 16px;
    margin: 0;
  }

  .accordion-toggle,
  a[data-toggle="collapse"] {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--mobile-spacing-md) var(--mobile-spacing-lg);
    background: rgba(0,0,0,0.02);
    border: 1px solid var(--kr-border-default);
    border-radius: var(--mobile-radius);
    cursor: pointer;
    transition: all var(--transition-fast);
    min-height: var(--mobile-touch-target);
    text-decoration: none;
    color: var(--kr-text);
    font-weight: 500;
  }

  .accordion-toggle:hover,
  a[data-toggle="collapse"]:hover {
    background: rgba(139, 15, 14, 0.05);
    border-color: var(--kr-primary);
    color: var(--kr-primary);
  }

  .panel-collapse {
    border: 1px solid var(--kr-border-default);
    border-radius: var(--mobile-radius);
    margin-top: -1px;
  }

  .panel-body {
    padding: var(--mobile-spacing-lg);
  }
}
/* ============================================================================
   KRAMAIL - FORMULAIRE NOUVEAU MESSAGE
   Page : /kramail/post/nouveau-*
   Harmonise le formulaire avec le design de la boîte de réception parente
   et améliore l'UX selon les heuristiques de Nielsen et la loi de Fitts
   ============================================================================ */

/* --- Styles universels (tous viewports) --- */

/* HR inutiles — supprimer le bruit visuel */
body.page-kramail .editeur-text .form-group hr {
  display: none !important;
}

body.page-kramail .editeur-text .form-group + .form-group > .col-sm-2:empty + .col-sm-10 > hr {
  display: none !important;
}

body.page-kramail .editeur-text .form-group:has(#results) {
  margin-bottom: 0;
  padding-top: 0;
}

body.page-kramail .editeur-text #results hr {
  display: none !important;
}

/* Curseur pointer pour selects et checkboxes */
body.page-kramail .editeur-text select.form-control {
  cursor: pointer;
}

body.page-kramail .editeur-text .form-group:has(input[type="checkbox"]) input[type="checkbox"] {
  cursor: pointer;
}

/* Astérisque required en couleur primaire */
body.page-kramail .editeur-text .form-group > label.control-label .required {
  color: var(--kr-primary);
  font-weight: 700;
}

/* Bouton retour Réception — style cohérent avec inbox */
body.page-kramail h1.page-header .btn-default {
  border-radius: var(--kr-radius);
  font-weight: 500;
  transition: all 0.15s ease;
}

body.page-kramail h1.page-header .btn-default:hover {
  border-color: var(--kr-primary);
  color: var(--kr-primary);
}

/* --- Styles desktop uniquement --- */
@media (min-width: 769px) {

  /* 1. CONTENEUR FORMULAIRE — carte visuelle cohérente avec inbox */
  body.page-kramail form.form-horizontal.editeur-text {
    background: var(--kr-bg-surface);
    border: 1px solid var(--kr-border-strong);
    border-radius: var(--kr-radius);
    padding: 28px 32px;
    margin-top: 8px;
    box-shadow: var(--kr-shadow-md);
  }

  /* 2. PAGE HEADER — ligne de séparation cohérente avec inbox */
  body.page-kramail h1.page-header {
    border-bottom-color: var(--kr-primary) !important;
    padding-bottom: 12px;
    margin-bottom: 16px;
  }

  /* 3. INPUT-GROUP-ADDON — meilleur contraste et cohérence */
  body.page-kramail .editeur-text .input-group-addon {
    background-color: var(--kr-bg-elevated);
    border-color: var(--kr-border-default);
    color: var(--kr-text-secondary);
    min-width: 42px;
    text-align: center;
  }

  body.page-kramail .editeur-text .input-group-addon i.fa,
  body.page-kramail .editeur-text .input-group-addon i.far,
  body.page-kramail .editeur-text .input-group-addon i.fas {
    color: var(--kr-primary);
    font-size: 14px;
  }

  /* 4. BOUTON "+" CONTACTS — plus gros, plus accessible (Fitts) */
  body.page-kramail .editeur-text .input-group-addon .btn.btn-primary {
    min-width: 36px;
    min-height: 32px;
    font-size: 16px;
    font-weight: 700;
    padding: 4px 12px;
    border-radius: 4px;
  }

  /* 5. SECTION DESTINATAIRE — meilleure lisibilité */
  body.page-kramail .editeur-text .form-group label[for],
  body.page-kramail .editeur-text .form-group > label.col-sm-1 {
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    color: var(--kr-text-secondary);
    font-weight: 600;
  }

  /* 6. SECTION OPTIONS — regroupement visuel */
  body.page-kramail .editeur-text .form-group:has(input[type="checkbox"]) {
    background: var(--kr-bg-hover);
    border: 1px solid var(--kr-border-default);
    border-radius: var(--kr-radius);
    padding: 16px 20px !important;
    margin-top: 8px;
  }

  body.page-kramail .editeur-text .form-group:has(input[type="checkbox"]) > label.col-md-2,
  body.page-kramail .editeur-text .form-group:has(input[type="checkbox"]) > label.col-sm-2 {
    color: var(--kr-text-primary);
    font-weight: 700;
    font-size: 14px;
  }

  body.page-kramail .editeur-text .form-group:has(input[type="checkbox"]) .checkbox-inline {
    margin-right: 24px;
    padding: 6px 4px 6px 24px;
    cursor: pointer;
  }

  /* 7. BOUTON ENVOYER — plus proéminent */
  body.page-kramail .editeur-text > div:last-child {
    text-align: right;
    padding-top: 16px;
    margin-top: 8px;
    border-top: 1px solid var(--kr-border-default);
    clear: both;
  }

  body.page-kramail .editeur-text button.btn-primary.pull-right {
    float: none !important;
    min-width: 180px;
    padding: 12px 32px;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: 0.3px;
    border-radius: var(--kr-radius);
    margin: 0;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px var(--kr-btn-shadow);
  }

  body.page-kramail .editeur-text button.btn-primary.pull-right:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px var(--kr-btn-shadow);
  }

  body.page-kramail .editeur-text button.btn-primary.pull-right:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px var(--kr-btn-shadow);
  }

  /* 8. TOOLBAR BBCODE — meilleure cohérence */
  body.page-kramail .editeur-text .btn-toolbar {
    background: var(--kr-bg-hover);
    border: 1px solid var(--kr-border-default);
    border-radius: var(--kr-radius);
    padding: 8px;
    margin-bottom: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }

  body.page-kramail .editeur-text .btn-toolbar .btn-group {
    margin-right: 4px;
    border-right: 1px solid var(--kr-border-default);
    padding-right: 8px;
  }

  body.page-kramail .editeur-text .btn-toolbar .btn-group:last-child {
    border-right: none;
    margin-right: 0;
    padding-right: 0;
  }

  body.page-kramail .editeur-text .btn-toolbar .btn {
    min-width: 34px;
    min-height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.15s ease;
  }

  body.page-kramail .editeur-text .btn-toolbar .btn:hover {
    background: var(--kr-bg-active) !important;
    border-color: var(--kr-primary) !important;
  }

  /* 9. TEXTAREA MESSAGE — hauteur minimale + bloc uni avec toolbar */
  body.page-kramail .editeur-text textarea[name="c[5]"],
  body.page-kramail .editeur-text textarea[placeholder="Votre message"] {
    min-height: 250px;
    line-height: 1.6;
  }

  body.page-kramail .editeur-text .col-sm-10 > .btn-toolbar + textarea.form-control {
    border-top-left-radius: 0 !important;
    border-top-right-radius: 0 !important;
    border-top: none !important;
    margin-top: 0;
  }

  body.page-kramail .editeur-text .col-sm-10 > .btn-toolbar {
    border-bottom-left-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
    margin-bottom: 0 !important;
    border-bottom: 1px solid var(--kr-border-default);
  }

  /* 10. LABELS — hiérarchie visuelle améliorée */
  body.page-kramail .editeur-text .form-group > label.control-label {
    font-size: 13px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.4px;
    color: var(--kr-text-secondary);
  }

  /* 11. FORM GROUPS — espacement vertical cohérent */
  body.page-kramail .editeur-text .form-group {
    margin-bottom: 20px;
  }

} /* fin @media (min-width: 769px) — Kramail formulaire desktop */

/* --- Styles mobile uniquement --- */
@media (max-width: 768px) {

  /* =============================================
     1. HEADER — masquer le character switcher
     Le sélecteur de compte est redondant avec le
     champ "Expéditeur" du formulaire.
     Le bouton retour passe sur la même ligne.
     ============================================= */

  /* Masquer le dropdown du character selector (formulaire uniquement) */
  body.page-kramail-compose h1.page-header .kramail-character-selector .kramail-character-dropdown,
  body.page-kramail-compose h1.page-header .kramail-character-selector .kramail-dropdown-icon {
    display: none !important;
  }

  /* Désactiver le curseur pointer et le comportement interactif (formulaire uniquement) */
  body.page-kramail-compose h1.page-header .kramail-character-selector {
    cursor: default !important;
    pointer-events: none;
  }

  /* Header : flex row pour aligner titre + back sur une ligne (formulaire uniquement) */
  body.page-kramail-compose h1.page-header {
    display: flex !important;
    flex-direction: row !important;
    align-items: center;
    gap: 10px;
    flex-wrap: nowrap;
  }

  /* Le sélecteur prend l'espace restant (formulaire uniquement) */
  body.page-kramail-compose h1.page-header .kramail-character-selector {
    flex: 1;
    min-width: 0;
  }

  /* Conteneur pull-right du bouton retour : pas de float, auto-width (formulaire uniquement) */
  body.page-kramail-compose h1.page-header .pull-right {
    float: none !important;
    width: auto !important;
    flex-shrink: 0;
    margin-left: auto;
  }

  /* Bouton retour Réception — taille tactile (formulaire uniquement) */
  body.page-kramail-compose h1.page-header .pull-right .btn {
    min-width: 44px;
    min-height: 44px;
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    font-size: 14px;
    white-space: nowrap;
  }

  /* =============================================
     2. INPUT-GROUPS — unifiés et collés
     Addon + input forment un bloc visuel cohérent :
     même hauteur 44px, radius uniquement aux extrémités,
     bordure partagée sans doublure.
     ============================================= */

  /* Le groupe flex inline */
  body.page-kramail .editeur-text .input-group {
    display: flex !important;
    flex-wrap: nowrap;
    border-radius: var(--mobile-radius);
    overflow: hidden;
  }

  /* Addon : bloc icône uniforme */
  body.page-kramail .editeur-text .input-group-addon {
    width: 44px !important;
    min-width: 44px !important;
    max-width: 44px !important;
    height: 44px !important;
    flex-shrink: 0;
    display: flex !important;
    align-items: center;
    justify-content: center;
    border-radius: 0 !important;
    border-right: none !important;
    padding: 0 !important;
  }

  /* Premier addon : radius gauche */
  body.page-kramail .editeur-text .input-group-addon:first-child {
    border-radius: var(--mobile-radius) 0 0 var(--mobile-radius) !important;
  }

  /* Input : colle à l'addon, pas de radius gauche */
  body.page-kramail .editeur-text .input-group .form-control {
    flex: 1;
    min-width: 0;
    height: 44px !important;
    border-radius: 0 var(--mobile-radius) var(--mobile-radius) 0 !important;
    border-left: none !important;
  }

  /* Bouton "+" contacts — même largeur 44px que les addons */
  body.page-kramail .editeur-text .input-group-addon .btn {
    width: 44px !important;
    height: 44px !important;
    max-width: 44px !important;
    min-width: 44px !important;
    padding: 0 !important;
    margin: 0 !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 700;
    border: none !important;
    background: transparent !important;
    color: inherit;
  }

  /* =============================================
     3. TOOLBAR BBCODE — barre continue
     Supprime les gaps inter-groupes.
     Radius uniquement aux extrémités de la barre.
     Les boutons dropdown s'intègrent dans le flux.
     ============================================= */

  /* Toolbar conteneur : barre continue */
  body.page-kramail .editeur-text .btn-toolbar {
    display: flex !important;
    flex-wrap: nowrap;
    gap: 0 !important;
    padding: 0 !important;
    border-radius: var(--mobile-radius) var(--mobile-radius) 0 0 !important;
    border: 1px solid var(--kr-border-default) !important;
    border-bottom: 1px solid var(--kr-border-default) !important;
    margin-bottom: 0 !important;
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    background: var(--kr-bg-hover);
  }

  /* Groupes de boutons : inline, pas de gap, pas de bordure propre */
  body.page-kramail .editeur-text .btn-toolbar .btn-group {
    flex-direction: row !important;
    width: auto !important;
    flex-shrink: 0;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    border-right: 1px solid var(--kr-border-default) !important;
    border-radius: 0 !important;
  }

  /* Dernier groupe visible : pas de bordure droite */
  body.page-kramail .editeur-text .btn-toolbar > .btn-group:last-child,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group[aria-label]:last-of-type {
    border-right: none !important;
  }

  /* Tous les boutons : 44px, sans radius, sans gap, icônes claires
     IMPORTANT : > .btn-group cible UNIQUEMENT les groupes directs de la toolbar,
     pas les .btn-group imbriqués dans les .dropdown-menu (ex: boutons couleur) */
  body.page-kramail .editeur-text .btn-toolbar > .btn-group > .btn,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group > a.btn,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group .dropdown > a > .btn,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group .dropdown .dropdown-toggle .btn,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group .dropdown > .dropdown-toggle {
    width: 44px !important;
    max-width: 44px !important;
    min-width: 44px !important;
    height: 44px !important;
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 0 !important;
    border: none !important;
    border-right: 1px solid rgba(255, 255, 255, 0.05) !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    background: transparent !important;
    color: var(--kr-text-primary, #f5f1ed) !important;
  }

  /* Icônes FontAwesome dans TOUS les boutons toolbar : couleur héritée */
  body.page-kramail .editeur-text .btn-toolbar > .btn-group > .btn i,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group > a.btn i {
    color: inherit !important;
  }

  /* Wrapper dropdown : pas de taille propre */
  body.page-kramail .editeur-text .btn-toolbar .btn-group .dropdown {
    display: flex !important;
    flex-shrink: 0;
  }

  /* Bouton dans le dropdown toggle (le <button> dans <a>)
     ATTENTION : cibler UNIQUEMENT le toggle, PAS les .btn du .dropdown-menu */
  body.page-kramail .editeur-text .btn-toolbar .btn-group .dropdown > .dropdown-toggle > .btn {
    width: 44px !important;
    height: 44px !important;
    min-width: 44px !important;
    max-width: 44px !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    background: transparent !important;
    color: var(--kr-text-primary, #d4a574) !important;
  }

  /* Icônes FontAwesome dans les toggles dropdown : couleur lisible */
  body.page-kramail .editeur-text .btn-toolbar .btn-group .dropdown > .dropdown-toggle > .btn i,
  body.page-kramail .editeur-text .btn-toolbar .btn-group .dropdown > .dropdown-toggle > .btn .fa,
  body.page-kramail .editeur-text .btn-toolbar .btn-group .dropdown > .dropdown-toggle > .btn .far {
    color: inherit !important;
  }

  /* Boutons couleur dans le dropdown-menu — respecter leur background inline */
  body.page-kramail .editeur-text .btn-toolbar .dropdown-menu .btn-group .btn {
    width: auto !important;
    height: auto !important;
    min-width: 28px !important;
    max-width: none !important;
    min-height: 28px !important;
    padding: 4px 6px !important;
    margin: 2px !important;
    border-radius: 4px !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
  }

  /* Premier bouton du premier groupe : radius haut-gauche */
  body.page-kramail .editeur-text .btn-toolbar > .btn-group:first-child > .btn:first-child,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group:first-child > a.btn:first-child {
    border-radius: var(--mobile-radius) 0 0 var(--mobile-radius) !important;
  }

  /* Dernier bouton du dernier groupe visible : radius haut-droite */
  body.page-kramail .editeur-text .btn-toolbar > .btn-group[aria-label]:last-of-type > .btn:last-child,
  body.page-kramail .editeur-text .btn-toolbar > .btn-group[aria-label]:last-of-type > a.btn:last-child {
    border-radius: 0 var(--mobile-radius) var(--mobile-radius) 0 !important;
    border-right: none !important;
  }

  /* Hover/Active feedback sur toolbar buttons */
  body.page-kramail .editeur-text .btn-toolbar .btn:active {
    background: rgba(139, 15, 14, 0.15) !important;
  }

  /* Scrollbar discrète */
  body.page-kramail .editeur-text .btn-toolbar::-webkit-scrollbar {
    height: 3px;
  }

  body.page-kramail .editeur-text .btn-toolbar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 2px;
  }

  /* Textarea collé à la toolbar */
  body.page-kramail .editeur-text .btn-toolbar + textarea.form-control,
  body.page-kramail .editeur-text .col-sm-10 > .btn-toolbar + textarea.form-control {
    border-top-left-radius: 0 !important;
    border-top-right-radius: 0 !important;
    border-top: none !important;
    margin-top: 0;
  }

  /* =============================================
     4. DROPDOWNS EMOJI/COULEUR — bottom-sheet
     Les dropdown-menus se positionnent en bas de 
     l'écran pour être accessibles au pouce.
     ============================================= */

  body.page-kramail .editeur-text .btn-toolbar .dropdown-menu {
    position: fixed !important;
    bottom: 60px !important;
    left: 8px !important;
    right: 8px !important;
    top: auto !important;
    width: auto !important;
    max-width: calc(100vw - 16px) !important;
    max-height: 50vh;
    overflow-y: auto;
    border-radius: var(--mobile-radius) var(--mobile-radius) 0 0 !important;
    box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.4) !important;
    z-index: 1050 !important;
    background: var(--kr-bg-surface) !important;
    border: 1px solid var(--kr-border-default) !important;
    padding: 12px !important;
  }

  /* =============================================
     5. CHECKBOXES — layout non-tronqué
     ============================================= */
  body.page-kramail .editeur-text .checkbox-inline {
    display: flex !important;
    align-items: center;
    gap: 8px;
    padding-left: 0 !important;
    margin-right: 16px;
    margin-bottom: 8px;
    min-height: 44px;
    white-space: nowrap;
  }

  body.page-kramail .editeur-text .checkbox-inline input[type="checkbox"] {
    position: static !important;
    margin-left: 0 !important;
    margin-top: 0 !important;
    width: 20px !important;
    height: 20px !important;
    min-width: 20px;
    flex-shrink: 0;
  }

  /* =============================================
     6. OPTIONS — conteneur visuel
     ============================================= */
  body.page-kramail .editeur-text .form-group:has(input[type="checkbox"]) {
    background: var(--kr-bg-hover);
    border: 1px solid var(--kr-border-default);
    border-radius: var(--mobile-radius);
    padding: 12px 16px !important;
    margin-top: 8px;
  }

  /* =============================================
     7. LABELS — hiérarchie avec couleur secondaire  
     ============================================= */
  body.page-kramail .editeur-text .form-group > label.control-label {
    color: var(--kr-text-secondary);
  }

  /* =============================================
     8. PADDING BOTTOM — espace pour le bouton Envoyer fixe
     ============================================= */
  body.page-kramail .editeur-text .form-group:last-of-type {
    padding-bottom: 70px !important;
  }

} /* fin @media (max-width: 768px) — Kramail formulaire mobile */

/* ============================================================================
   FORUM THREAD DETAIL - Hide tags
   ============================================================================ */

/* Masquer les tags dans la vue détail du fil (sujet) */
.forum-thread-detail > div:nth-of-type(2) {
  display: none;
}

/* Alternative: Cibler via la structure de la page forum */
.page-forum-sujet [role="main"] > div > div:nth-of-type(2) > div:nth-of-type(3) {
  display: none;
}

/* Fallback: Masquer les sections de tags générales dans les fils */
.forum-thread-metadata + div:has(a[href*="/forum/tags/"]) {
  display: none;
}

/* ============================================================================
   CHANGELOG MODAL
   ============================================================================ */

.kr-changelog-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.kr-changelog-modal.active {
  display: flex;
  opacity: 1;
}

.kr-changelog-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.75) !important; /* Fond encore plus sombre pour la lisibilité */
  cursor: pointer;
}

..kr-changelog-content {
  /* Positionner par rapport à la fenêtre pour garantir un centrage stable */
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  background: rgba(0, 0, 0, 0.95) !important; /* Fond noir opaque pour lisibilité */
  border: 1px solid rgba(255,255,255,0.06) !important; /* bord subtil clair */
  border-radius: var(--kr-radius) !important;
  box-shadow: var(--kr-shadow-lg) !important;
  width: 90% !important;
  max-width: 600px !important;
  max-height: 90vh !important;
  display: flex !important;
  flex-direction: column !important;
  z-index: 10001 !important;
  color: #ffffff !important; /* texte blanc pour contraste */
  overflow: hidden !important;
} 

/* Assurer le centrage parfait via flex du conteneur modal */
.kr-changelog-modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
}

.kr-changelog-header {
  padding: 24px 24px 16px;
  border-bottom: 1px solid var(--kr-border-default);
  position: relative;
}

.kr-changelog-header h2 {
  margin: 0;
  font-size: 20px;
  font-weight: 600;
  color: var(--kr-primary);
}
/* Le bouton croix n'est plus utilisé : masquer au cas où */
.kr-changelog-close { display: none !important; }

.kr-changelog-body {
  padding: 16px 24px;
  overflow-y: auto;
  flex: 1;
}

.kr-changelog-subtitle {
  margin: 0 0 16px 0;
  color: var(--kr-muted);
  font-size: 14px;
}

.kr-changelog-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.kr-changelog-list li {
  padding: 8px 0 8px 24px;
  position: relative;
  color: var(--kr-text);
  line-height: 1.5;
  font-size: 14px;
}

.kr-changelog-list li:before {
  content: '✓';
  position: absolute;
  left: 0;
  color: var(--kr-primary);
  font-weight: bold;
  font-size: 16px;
}

.kr-changelog-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--kr-border-default);
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.kr-changelog-footer button {
  flex: 1;
  min-width: 120px;
  padding: 10px 16px;
  border: 1px solid var(--kr-border-strong);
  border-radius: var(--kr-radius);
  background: var(--kr-surface);
  color: var(--kr-text);
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s;
}

.kr-changelog-view-all {
  background: var(--kr-primary) !important;
  color: white !important;
  border-color: var(--kr-primary) !important;
}

.kr-changelog-view-all:hover {
  background: var(--kr-primary-dark) !important;
  border-color: var(--kr-primary-dark) !important;
}

.kr-changelog-close-btn:hover {
  background: var(--kr-bg-hover);
}

/* Modal complet - vue historique */
.kr-changelog-modal.kr-changelog-full .kr-changelog-content-full {
  max-width: 800px;
}

.kr-changelog-body-full {
  max-height: 500px;
}

.kr-changelog-version {
  margin-bottom: 24px;
}

.kr-changelog-version h3 {
  margin: 0 0 12px 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--kr-primary);
  padding-bottom: 8px;
  border-bottom: 1px solid var(--kr-border-default);
}

.kr-changelog-version ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.kr-changelog-version li {
  padding: 6px 0 6px 20px;
  position: relative;
  color: var(--kr-text);
  line-height: 1.5;
  font-size: 13px;
}

.kr-changelog-version li:before {
  content: '•';
  position: absolute;
  left: 5px;
  color: var(--kr-primary);
  font-weight: bold;
}

/* Bouton sur la page profil */
.kr-changelog-btn {
  margin-bottom: 16px;
}

/* Style compact (inline) pour insertion avec le texte d'aide des alertes */
.kr-changelog-inline {
  color: var(--kr-primary);
  text-decoration: none;
  border: none;
  background: transparent;
  padding: 0;
  font-size: 13px;
  margin-left: 8px;
  vertical-align: middle;
  cursor: pointer;
  display: inline;
}
.kr-changelog-inline:hover {
  color: var(--kr-primary-dark);
  text-decoration: underline;
}

/* Responsive mobile */
@media (max-width: 768px) {
  .kr-changelog-content {
    width: 95%;
    max-height: 85vh;
  }

  .kr-changelog-header {
    padding: 16px 16px 12px;
  }

  .kr-changelog-header h2 {
    font-size: 18px;
  }

  .kr-changelog-body {
    padding: 12px 16px;
  }

  .kr-changelog-list li {
    padding: 6px 0 6px 20px;
    font-size: 13px;
  }

  .kr-changelog-footer {
    padding: 12px 16px;
    flex-direction: column;
  }

  .kr-changelog-footer button {
    width: 100%;
  }

  .kr-changelog-content-full {
    max-width: 95%;
  }
}

/* ---------------------------------------------------------------------------
   Corrections map : rendre les labels `.mini` lisibles en mode sombre
   - le thème sombre utilise des fonds nationaux semi-transparents (alpha 0.15)
     ce qui rend les chiffres difficiles à lire : on augmente l'opacité ici.
   - on ajoute aussi un léger padding / bordure pour conserver la lisibilité
   --------------------------------------------------------------------------- */
html[class*='-dark'] .mini {
  color: var(--kr-text-primary) !important; /* texte clair sur fond sombre */
  text-shadow: 0 1px 0 rgba(0,0,0,0.6);
  padding: 2px 6px;
  border-radius: 3px;
  font-weight: 700;
  background-image: none !important;
  background-color: rgba(0,0,0,0.6) !important; /* fond opaque pour lisibilité */
}

/* conserver la couleur nationale mais en opaque pour être lisible */
html[class*='-dark'] .mini.c3 { background-color: rgba(255,255,128,0.92) !important; color: var(--kr-text-inverse) !important; }
html[class*='-dark'] .mini.c5 { background-color: rgba(128,255,128,0.92) !important; color: var(--kr-text-inverse) !important; }

/* mode clair : conserver l'apparence originale mais améliorer la lisibilité */
html:not([class*='-dark']) .mini {
  padding: 2px 6px;
  border-radius: 3px;
  font-weight: 700;
}
