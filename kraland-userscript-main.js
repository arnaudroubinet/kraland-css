// ==UserScript==
// @name         Kraland Theme (Bundled)
// @namespace    https://www.kraland.org/
// @version      1.0.1768372128201
// @description  Injects the Kraland CSS theme (bundled)
// @match        http://www.kraland.org/*
// @match        https://www.kraland.org/*
// @run-at       document-start
// @grant        none
// ==/UserScript==

!function(){"use strict";if(function(){function isMobileDevice(){return window.innerWidth<768}function initMobileMode(){isMobileDevice()?(document.body.classList.add("mobile-mode"),console.log("[Kraland Mobile] Mode mobile activé"),function applyMobileCriticalStyles(){const applyStyles=()=>{document.querySelectorAll('[class*="col-"]').forEach(col=>{col.style.setProperty("padding-left","0px","important"),col.style.setProperty("padding-right","0px","important")}),document.querySelectorAll(".row").forEach(row=>{row.style.setProperty("margin-left","0px","important"),row.style.setProperty("margin-right","0px","important")}),document.querySelectorAll(".container, .container-fluid").forEach(container=>{container.style.setProperty("padding-left","0px","important"),container.style.setProperty("padding-right","0px","important")}),document.querySelectorAll(".dashboard").forEach(dashboard=>{dashboard.style.setProperty("margin-left","0px","important"),dashboard.style.setProperty("margin-right","0px","important"),dashboard.style.setProperty("width","100%","important"),dashboard.style.setProperty("padding","0px","important")})};applyStyles(),setTimeout(applyStyles,100),setTimeout(applyStyles,500)}()):(document.body.classList.remove("mobile-mode"),console.log("[Kraland Mobile] Mode desktop"))}let resizeTimeout;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initMobileMode):initMobileMode(),window.addEventListener("resize",function handleResize(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{initMobileMode()},150)}),window.KralandMobile={isMobile:isMobileDevice,reinit:initMobileMode}}(),function(){function initMobileHeader(){if(!document.body.classList.contains("mobile-mode"))return;if("undefined"==typeof jQuery||void 0===jQuery.fn.collapse)return console.warn("[Mobile Header] Bootstrap JS non chargé, utilisation du fallback"),void function initFallbackToggle(){const toggle=document.querySelector(".navbar-toggle"),collapse=document.querySelector(".navbar-collapse");toggle&&collapse&&(toggle.addEventListener("click",function(e){e.preventDefault(),collapse.classList.toggle("in");const expanded=collapse.classList.contains("in");toggle.setAttribute("aria-expanded",expanded),document.body.style.overflow=expanded?"hidden":""}),console.log("[Mobile Header] Fallback toggle initialisé"))}();const toggle=document.querySelector(".navbar-toggle"),collapse=document.querySelector(".navbar-collapse");if(toggle&&collapse){if(toggle.getAttribute("data-toggle")||toggle.setAttribute("data-toggle","collapse"),!toggle.getAttribute("data-target")){const collapseId=collapse.id||"navbar-collapse-mobile";collapse.id=collapseId,toggle.setAttribute("data-target","#"+collapseId)}!function initMenuAutoClose(){const collapse=document.querySelector(".navbar-collapse");if(!collapse)return;collapse.querySelectorAll("a:not(.dropdown-toggle)").forEach(link=>{link.addEventListener("click",function(){setTimeout(()=>{"undefined"!=typeof jQuery&&jQuery.fn.collapse?jQuery(collapse).collapse("hide"):(collapse.classList.remove("in"),document.body.style.overflow="")},150)})})}(),console.log("[Mobile Header] Header Bootstrap 3 initialisé")}else console.log("[Mobile Header] Éléments navbar-toggle ou navbar-collapse non trouvés")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(initMobileHeader,100)}):setTimeout(initMobileHeader,100),window.KralandMobile&&(window.KralandMobile.reinitHeader=initMobileHeader)}(),function(){function moveHeaderButtons(){if(!document.body.classList.contains("mobile-mode"))return;const navbarHeader=document.querySelector(".navbar-header"),navRight=document.querySelector(".navbar-right");if(!navbarHeader||!navRight)return void console.log("[Mobile Header Buttons] Éléments non trouvés");const allButtons=Array.from(navRight.querySelectorAll("li")),notificationBtn=allButtons.find(li=>li.querySelector(".fa-bell")&&!li.querySelector(".dropdown-menu")),kramailBtn=allButtons.find(li=>li.querySelector(".fa-envelope")&&!li.querySelector(".dropdown-menu")),paletteBtn=allButtons.find(li=>li.querySelector(".fa-palette")&&!li.querySelector(".dropdown-menu")),profileBtn=allButtons.find(li=>{const icon=li.querySelector(".fa-user"),hasDropdown=li.querySelector(".dropdown-menu");return icon&&hasDropdown}),mapBtn=allButtons.find(li=>li.querySelector(".fa-globe")&&!li.querySelector(".dropdown-menu"));if(!(notificationBtn||kramailBtn||paletteBtn||profileBtn||mapBtn))return void console.log("[Mobile Header Buttons] Aucun bouton trouvé");if(notificationBtn&&notificationBtn.hasAttribute("data-moved-to-header"))return;const leftButtonsContainer=document.createElement("div");if(leftButtonsContainer.className="navbar-header-buttons-left",notificationBtn&&(notificationBtn.setAttribute("data-moved-to-header","true"),leftButtonsContainer.appendChild(notificationBtn.cloneNode(!0))),kramailBtn&&(kramailBtn.setAttribute("data-moved-to-header","true"),leftButtonsContainer.appendChild(kramailBtn.cloneNode(!0))),paletteBtn&&(paletteBtn.setAttribute("data-moved-to-header","true"),leftButtonsContainer.appendChild(paletteBtn.cloneNode(!0))),profileBtn){profileBtn.setAttribute("data-moved-to-header","true");const profileClone=profileBtn.cloneNode(!0),dropdown=profileClone.querySelector(".dropdown-menu");dropdown&&dropdown.remove(),leftButtonsContainer.appendChild(profileClone)}mapBtn&&(mapBtn.setAttribute("data-moved-to-header","true"),leftButtonsContainer.appendChild(mapBtn.cloneNode(!0))),leftButtonsContainer.children.length>0&&navbarHeader.insertBefore(leftButtonsContainer,navbarHeader.firstChild);const navbarBrand=document.querySelector(".navbar-brand");navbarBrand&&(navbarBrand.style.display="none"),console.log("[Mobile Header Buttons] Boutons déplacés (notification, kramail, palette, profil, map)")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(moveHeaderButtons,150)}):setTimeout(moveHeaderButtons,150)}(),function(){function initMiniProfile(){document.body.classList.contains("mobile-mode")&&function createMiniProfile(){if(!document.body.classList.contains("mobile-mode"))return;if(document.querySelector(".mobile-mini-profile"))return;const profileData=function findProfileData(){const profileSection=document.getElementById("player-header-section"),mainPanel=document.getElementById("player-main-panel");if(!profileSection||!mainPanel)return console.warn("[Mobile Mini-Profile] Sections profil non trouvées"),null;const nameElement=profileSection.querySelector(".list-group-item.active"),playerName=nameElement?nameElement.textContent.replace("×","").trim():"Joueur",avatarLink=mainPanel.querySelector('.btn.alert100 img, a[href*="perso"] img, img[src*="avatar"]'),avatarSrc=avatarLink?avatarLink.src:null,moneyElement=Array.from(mainPanel.querySelectorAll("*")).find(el=>{const text=el.textContent.trim();return text.includes("MØ")&&0===el.children.length&&text.length<20}),money=moneyElement?moneyElement.textContent.trim():"0 MØ",vitalsSection=document.getElementById("player-vitals-section"),clockElement=vitalsSection?vitalsSection.querySelector(".c100"):null,findGaugeInSection=(section,type)=>{if(!section)return null;const gaugeEl=Array.from(section.querySelectorAll("*")).find(el=>{const text=el.textContent.trim(),hasType=text.startsWith(type)||text.includes(` ${type} `),hasNumber=/\d+/.test(text);return hasType&&hasNumber&&el.children.length<=2});if(!gaugeEl)return null;const text=gaugeEl.textContent.trim();if(text.match(/(\d+)\s*\/\s*(\d+)/))return function extractGaugeData(element,type){const text=element.textContent,match=text.match(/(\d+)\s*\/\s*(\d+)|(\d+)\s+\/\s+(\d+)/);if(!match){const numMatch=text.match(/\d+/);if(numMatch){const val=parseInt(numMatch[0]);return{type:type,current:val,max:val,percent:100}}return{type:type,current:0,max:1,percent:0}}const current=parseInt(match[1]||match[3]),max=parseInt(match[2]||match[4]);return{type:type,current:current,max:max,percent:Math.min(100,current/max*100)}}(gaugeEl,type.toLowerCase());{const valueMatch=text.match(/\d+/);if(!valueMatch)return null;const current=parseInt(valueMatch[0]),progressBar=gaugeEl.querySelector('.progress-bar, [class*="bar"]');let max=current;if(progressBar){const width=progressBar.style.width;if(width&&width.includes("%")){const percent=parseInt(width);percent>0&&(max=Math.round(100*current/percent))}}const percent=max>0?Math.min(100,current/max*100):0;return{type:type.toLowerCase(),current:current,max:max,percent:percent}}};return{name:playerName,avatar:avatarSrc,money:money,clock:clockElement?clockElement.textContent.trim():"--:--",gauges:{pv:findGaugeInSection(vitalsSection,"PV"),pm:findGaugeInSection(vitalsSection,"PM"),pp:findGaugeInSection(vitalsSection,"PP")}}}();if(!profileData)return void console.warn("[Mobile Mini-Profile] Données profil non trouvées");const miniProfile=document.createElement("div");miniProfile.className="mobile-mini-profile collapsed",miniProfile.setAttribute("data-task","1.4");const header=document.createElement("div");if(header.className="mobile-mini-profile-header",profileData.avatar){const avatar=document.createElement("img");avatar.src=profileData.avatar,avatar.className="avatar",avatar.alt="Avatar",header.appendChild(avatar)}const info=document.createElement("div");info.className="mobile-mini-profile-info";const name=document.createElement("div");name.className="mobile-mini-profile-name",name.textContent=profileData.name,info.appendChild(name);const moneyRow=document.createElement("div");moneyRow.className="mobile-mini-profile-money",moneyRow.innerHTML=`\n        <span>${profileData.money}</span>\n        <span class="mobile-mini-profile-clock">⏱️ ${profileData.clock}</span>\n      `,info.appendChild(moneyRow),header.appendChild(info),miniProfile.appendChild(header);const settings=document.createElement("a");settings.href="/jouer/perso",settings.className="mobile-mini-profile-settings",settings.innerHTML="⚙️",settings.title="Voir le personnage",settings.addEventListener("click",e=>e.stopPropagation()),miniProfile.appendChild(settings);const gaugesCompact=document.createElement("div");gaugesCompact.className="mobile-mini-profile-gauges-compact",["pv","pm","pp"].forEach(type=>{const gauge=profileData.gauges[type];if(!gauge)return;const el=document.createElement("div");el.className="mobile-gauge-compact",el.innerHTML=`\n          <span class="mobile-gauge-compact-label">${type.toUpperCase()}</span>\n          <div class="mobile-gauge-compact-bar">\n            <div class="mobile-gauge-compact-fill ${type}" style="width: ${gauge.percent}%"></div>\n          </div>\n          <span class="mobile-gauge-compact-value">${gauge.current}</span>\n        `,gaugesCompact.appendChild(el)}),miniProfile.appendChild(gaugesCompact);const details=document.createElement("div");details.className="mobile-mini-profile-details";const gaugesFull=document.createElement("div");gaugesFull.className="mobile-mini-profile-gauges-full",["pv","pm","pp"].forEach(type=>{const gauge=profileData.gauges[type];if(!gauge)return;const el=document.createElement("div");el.className="mobile-gauge-full",el.innerHTML=`\n          <div class="mobile-gauge-full-header">\n            <span>${type.toUpperCase()}</span>\n            <span>${gauge.current}/${gauge.max}</span>\n          </div>\n          <div class="mobile-gauge-full-bar">\n            <div class="mobile-gauge-full-fill ${type}" style="width: ${gauge.percent}%"></div>\n          </div>\n        `,gaugesFull.appendChild(el)}),details.appendChild(gaugesFull),miniProfile.appendChild(details),miniProfile.addEventListener("click",e=>{e.target.classList.contains("mobile-mini-profile-settings")||e.target.closest(".mobile-mini-profile-settings")||(miniProfile.classList.toggle("collapsed"),miniProfile.classList.toggle("expanded"),console.log("[Mobile Mini-Profile] État:",miniProfile.classList.contains("expanded")?"déplié":"replié"))});const tabBar=document.querySelector(".mobile-tab-bar"),container=document.getElementById("content")||document.body;tabBar&&tabBar.nextSibling?tabBar.parentNode.insertBefore(miniProfile,tabBar.nextSibling):container.insertBefore(miniProfile,container.firstChild),console.log("[Mobile Mini-Profile] Créé avec succès"),console.log("  - Nom:",profileData.name),console.log("  - Argent:",profileData.money),console.log("  - Horloge:",profileData.clock),console.log("  - PV:",profileData.gauges.pv?`${profileData.gauges.pv.current}/${profileData.gauges.pv.max}`:"N/A")}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(initMiniProfile,250)}):setTimeout(initMiniProfile,250),window.KralandMobile&&(window.KralandMobile.initMiniProfile=initMiniProfile)}(),function(){function initQuickActions(){document.body.classList.contains("mobile-mode")&&function createQuickActions(){if(!document.body.classList.contains("mobile-mode"))return;if(document.querySelector(".mobile-quick-actions"))return;const actionsSection=document.getElementById("player-actions-section");if(!actionsSection)return void console.warn("[Mobile Quick Actions] Section actions non trouvée");const originalButtons=actionsSection.querySelectorAll("a.btn, button.btn");if(0===originalButtons.length)return void console.warn("[Mobile Quick Actions] Aucun bouton trouvé");const container=document.createElement("div");container.className="btn-group btn-group-justified mobile-quick-actions",container.setAttribute("role","group"),container.setAttribute("data-task","1.5"),originalButtons.forEach(originalBtn=>{const btnGroup=document.createElement("div");btnGroup.className="btn-group",btnGroup.setAttribute("role","group");const btn=originalBtn.cloneNode(!0);btn.classList.add("mobile-quick-action");const icon=btn.querySelector("i"),label=btn.textContent.trim();if(btn.innerHTML="",icon){const iconClone=icon.cloneNode(!0);iconClone.classList.add("mobile-quick-action-icon"),btn.appendChild(iconClone)}const labelSpan=document.createElement("span");labelSpan.className="mobile-quick-action-label",labelSpan.textContent=label,btn.appendChild(labelSpan),btnGroup.appendChild(btn),container.appendChild(btnGroup)});const miniProfile=document.querySelector(".mobile-mini-profile"),tabBar=document.querySelector(".mobile-tab-bar");miniProfile&&miniProfile.nextSibling?miniProfile.parentNode.insertBefore(container,miniProfile.nextSibling):tabBar&&tabBar.nextSibling?tabBar.parentNode.insertBefore(container,tabBar.nextSibling):document.body.insertBefore(container,document.body.firstChild),console.log("[Mobile Quick Actions] Créées avec",originalButtons.length,"actions")}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(initQuickActions,300)}):setTimeout(initQuickActions,300),window.KralandMobile&&(window.KralandMobile.initQuickActions=initQuickActions)}(),function(){function removeHomepageCarousel(){if(!document.body.classList.contains("mobile-mode"))return;if("/"!==window.location.pathname&&"/accueil"!==window.location.pathname&&!window.location.pathname.endsWith("/"))return;const carousel=document.querySelector(".carousel");carousel?(carousel.remove(),console.log("[Homepage Carousel] Carousel supprimé en mode mobile")):console.log("[Homepage Carousel] Carousel non trouvé sur la page")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",removeHomepageCarousel):removeHomepageCarousel(),window.KralandMobile&&(window.KralandMobile.removeHomepageCarousel=removeHomepageCarousel)}(),function(){function initTabBar(){document.body.classList.contains("mobile-mode")&&function createTabBar(){if(!document.body.classList.contains("mobile-mode"))return;if(document.querySelector(".mobile-tab-bar"))return;const navLinks=function findNavigationLinks(){const links=[];return[{pattern:"/jouer/plateau",label:"Agir",icon:"fa-bolt"},{pattern:"/jouer/materiel",label:"Matériel",icon:"fa-cube"},{pattern:"/jouer/perso",label:"Personnage",icon:"fa-user"},{pattern:"/jouer/bat",label:"Bâtiments",icon:"fa-home"},{pattern:"/jouer/pnj",label:"Employés",icon:"fa-users"}].forEach(item=>{const link=document.querySelector(`a[href*="${item.pattern}"]`);link&&links.push({href:link.getAttribute("href"),text:link.textContent.trim()||item.label,pattern:item.pattern,icon:item.icon})}),links}();if(0===navLinks.length)return void console.warn("[Mobile Tab Bar] Liens navigation jeu non trouvés");const tabBar=document.createElement("ul");tabBar.className="nav nav-tabs mobile-tab-bar",tabBar.setAttribute("role","tablist"),navLinks.forEach(linkData=>{const li=document.createElement("li");li.setAttribute("role","presentation");const a=document.createElement("a");a.href=linkData.href,a.setAttribute("role","tab");const icon=document.createElement("i");icon.className=`fa ${linkData.icon} mobile-tab-icon`;const label=document.createElement("span");label.className="mobile-tab-label",label.textContent=linkData.text,a.appendChild(icon),a.appendChild(label),window.location.pathname.includes(linkData.pattern)?(li.classList.add("active"),a.setAttribute("aria-selected","true")):a.setAttribute("aria-selected","false"),li.appendChild(a),tabBar.appendChild(li)});const header=document.querySelector(".navbar")||document.querySelector("header")||document.body.firstElementChild;header&&header.nextSibling?header.parentNode.insertBefore(tabBar,header.nextSibling):document.body.insertBefore(tabBar,document.body.firstChild),function handleTabBarScroll(tabBar){const checkScroll=()=>{const isAtEnd=tabBar.scrollLeft+tabBar.clientWidth>=tabBar.scrollWidth-5;tabBar.classList.toggle("scrolled-end",isAtEnd)};tabBar.addEventListener("scroll",checkScroll),setTimeout(checkScroll,100),window.addEventListener("resize",checkScroll)}(tabBar),setTimeout(()=>function scrollToActiveTab(tabBar){const activeTab=tabBar.querySelector("li.active > a");if(!activeTab)return;const tabBarRect=tabBar.getBoundingClientRect(),activeRect=activeTab.getBoundingClientRect(),scrollLeft=activeRect.left-tabBarRect.left-tabBarRect.width/2+activeRect.width/2;tabBar.scrollTo({left:tabBar.scrollLeft+scrollLeft,behavior:"smooth"})}(tabBar),100),console.log("[Mobile Tab Bar] Créée avec",navLinks.length,"onglets")}()}window.KralandMobile&&(window.KralandMobile.initTabBar=initTabBar),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>setTimeout(initTabBar,100)):setTimeout(initTabBar,100)}(),function(){const STORAGE_KEY="kraland_dismissed_alerts";function getDismissedAlerts(){try{const stored=localStorage.getItem(STORAGE_KEY);return stored?JSON.parse(stored):[]}catch(e){return console.warn("[Alerts Memory] Erreur lecture localStorage:",e),[]}}function getAlertId(alert){return alert.id?alert.id:"alert_"+function simpleHash(str){let hash=0;for(let i=0;i<str.length;i++)hash=(hash<<5)-hash+str.charCodeAt(i),hash&=hash;return Math.abs(hash).toString(36)}(alert.textContent.trim().replace(/\s+/g," "))}function initAlertsMemory(){!function hideRememberedAlerts(){const dismissedAlerts=getDismissedAlerts();if(0===dismissedAlerts.length)return;const alerts=document.querySelectorAll(".alert.alert-dismissible");let hiddenCount=0;alerts.forEach(alert=>{const alertId=getAlertId(alert);dismissedAlerts.includes(alertId)&&(alert.style.display="none",hiddenCount++)}),hiddenCount>0&&console.log(`[Alerts Memory] ${hiddenCount} alerte(s) masquée(s) automatiquement`)}(),function watchAlertDismissal(){const alerts=document.querySelectorAll(".alert.alert-dismissible");alerts.forEach(alert=>{const closeBtn=alert.querySelector('.close, [data-dismiss="alert"]');closeBtn&&closeBtn.addEventListener("click",function(){!function saveDismissedAlert(alertId){try{const dismissed=getDismissedAlerts();dismissed.includes(alertId)||(dismissed.push(alertId),localStorage.setItem(STORAGE_KEY,JSON.stringify(dismissed)),console.log("[Alerts Memory] Alerte mémorisée:",alertId))}catch(e){console.warn("[Alerts Memory] Erreur sauvegarde localStorage:",e)}}(getAlertId(alert))})}),console.log(`[Alerts Memory] Surveillance activée pour ${alerts.length} alerte(s)`)}()}function addResetButtonToInterfacePage(){if(!window.location.pathname.includes("/profil/interface"))return;const checkForm=setInterval(()=>{const tamperForm=document.querySelector("#kr-tamper-theme-form");if(!tamperForm)return;clearInterval(checkForm);const section=document.createElement("div");section.className="form-group",section.style.marginTop="20px",section.style.paddingTop="15px",section.style.borderTop="1px solid rgba(255, 255, 255, 0.1)";const label=document.createElement("label");label.className="col-sm-3 control-label",label.style.paddingLeft="0px",label.style.paddingRight="0px",label.textContent="Alertes";const btnContainer=document.createElement("div");btnContainer.className="col-sm-9",btnContainer.style.paddingLeft="0px";const resetBtn=document.createElement("button");resetBtn.type="button",resetBtn.className="btn btn-warning btn-block";const icon=document.createElement("span");icon.className="glyphicon glyphicon-refresh",icon.style.marginRight="5px";const text=document.createTextNode("Réinitialiser les alertes fermées");resetBtn.appendChild(icon),resetBtn.appendChild(text),resetBtn.addEventListener("click",function(){const count=getDismissedAlerts().length;0!==count?confirm(`Voulez-vous vraiment réinitialiser ${count} alerte(s) fermée(s) ? Elles réapparaîtront lors du prochain chargement de page.`)&&(localStorage.removeItem(STORAGE_KEY),console.log("[Alerts Memory] Alertes mémorisées effacées"),icon.className="glyphicon glyphicon-ok",resetBtn.textContent="",resetBtn.appendChild(icon),resetBtn.appendChild(document.createTextNode(` ${count} alerte(s) réinitialisée(s) !`)),resetBtn.className="btn btn-success btn-block",setTimeout(()=>{icon.className="glyphicon glyphicon-refresh",resetBtn.textContent="",resetBtn.appendChild(icon),resetBtn.appendChild(document.createTextNode(" Réinitialiser les alertes fermées")),resetBtn.className="btn btn-warning btn-block"},3e3)):alert("Aucune alerte fermée à réinitialiser.")});const helpText=document.createElement("p");helpText.className="help-block",helpText.style.marginTop="10px",helpText.style.fontSize="12px",helpText.style.opacity="0.7",helpText.textContent=`${getDismissedAlerts().length} alerte(s) actuellement masquée(s)`,btnContainer.appendChild(resetBtn),btnContainer.appendChild(helpText),section.appendChild(label),section.appendChild(btnContainer),tamperForm.parentNode.insertBefore(section,tamperForm.nextSibling),console.log("[Alerts Memory] Bouton de réinitialisation ajouté")},100)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initAlertsMemory):initAlertsMemory(),"loading"===document.readyState?(document.addEventListener("DOMContentLoaded",initAlertsMemory),document.addEventListener("DOMContentLoaded",addResetButtonToInterfacePage)):(initAlertsMemory(),addResetButtonToInterfacePage()),window.KralandMobile&&(window.KralandMobile.clearDismissedAlerts=function(){localStorage.removeItem(STORAGE_KEY),console.log("[Alerts Memory] Alertes mémorisées effacées")})}(),function(){function addWelcomeMessage(){const path=window.location.pathname;if("/"!==path&&"/accueil"!==path&&!path.startsWith("/accueil"))return;const userNameH4=Array.from(document.querySelectorAll("h4.list-group-item-heading.count")).find(h4=>{const text=h4.textContent.trim();return!/^\d+$/.test(text)&&text.length>0});if(!userNameH4)return void console.log("[Welcome Message] Nom d'utilisateur non trouvé");const userName=userNameH4.textContent.trim();userName.startsWith("Bienvenu")||(userNameH4.textContent="Bienvenu "+userName,console.log("[Welcome Message] Message de bienvenue ajouté pour:",userName))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",addWelcomeMessage):addWelcomeMessage()}(),function(){function initGroupsAccordion(){if(!document.body.classList.contains("mobile-mode"))return;const sections=document.querySelectorAll(".dashboard-section");let count=0;sections.forEach(section=>{const header=section.querySelector(".dashboard-section-header"),title=section.querySelector(".dashboard-group-title");if(header&&title){const isMyGroup=section.classList.contains("dashboard-section-mygroup");!function makeGroupCollapsible(section,isMyGroup){const header=section.querySelector(".dashboard-section-header"),cardsGrid=section.querySelector(".dashboard-cards-grid");if(!header||!cardsGrid)return;header.classList.add("dashboard-section-header-accordion");const isExpanded=isMyGroup;cardsGrid.classList.toggle("collapsed",!isExpanded),header.classList.toggle("expanded",isExpanded);const icon=document.createElement("i");icon.className="fa fa-chevron-down accordion-icon",header.appendChild(icon),header.style.cursor="pointer",header.addEventListener("click",e=>{if(e.target.closest(".dashboard-group-buttons"))return;const isNowExpanded=!cardsGrid.classList.contains("collapsed");cardsGrid.classList.toggle("collapsed",isNowExpanded),header.classList.toggle("expanded",!isNowExpanded),console.log("[Group Accordion]",section.querySelector(".dashboard-group-title")?.textContent,isNowExpanded?"collapsed":"expanded")}),console.log("[Group Accordion] Groupe configuré:",section.querySelector(".dashboard-group-title")?.textContent,"état initial:",isExpanded?"ouvert":"fermé")}(section,isMyGroup),count++}}),console.log("[Groups Accordion] Initialisé pour",count,"groupes")}window.KralandMobile&&(window.KralandMobile.initGroupsAccordion=initGroupsAccordion),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>setTimeout(initGroupsAccordion,150)):setTimeout(initGroupsAccordion,150)}(),function initCommerceAccordion(){if(!document.body.classList.contains("mobile-mode"))return;const categories=["Nourriture","Repas","Boissons","Bons d'état / Loterie","Services"],categoryDivs=[];document.querySelectorAll("h4.list-group-item-heading").forEach(h4=>{const categoryName=h4.textContent.trim();if(categories.includes(categoryName)){const categoryDiv=h4.parentElement;categoryDiv&&categoryDiv.classList.contains("list-group-item")&&categoryDivs.push({name:categoryName,div:categoryDiv,h4:h4})}}),0!==categoryDivs.length&&(console.log(`[Commerce Accordion] Trouvé ${categoryDivs.length} catégories`),categoryDivs.forEach((category,index)=>{const products=[];let currentElement=category.div.nextElementSibling;for(;currentElement&&(!currentElement.classList.contains("ds_forum")||!currentElement.querySelector("h4.list-group-item-heading"));)"A"===currentElement.tagName&&currentElement.classList.contains("ds_game")&&products.push(currentElement),currentElement=currentElement.nextElementSibling;const productsContainer=document.createElement("div");productsContainer.className="commerce-products-container",products.forEach(product=>{productsContainer.appendChild(product)}),category.div.parentElement.insertBefore(productsContainer,category.div.nextSibling),category.div.classList.add("commerce-category-header");const isExpanded=0===index;isExpanded?category.div.classList.add("expanded"):(productsContainer.classList.add("collapsed"),category.div.classList.add("collapsed"));const icon=document.createElement("i");icon.className="fa fa-chevron-down accordion-icon",category.h4.appendChild(icon),category.div.style.cursor="pointer",category.div.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const isNowExpanded=!productsContainer.classList.contains("collapsed");productsContainer.classList.toggle("collapsed",isNowExpanded),category.div.classList.toggle("collapsed",isNowExpanded),category.div.classList.toggle("expanded",!isNowExpanded),console.log(`[Commerce Accordion] ${category.name}: ${isNowExpanded?"fermé":"ouvert"}`)}),console.log(`[Commerce Accordion] ${category.name}: ${products.length} produits, état initial: ${isExpanded?"ouvert":"fermé"}`)}))}(),function initBuildingCollapse(){if(!document.body.classList.contains("mobile-mode"))return;const batimentHeader=Array.from(document.querySelectorAll("h3.panel-title")).find(h=>h.textContent.includes("Bâtiment"));if(!batimentHeader)return;const panelHeading=batimentHeader.parentElement,panelBody=panelHeading.nextElementSibling;if(!panelHeading||!panelBody||!panelBody.classList.contains("panel-body"))return;panelHeading.classList.add("building-section-header"),panelBody.classList.add("building-section-content");const icon=document.createElement("i");icon.className="fa fa-chevron-down accordion-icon",panelHeading.appendChild(icon),panelHeading.classList.add("expanded"),panelHeading.style.cursor="pointer",panelHeading.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const isNowExpanded=!panelBody.classList.contains("collapsed");panelBody.classList.toggle("collapsed",isNowExpanded),panelHeading.classList.toggle("collapsed",isNowExpanded),panelHeading.classList.toggle("expanded",!isNowExpanded),console.log("[Building Section] "+(isNowExpanded?"fermé":"ouvert"))}),console.log("[Building Section] Initialisé - section collapsible")}(),function(){function initNavigationRow(){if(!document.body.classList.contains("mobile-mode"))return;const quickActions=document.querySelector(".mobile-quick-actions");if(!quickActions)return;const exitImg=document.querySelector('img[alt="Sortir"]');if(!exitImg)return;const parent=exitImg.parentElement,map=parent.querySelector('map[name="exitmap"]'),allBatImages=Array.from(document.querySelectorAll('img[src*="/bat/bat"]'));if(0===allBatImages.length)return;const originalImages=allBatImages.filter(img=>{let current=img;for(;current&&current!==document.body;){if(current.classList&&current.classList.contains("kr-navigation-row"))return!1;current=current.parentElement}return!0});if(originalImages.sort((a,b)=>parseInt(a.src.match(/bat(\d+)\.gif/)?.[1]||"999")-parseInt(b.src.match(/bat(\d+)\.gif/)?.[1]||"999")),0===originalImages.length)return;const originalContainer=parent.closest(".row.center");originalContainer&&(originalContainer.style.display="none");const roomLinks=originalImages.map(img=>img.closest("a")).filter(link=>null!==link);if(0===roomLinks.length)return;const navRow=document.createElement("div");if(navRow.className="kr-navigation-row",navRow.setAttribute("role","group"),exitImg&&map){const directionGroup=document.createElement("div");directionGroup.className="btn-group kr-direction-cross",directionGroup.setAttribute("role","group");const directionLink=document.createElement("div");directionLink.className="btn btn-default alert11 mini kr-direction-link";const exitImgClone=exitImg.cloneNode(!0);exitImgClone.style.width="60px",exitImgClone.style.height="60px",exitImgClone.style.display="block";const mapClone=map.cloneNode(!0);mapClone.querySelectorAll("area").forEach(area=>{area.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const url=area.href;url&&"#"!==url&&(window.location.href=url)})}),directionLink.appendChild(exitImgClone),directionLink.appendChild(mapClone),directionGroup.appendChild(directionLink),navRow.appendChild(directionGroup)}roomLinks.forEach(link=>{const btnGroup=document.createElement("div");btnGroup.className="btn-group kr-room-access-card",btnGroup.setAttribute("role","group");const linkClone=link.cloneNode(!0);linkClone.className="btn btn-default alert11 mini kr-room-link",linkClone.addEventListener("click",e=>{e.stopPropagation();const url=linkClone.href;url&&"#"!==url&&(window.location.href=url)}),btnGroup.appendChild(linkClone),navRow.appendChild(btnGroup)}),quickActions.parentElement.insertBefore(navRow,quickActions.nextSibling),console.log(`[Navigation Row] Initialisée avec croix directionnelle et ${roomLinks.length} accès aux pièces`)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(initNavigationRow,350)}):setTimeout(initNavigationRow,350)}(),window.innerWidth<768&&window.location.hash&&"#top"!==window.location.hash){const initialScrollRestoration=history.scrollRestoration;history.scrollRestoration="manual";const cleanUrl=window.location.pathname+window.location.search;history.replaceState(null,"",cleanUrl);const forceScrollTop=()=>window.scrollTo(0,0);forceScrollTop(),"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",forceScrollTop),window.addEventListener("load",forceScrollTop),setTimeout(()=>{history.scrollRestoration=initialScrollRestoration},500)}if(window.innerWidth<768&&!window.__krNewsToggleInit){function initNewsToggle(){const newsToggle=document.getElementById("slide-submenu"),newsContainer=document.getElementById("player-header-section");if(newsToggle&&newsContainer){function updateButton(isCollapsed){newsToggle.innerHTML=isCollapsed?"▼":"×",newsToggle.setAttribute("aria-label",isCollapsed?"Déplier les nouvelles":"Replier les nouvelles"),newsToggle.setAttribute("title",isCollapsed?"Déplier":"Replier")}const isCollapsed="true"===localStorage.getItem("kr-news-collapsed");isCollapsed&&newsContainer.classList.add("kr-news-collapsed"),updateButton(isCollapsed),newsToggle.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),newsContainer.classList.toggle("kr-news-collapsed");const collapsed=newsContainer.classList.contains("kr-news-collapsed");localStorage.setItem("kr-news-collapsed",collapsed),updateButton(collapsed)},{capture:!0})}}window.__krNewsToggleInit=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initNewsToggle,{once:!0}):"interactive"!==document.readyState&&"complete"!==document.readyState||requestAnimationFrame(()=>{setTimeout(initNewsToggle,50)})}const CONFIG={BUNDLED_CSS:':root{--kr-primary:#8b0f0e;--kr-primary-dark:#700b09;--kr-gold:#C69100;--kr-highlight:#c41e3a;--kr-highlight-reverse:#f9d9de;--kr-surface:#fff;--kr-text:#0f1724;--kr-muted:#6b7280;--kr-navbar-bg:#111315;--kr-radius:.5rem;--kr-avatar-size:120px;--kr-bg-page:#f5f5f5;--kr-bg-surface:#fff;--kr-bg-elevated:#fff;--kr-bg-hover:rgb(0,0,0,0.02);--kr-bg-active:rgb(0,0,0,0.05);--kr-text-primary:#0f1724;--kr-text-secondary:#6b7280;--kr-text-muted:#9ca3af;--kr-text-inverse:#fff;--kr-border-default:rgb(0,0,0,0.08);--kr-border-strong:rgb(0,0,0,0.15);--kr-shadow-sm:0 1px 2px rgb(0,0,0,0.05);--kr-shadow-md:0 4px 6px rgb(0,0,0,0.07);--kr-shadow-lg:0 10px 15px rgb(0,0,0,0.1);--kr-white:#fff;--kr-focus-ring:rgb(164,18,13,0.22);--kr-focus-ring-light:rgb(164,18,13,0.18);--kr-alert-info-bg:rgb(164,18,13,0.06);--kr-alert-info-border:rgb(164,18,13,0.14);--kr-btn-shadow:rgb(165,18,13,0.12);--kr-badge-danger:#dc3545;--kr-badge-danger-border:#bd2130;--kr-badge-pnj:#d9534f;--kr-bootstrap-blue:#337ab7;--kr-nation-1:#C41E3A;--kr-nation-2:#C69100;--kr-nation-3:#FF0;--kr-nation-4:#0033A0;--kr-nation-5:#0B6623;--kr-nation-6:#6A0DAD;--kr-nation-7:#6B7280;--kr-nation-8:#0A6B2D;--kr-nation-9:#a70;--kr-nation-bg-1:rgb(255, 128, 128, 0.2);--kr-nation-bg-2:rgb(170, 112, 0, 0.3);--kr-nation-bg-3:rgb(255, 255, 128, 0.15);--kr-nation-bg-4:rgb(128, 128, 255, 0.2);--kr-nation-bg-5:rgb(128, 255, 128, 0.15);--kr-nation-bg-6:rgb(204, 128, 255, 0.2);--kr-nation-bg-7:rgb(170, 170, 170, 0.2);--kr-nation-bg-8:rgb(115, 151, 115, 0.2);--kr-nation-bg-9:rgb(170, 170, 68, 0.2);--kr-nation-bg-10:rgb(204, 255, 255, 0.15);--mobile-header-height:56px;--mobile-tab-bar-height:48px;--mobile-touch-target:44px;--mobile-spacing-xs:4px;--mobile-spacing-sm:8px;--mobile-spacing-md:12px;--mobile-spacing-lg:16px;--mobile-spacing-xl:24px;--mobile-radius:8px;--mobile-radius-lg:16px;--z-header:1000;--z-tab-bar:999;--z-bottom-sheet:998;--z-drawer:1001;--transition-fast:0.15s ease;--transition-normal:0.3s ease;--transition-slow:0.5s ease;--kr-gauge-pv:#28a745;--kr-gauge-pm:#007bff;--kr-gauge-pp:#ffc107;--kr-overlay-light-10:rgba(255, 255, 255, 0.1);--kr-overlay-light-05:rgba(255, 255, 255, 0.05);--kr-overlay-light-20:rgba(255, 255, 255, 0.2);--kr-overlay-dark-20:rgba(0, 0, 0, 0.2);--kr-overlay-dark-30:rgba(0, 0, 0, 0.3);--kr-overlay-dark-125:rgba(0, 0, 0, 0.125)}html.kr-theme-variant-empire-brun{--kr-primary:#5E3B2D;--kr-highlight:#C69100}html.kr-theme-variant-paladium{--kr-primary:#D4AF37;--kr-highlight:#044c17}html.kr-theme-variant-theocratie-seelienne{--kr-primary:#0033A0;--kr-highlight:#2d5fcb}html.kr-theme-variant-paradigme-vert{--kr-primary:#0B6623;--kr-highlight:#063803}html.kr-theme-variant-khanat-elmerien{--kr-primary:#6A0DAD;--kr-highlight:#7b4c9c}html.kr-theme-variant-confederation-libre{--kr-primary:#6B7280;--kr-highlight:#475369}html.kr-theme-variant-royaume-ruthvenie{--kr-primary:#0A6B2D;--kr-highlight:#C41E3A}html.kr-theme-variant-empire-brun-dark{--kr-primary:#7a5240;--kr-primary-dark:#5E3B2D;--kr-highlight:#d4a574;--kr-highlight-reverse:#1a0f0a;--kr-bg-page:#12100d;--kr-bg-surface:#1e1a15;--kr-bg-elevated:#2a251f;--kr-text-primary:#f5f1ed;--kr-text-secondary:#b8a997;--kr-text-muted:#8a7968;--kr-text-inverse:#12100d;--kr-form-bg:#3a332b;--kr-form-bg-focus:#423a31;--kr-nation-2:#d4a574;--kr-nation-4:#74b9ff;--kr-nation-5:#55efc4;--kr-nation-6:#a29bfe;--kr-nation-7:#b2bec3;--kr-nation-8:#81c784}html.kr-theme-variant-confederation-libre-dark,html.kr-theme-variant-empire-brun-dark,html.kr-theme-variant-khanat-elmerien-dark,html.kr-theme-variant-paladium-dark,html.kr-theme-variant-paradigme-vert-dark,html.kr-theme-variant-royaume-ruthvenie-dark,html.kr-theme-variant-theocratie-seelienne-dark{--kr-bg-hover:rgba(255, 255, 255, 0.03);--kr-bg-active:rgba(255, 255, 255, 0.06);color-scheme:dark;--kr-border-default:rgb(255,255,255,0.08);--kr-border-strong:rgb(255,255,255,0.15);--kr-shadow-sm:0 1px 3px rgb(0,0,0,0.4);--kr-shadow-md:0 4px 8px rgb(0,0,0,0.5);--kr-shadow-lg:0 10px 20px rgb(0,0,0,0.6);--kr-nation-1:#ff8080;--kr-nation-3:#ffe066;--kr-nation-9:#c4b958}html.kr-theme-variant-paladium-dark{--kr-primary:#e6c76e;--kr-primary-dark:#D4AF37;--kr-highlight:#4a9d5f;--kr-highlight-reverse:#021a0a;--kr-bg-page:#0f0e0a;--kr-bg-surface:#1a1810;--kr-bg-elevated:#252015;--kr-text-primary:#f5f3e8;--kr-text-secondary:#c4b896;--kr-text-muted:#938567;--kr-text-inverse:#0f0e0a;--kr-form-bg:#3a3420;--kr-form-bg-focus:#43392a;--kr-nation-2:#e6c76e;--kr-nation-4:#74b9ff;--kr-nation-5:#55efc4;--kr-nation-6:#a29bfe;--kr-nation-7:#b2bec3;--kr-nation-8:#81c784}html.kr-theme-variant-confederation-libre-dark,html.kr-theme-variant-khanat-elmerien-dark,html.kr-theme-variant-paradigme-vert-dark,html.kr-theme-variant-royaume-ruthvenie-dark,html.kr-theme-variant-theocratie-seelienne-dark{--kr-nation-2:#d4a574}html.kr-theme-variant-theocratie-seelienne-dark{--kr-primary:#5a8fd9;--kr-primary-dark:#2d5fcb;--kr-highlight:#80b3ff;--kr-highlight-reverse:#000d1f;--kr-bg-page:#0a0e15;--kr-bg-surface:#12182a;--kr-bg-elevated:#1a2438;--kr-text-primary:#e8f0ff;--kr-text-secondary:#9db5d6;--kr-text-muted:#6b7f9e;--kr-text-inverse:#0a0e15;--kr-form-bg:#2a3447;--kr-form-bg-focus:#323d54;--kr-nation-4:#80b3ff;--kr-nation-5:#55efc4;--kr-nation-6:#a29bfe;--kr-nation-7:#b2bec3;--kr-nation-8:#81c784}html.kr-theme-variant-confederation-libre-dark,html.kr-theme-variant-khanat-elmerien-dark,html.kr-theme-variant-paradigme-vert-dark,html.kr-theme-variant-royaume-ruthvenie-dark{--kr-nation-4:#74b9ff}html.kr-theme-variant-paradigme-vert-dark{--kr-primary:#4d9c61;--kr-primary-dark:#2a7a3d;--kr-highlight:#70c784;--kr-highlight-reverse:#021508;--kr-bg-page:#0a120d;--kr-bg-surface:#0f1a13;--kr-bg-elevated:#1a2820;--kr-text-primary:#e8f5ed;--kr-text-secondary:#a0c4ab;--kr-text-muted:#6d8a75;--kr-text-inverse:#0a120d;--kr-form-bg:#2a3d30;--kr-form-bg-focus:#324539;--kr-nation-5:#70c784;--kr-nation-6:#a29bfe;--kr-nation-7:#b2bec3;--kr-nation-8:#81c784}html.kr-theme-variant-confederation-libre-dark,html.kr-theme-variant-khanat-elmerien-dark,html.kr-theme-variant-royaume-ruthvenie-dark{--kr-nation-5:#55efc4}html.kr-theme-variant-khanat-elmerien-dark{--kr-primary:#96c;--kr-primary-dark:#7b4c9c;--kr-highlight:#b794d9;--kr-highlight-reverse:#1a0425;--kr-bg-page:#0f0a15;--kr-bg-surface:#1a121f;--kr-bg-elevated:#251a2d;--kr-text-primary:#f0e8ff;--kr-text-secondary:#bba0d6;--kr-text-muted:#857299;--kr-text-inverse:#0f0a15;--kr-form-bg:#3a2f47;--kr-form-bg-focus:#443854;--kr-nation-6:#b794d9;--kr-nation-7:#b2bec3;--kr-nation-8:#81c784}html.kr-theme-variant-confederation-libre-dark,html.kr-theme-variant-royaume-ruthvenie-dark{--kr-nation-6:#a29bfe}html.kr-theme-variant-confederation-libre-dark{--kr-primary:#9ca3af;--kr-primary-dark:#6b7280;--kr-highlight:#c2c9d6;--kr-highlight-reverse:#0f1115;--kr-bg-page:#0e1013;--kr-bg-surface:#16181c;--kr-bg-elevated:#1f2228;--kr-text-primary:#e8eaed;--kr-text-secondary:#b8bcc4;--kr-text-muted:#7e8591;--kr-text-inverse:#0e1013;--kr-form-bg:#2d3139;--kr-form-bg-focus:#363a43;--kr-nation-7:#c2c9d6;--kr-nation-8:#81c784}html.kr-theme-variant-royaume-ruthvenie-dark{--kr-primary:#4a9d61;--kr-primary-dark:#2a7a3d;--kr-highlight:#ff6b85;--kr-highlight-reverse:#1a0408;--kr-bg-page:#0d1210;--kr-bg-surface:#141a16;--kr-bg-elevated:#1d2621;--kr-text-primary:#ecf5f0;--kr-text-secondary:#a5c4b0;--kr-text-muted:#708a79;--kr-text-inverse:#0d1210;--kr-form-bg:#2d3d33;--kr-form-bg-focus:#36463b;--kr-nation-7:#b2bec3;--kr-nation-8:#70c784}#top,hr[style*="border-top: 1px solid"][style*="337ab7"],html.kr-hide-footer-quote .footer-quote{display:none!important}body,html,nav.navbar{height:auto!important}body{min-height:100vh!important;display:flex;flex-direction:column;margin:0!important;padding-top:60px}nav.navbar{position:fixed!important;top:0!important;left:0!important;right:0!important;z-index:1030!important;max-height:60px!important}#content{flex:1 0 auto}footer{flex-shrink:0;width:100%}.container{max-width:1608px!important;width:1608px!important}#skills-panel{display:block!important;border:1px solid rgb(0,0,0,.06)!important;border-radius:5px!important;background-color:var(--kr-white)!important}.navbar-brand{display:flex!important;align-items:center!important;padding-top:0!important;padding-bottom:0!important}.navbar-brand img.kr-logo{height:28px;vertical-align:middle}.navbar-nav>li>a{color:var(--kr-white)!important}.form-control.form-control{border-radius:.4rem;border:1px solid rgb(0,0,0,.08);padding:.6rem .8rem;font-size:.95rem}.form-control:focus{box-shadow:0 0 0 .18rem var(--kr-focus-ring);border-color:var(--kr-primary);outline:0}textarea.form-control.form-control{font-size:1.4rem!important;line-height:1.6!important}.form-group label{color:var(--kr-text);font-weight:600}input[type=checkbox],input[type=radio]{accent-color:var(--kr-primary)!important}input[type=checkbox]:focus,input[type=radio]:focus{outline:0;box-shadow:0 0 0 .12rem var(--kr-focus-ring-light)!important}input[type=checkbox]:checked{border-color:var(--kr-primary)!important}.badge,.label{border-color:var(--kr-primary-dark)}.badge,.bg-info,.label{background-color:var(--kr-primary);color:var(--kr-white)}.badge-danger{background-color:var(--kr-badge-danger)!important;color:var(--kr-white)!important;border-color:var(--kr-badge-danger-border)!important}.alert.alert-info{background-color:var(--kr-alert-info-bg);border-color:var(--kr-alert-info-border)}.alert p,.alert strong,.alert.alert-info{color:var(--kr-text)}.list-group-item{border:0;padding:.6rem .75rem}.list-group-item.btn{border:0!important}.list-group-item.active,.list-group-item.active a,.list-group-item.active:focus,.list-group-item.active:hover{background-color:var(--kr-primary)!important;border-color:var(--kr-primary-dark)!important;color:var(--kr-surface)!important}.list-group-item:hover{color:var(--kr-primary-dark);background-color:rgb(0,0,0,.02)}.img-circle{width:var(--kr-avatar-size);height:var(--kr-avatar-size);min-width:var(--kr-avatar-size);min-height:var(--kr-avatar-size);object-fit:cover;display:inline-block;border-radius:50%}.img-circle.img-responsive,.img-circle.img-thumbnail{max-width:none!important;width:var(--kr-avatar-size);height:var(--kr-avatar-size)}.col-md-2.sidebar .avatar,.col-md-3.sidebar .avatar{margin-bottom:.5rem}.list-group a.list-group-item.ds_user,.list-group-item.ds_user{position:relative;min-height:var(--kr-avatar-size)!important;padding-right:calc(var(--kr-avatar-size) + 1rem)!important;display:flex!important;align-items:center!important}.list-group-item.ds_user .pull-right{position:absolute!important;right:.75rem!important;top:50%!important;transform:translateY(-50%)!important}#player-header-section .nopadding,#player-header-section .nopadding-right,#player-main-panel .nopadding,#player-main-panel .nopadding-right,#player-vitals-section .nopadding,#player-vitals-section .nopadding-right{padding-left:15px!important;padding-right:15px!important}#player-main-panel>.row>.nopadding:first-child{padding-left:10px!important;padding-right:10px!important}#player-vitals-section[style*=padding-left]{padding-left:0!important}#player-actions-section{display:flex;flex-wrap:wrap;gap:.5rem;padding:0 15px!important}.kr-quick-access-buttons .col-xs-6{margin-bottom:10px}#player-actions-section hr{width:100%;margin:.5rem 0}.carousel-caption{background:linear-gradient(180deg,rgb(0,0,0,.55),rgb(0,0,0,.35));padding:1.4rem;padding-bottom:56px;border-radius:.6rem;color:var(--kr-white)}.item img[class*=-slide]{display:block;margin:0 auto;max-width:100%;height:auto}a.carousel-control.left,a.carousel-control.right{background-image:none}.modal{display:flex!important;position:fixed!important;align-items:flex-start;justify-content:center;pointer-events:auto;padding-top:30px}.modal,.modal.in{overflow-y:hidden!important}.modal-content,.modal-dialog{display:flex;flex-direction:column}.modal-dialog{width:900px;max-width:90vw;margin:0 auto 30px;max-height:calc(100vh - 60px);pointer-events:auto;overflow-y:auto}.modal-content{max-height:100%;overflow:hidden}.modal-body{overflow-y:auto;flex:1 1 auto}.modal-footer,.modal-header{flex-shrink:0}.pagination>li.active>a{color:var(--kr-surface);background-color:var(--kr-primary-dark);border-color:var(--kr-primary-dark)}.pagination>li>a,.pagination>li>a:hover{color:var(--kr-primary)}.pagination>li.active>a:hover{color:var(--kr-surface);background-color:var(--kr-primary);border-color:var(--kr-primary)}.bg-primary{background-color:var(--kr-primary)!important;color:var(--kr-surface)!important}a:link,a:visited{color:var(--kr-highlight);text-decoration:none;transition:color .12s ease,opacity .12s ease}a:focus,a:hover{color:var(--kr-primary-dark);text-decoration:underline;outline:0}a.btn-primary,button.btn-primary{background-color:var(--kr-primary);border-color:var(--kr-primary-dark);color:var(--kr-highlight-reverse);box-shadow:0 6px 18px var(--kr-btn-shadow)}a.btn-primary:focus,a.btn-primary:hover,button.btn-primary:focus,button.btn-primary:hover{background-color:var(--kr-primary-dark)}footer .container.white{position:relative}.container.white .kraland-back-to-top{position:fixed;right:20px;bottom:20px;z-index:1000;transform:none}.dashboard-card-actions>div,.dashboard.dashboard-flex{display:flex;flex-direction:column;gap:15px}.dashboard-section{background:var(--kr-surface);border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgb(0,0,0,.08)}.dashboard-section-header{background:var(--kr-primary);color:var(--kr-white);padding:3px 8px;font-size:9px;font-weight:600;display:flex;align-items:center;gap:5px}.dashboard-group-buttons{display:flex;gap:6px}.dashboard-group-buttons .btn{background-color:rgb(255,255,255,.15);border:1px solid rgb(255,255,255,.25);color:var(--kr-white);padding:4px 8px;font-size:12px;border-radius:4px;transition:all .2s ease}.dashboard-group-buttons .btn:hover{background-color:rgb(255,255,255,.25);border-color:rgb(255,255,255,.4);transform:scale(1.05)}.dashboard-group-buttons .btn i{font-size:12px}.dashboard-group-title{flex:1;text-transform:uppercase;letter-spacing:.5px}.dashboard-cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;padding:12px}.dashboard-cards-large{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}.dashboard-card{background:var(--kr-white);border:1px solid rgb(0,0,0,.08);border-radius:6px;overflow:hidden;transition:all .2s ease;position:relative;display:flex;flex-direction:column}.dashboard-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgb(0,0,0,.12);border-color:var(--kr-primary)}.dashboard-card-large{min-height:90px}.dashboard-card-link{display:flex;flex-direction:column;text-decoration:none;color:inherit;flex:1}.dashboard-card-link:hover{text-decoration:none}.dashboard-card-header{display:flex;align-items:center;background:rgb(0,0,0,.02)}.dashboard-card-avatar-wrapper{position:relative;width:82px;height:82px;flex-shrink:0;display:flex;align-items:center;justify-content:center}.dashboard-card-hp-circle{position:absolute;top:0;left:0;width:82px;height:82px;pointer-events:none;z-index:1}.dashboard-card-avatar{width:70px;height:70px;border-radius:50%;object-fit:cover;border:2px solid var(--kr-primary);flex-shrink:0;position:relative;z-index:2}.dashboard-card-large .dashboard-card-avatar{width:70px;height:70px}.dashboard-card-name-container{display:flex;align-items:center;gap:6px;flex:1;min-width:0}.dashboard-card-world{width:20px;height:10px;object-fit:contain;flex-shrink:0}.dashboard-card-name{font-size:11px;font-weight:600;color:var(--kr-text);line-height:1.2;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;flex:1}.dashboard-card-large .dashboard-card-name{font-size:13px}.dashboard-card-body{padding:0 8px 5px;display:flex;flex-direction:column;gap:3px;flex:1;min-height:0}.dashboard-card-status{font-size:9px;color:var(--kr-muted);line-height:1.2;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:center}.dashboard-card-large .dashboard-card-status{font-size:11px;white-space:normal;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}.dashboard-card-hp{height:6px;background:rgb(0,0,0,.08);position:relative;margin:0}.dashboard-card-hp-fill{height:100%;transition:width .3s ease,background-color .3s ease;border-radius:0}.dashboard-card-pnj{position:absolute;top:8px;right:8px;background:var(--kr-badge-pnj);color:var(--kr-white);font-size:8px;font-weight:600;padding:2px 5px;border-radius:3px;text-transform:uppercase;letter-spacing:.3px;z-index:1}.dashboard-card-actions{position:absolute;bottom:4px;right:4px;display:flex;flex-direction:row;align-items:center;gap:4px;opacity:.7;transition:opacity .2s ease;z-index:2}.dashboard-card:hover .dashboard-card-actions{opacity:1}.dashboard-card-actions>div{gap:2px}.dashboard-card-actions>div,.dashboard-card-actions>div>div{margin:0!important;padding:0!important;height:auto!important}.dashboard-card-actions a{display:inline-flex;align-items:center;justify-content:center;padding:4px 6px!important;background-color:rgb(0,0,0,.6);border-radius:3px;transition:background-color .2s ease;min-width:24px;height:24px}.dashboard-card-actions a:hover{background-color:rgb(0,0,0,.8)}.dashboard-card-actions a i{color:var(--kr-white);font-size:12px;margin:0}.btn-toolbar .btn:not(.dropdown-menu *){background-color:var(--kr-surface)!important;background-image:none!important;color:var(--kr-primary)!important;border:1px solid rgb(0,0,0,.06)!important;box-shadow:none!important}.btn-toolbar .btn:not(.dropdown-menu *) .fa,.btn-toolbar .btn:not(.dropdown-menu *) .far,.btn-toolbar .btn:not(.dropdown-menu *) .fas,.btn-toolbar .btn:not(.dropdown-menu *) i{color:inherit!important}html[class*=-dark] body{background-color:var(--kr-bg-page);color:var(--kr-text-primary)}html[class*=-dark] .panel,html[class*=-dark] .panel-default,html[class*=-dark] .panel-heading{background-color:var(--kr-bg-surface);border-color:var(--kr-border-default)}html[class*=-dark] .panel-heading{background-color:var(--kr-bg-elevated);color:var(--kr-text-primary)}html[class*=-dark] .panel-body{background-color:var(--kr-bg-surface);color:var(--kr-text-primary)}html[class*=-dark] .panel-footer,html[class*=-dark] .well{background-color:var(--kr-bg-elevated);border-color:var(--kr-border-default)}html[class*=-dark] .form-group label,html[class*=-dark] .kr-tamper-theme h4,html[class*=-dark] .kr-tamper-theme label,html[class*=-dark] .well,html[class*=-dark] label{color:var(--kr-text-primary)}html[class*=-dark] .kr-tamper-theme .control-label{color:var(--kr-text-secondary)}html[class*=-dark] .modal-content{background-color:var(--kr-bg-surface);border-color:var(--kr-border-default)}html[class*=-dark] .form-control,html[class*=-dark] .modal-body,html[class*=-dark] .modal-footer,html[class*=-dark] .modal-header{background-color:var(--kr-bg-surface);color:var(--kr-text-primary);border-color:var(--kr-border-default)}html[class*=-dark] .form-control{background-color:var(--kr-form-bg)}html[class*=-dark] .form-control::placeholder{color:var(--kr-text-muted)}html[class*=-dark] .form-control:focus{background-color:var(--kr-form-bg-focus);border-color:var(--kr-primary);color:var(--kr-text-primary)}html[class*=-dark] .input-group-addon{background-color:var(--kr-bg-elevated);border-color:var(--kr-border-default);color:var(--kr-text-primary)}html[class*=-dark] .btn-primary{background-color:var(--kr-primary);border-color:var(--kr-primary-dark);color:var(--kr-text-primary)}html[class*=-dark] .btn-primary:active,html[class*=-dark] .btn-primary:focus,html[class*=-dark] .btn-primary:hover{background-color:var(--kr-primary-dark);border-color:var(--kr-primary-dark);color:var(--kr-text-primary)}html[class*=-dark] .btn-default,html[class*=-dark] .table>tbody>tr>th,html[class*=-dark] .table>tfoot>tr>th,html[class*=-dark] .table>thead>tr>th{background-color:var(--kr-bg-elevated);border-color:var(--kr-border-default);color:var(--kr-text-primary)}html[class*=-dark] .btn-default:hover{background-color:var(--kr-bg-active);border-color:var(--kr-border-strong)}html[class*=-dark] .btn-default:active,html[class*=-dark] .btn-default:focus{background-color:var(--kr-bg-hover);border-color:var(--kr-border-strong);color:var(--kr-text-primary)}html[class*=-dark] .list-group-item{background-color:var(--kr-bg-surface);border-color:var(--kr-border-default);color:var(--kr-text-primary)}html[class*=-dark] .list-group-item:hover{background-color:var(--kr-bg-hover)}html[class*=-dark] .list-group-item-heading{color:var(--kr-text-primary)}html[class*=-dark] .list-group-item-text{color:var(--kr-text-secondary)}html[class*=-dark] .dropdown-menu>li>a,html[class*=-dark] .nav-tabs>li>a,html[class*=-dark] .table{color:var(--kr-text-primary)}html[class*=-dark] .table>tbody>tr>td{border-color:var(--kr-border-default)}html[class*=-dark] .table-striped>tbody>tr:nth-of-type(odd){background-color:var(--kr-bg-hover)}html[class*=-dark] .table-hover>tbody>tr:hover{background-color:var(--kr-bg-active)}html[class*=-dark] .dropdown-menu{background-color:var(--kr-bg-elevated);border-color:var(--kr-border-strong)}html[class*=-dark] .dropdown-menu>li>a:focus,html[class*=-dark] .dropdown-menu>li>a:hover{background-color:var(--kr-bg-hover);color:var(--kr-text-primary)}html[class*=-dark] .dropdown-menu>.active>a,html[class*=-dark] .dropdown-menu>.active>a:focus,html[class*=-dark] .dropdown-menu>.active>a:hover{background-color:var(--kr-primary);color:var(--kr-text-inverse)}html[class*=-dark] .nav-tabs{border-color:var(--kr-border-default)}html[class*=-dark] .nav-tabs>li>a:hover{background-color:var(--kr-bg-hover);border-color:var(--kr-border-default)}html[class*=-dark] .nav-tabs>li.active>a,html[class*=-dark] .nav-tabs>li.active>a:focus,html[class*=-dark] .nav-tabs>li.active>a:hover{background-color:var(--kr-bg-surface);border-color:var(--kr-border-default) var(--kr-border-default) transparent;color:var(--kr-text-primary)}html[class*=-dark] .alert{border-color:var(--kr-border-default);color:var(--kr-text-primary)!important}html[class*=-dark] .alert *{color:inherit!important}html[class*=-dark] .alert a{color:var(--kr-primary)!important;text-decoration:underline}html[class*=-dark] .alert-info{background-color:rgb(122,82,64,.15);border-color:rgb(122,82,64,.3);color:var(--kr-text-primary)}html[class*=-dark] .alert-success{background-color:rgb(34,197,94,.15);border-color:rgb(34,197,94,.3);color:var(--kr-text-primary)}html[class*=-dark] .alert-warning{background-color:rgb(245,158,11,.15);border-color:rgb(245,158,11,.3);color:var(--kr-text-primary)}html[class*=-dark] .alert-danger{background-color:rgb(239,68,68,.15);border-color:rgb(239,68,68,.3);color:var(--kr-text-primary)}html[class*=-dark] #flap,html[class*=-dark] .progress{background-color:var(--kr-bg-elevated)}html[class*=-dark] .dashboard-card{background:var(--kr-bg-surface);border-color:var(--kr-border-default)}html[class*=-dark] .dashboard-card:hover{box-shadow:var(--kr-shadow-md)}html[class*=-dark] .dashboard-card-header{background:var(--kr-bg-hover)}html[class*=-dark] .dashboard-card-name{color:var(--kr-text-primary)}html[class*=-dark] .dashboard-card-status{color:var(--kr-text-muted)}html[class*=-dark] .dashboard-section{background:var(--kr-bg-surface)}html[class*=-dark] .dashboard-card-hp{background:var(--kr-bg-elevated)}html[class*=-dark] .chat li{border-bottom-color:var(--kr-border-default)}html[class*=-dark] .map-box,html[class*=-dark] .panel-body-scroll{background-color:var(--kr-bg-surface)}html[class*=-dark] #flap a.closed,html[class*=-dark] #flap a.open{background:var(--kr-bg-elevated);color:var(--kr-text-primary)}html[class*=-dark] .map-box{border-color:var(--kr-border-default)}html[class*=-dark] .map-box-title{background-color:var(--kr-primary);color:var(--kr-text-inverse)}html[class*=-dark] .map-box-content{color:var(--kr-text-primary)}html[class*=-dark] .map-box-bottom{background-color:var(--kr-primary);color:var(--kr-text-inverse)}html[class*=-dark] .f1{color:var(--kr-nation-1)}html[class*=-dark] .f2{color:var(--kr-nation-2)}html[class*=-dark] .f3{color:var(--kr-nation-3)}html[class*=-dark] .f4{color:var(--kr-nation-4)}html[class*=-dark] .f5{color:var(--kr-nation-5)}html[class*=-dark] .f6{color:var(--kr-nation-6)}html[class*=-dark] .f7{color:var(--kr-nation-7)}html[class*=-dark] .f8{color:var(--kr-nation-8)}html[class*=-dark] .f9{color:var(--kr-nation-9)}html[class*=-dark] .c1{background-color:var(--kr-nation-bg-1)}html[class*=-dark] .c2{background-color:var(--kr-nation-bg-2)}html[class*=-dark] .c3{background-color:var(--kr-nation-bg-3)}html[class*=-dark] .c4{background-color:var(--kr-nation-bg-4)}html[class*=-dark] .c5{background-color:var(--kr-nation-bg-5)}html[class*=-dark] .c6{background-color:var(--kr-nation-bg-6)}html[class*=-dark] .c7{background-color:var(--kr-nation-bg-7)}html[class*=-dark] .c8{background-color:var(--kr-nation-bg-8)}html[class*=-dark] .c9{background-color:var(--kr-nation-bg-9)}html[class*=-dark] .c10{background-color:var(--kr-nation-bg-10)}html[class*=-dark] ::-webkit-scrollbar-track{background-color:var(--kr-bg-page)}html[class*=-dark] ::-webkit-scrollbar-thumb{background-color:var(--kr-text-muted)}html[class*=-dark] ::-webkit-scrollbar-thumb:hover{background-color:var(--kr-text-secondary)}html[class*=-dark] ::selection{background-color:var(--kr-primary);color:var(--kr-text-inverse)}html[class*=-dark] footer{background-color:var(--kr-bg-elevated);border-top:1px solid var(--kr-border-default)}html[class*=-dark] .dataTables_filter label,html[class*=-dark] .dataTables_length label,html[class*=-dark] .footer-quote{color:var(--kr-text-secondary)}html[class*=-dark] #skills-panel{background-color:var(--kr-bg-surface)!important;border-color:var(--kr-border-default)!important}body.mobile-mode .commerce-products-container>a.list-group-item p i,body>map,html[class*=-dark] hr{display:none}html[class*=-dark] .carousel-control{color:var(--kr-primary);opacity:.7}html[class*=-dark] .carousel-control:focus,html[class*=-dark] .carousel-control:hover{color:var(--kr-highlight);opacity:.9}html[class*=-dark] .carousel-indicators li{background-color:var(--kr-border-default);border-color:var(--kr-border-default)}html[class*=-dark] .carousel-indicators .active{background-color:var(--kr-primary);border-color:var(--kr-primary)}html[class*=-dark] a:link,html[class*=-dark] a:visited{color:var(--kr-highlight)}html[class*=-dark] a:focus,html[class*=-dark] a:hover{color:var(--kr-primary)}html[class*=-dark] a.next,html[class*=-dark] a.prev{background-color:var(--kr-bg-elevated)!important;border-color:var(--kr-border-default)!important;color:var(--kr-text-primary)!important}html[class*=-dark] a.next:hover,html[class*=-dark] a.prev:hover{background-color:var(--kr-bg-hover)!important;border-color:var(--kr-border-strong)!important;color:var(--kr-highlight)!important}html[class*=-dark] .btn-warning{background-color:var(--kr-primary)!important;border-color:var(--kr-primary-dark)!important;color:var(--kr-text-inverse)!important}html[class*=-dark] .btn-warning:hover{background-color:var(--kr-highlight)!important;border-color:var(--kr-primary)!important}html[class*=-dark] img[src*="/bat/bat"],html[class*=-dark] img[src*="/mat/94/"],html[class*=-dark] img[src*="/voc/"]{filter:none;opacity:.85}html[class*=-dark] img[src*="/bat/bat"]:hover,html[class*=-dark] img[src*="/mat/94/"]:hover,html[class*=-dark] img[src*="/voc/"]:hover{filter:none;opacity:1}.c100{width:80px!important;height:80px!important;border-radius:50%!important;background-color:var(--kr-bg-elevated, #f5f5f5)!important;display:flex!important;align-items:center!important;justify-content:center!important;overflow:visible!important}.c100 .bar,.c100 .fill,.c100 .slice{display:none!important}.c100>span,html[class*=-dark] .c100>span{font-size:20px!important;font-weight:600!important}.c100,.c100>span{position:relative!important}.c100>span{z-index:10!important;color:var(--kr-text-primary, #333)!important;text-align:center!important}.c100::after,.c100::before{content:""!important;position:absolute!important;border-radius:50%!important}.c100::after{top:50%!important;left:50%!important;transform:translate(-50%,-50%)!important;width:68px!important;height:68px!important;background-color:var(--kr-bg-elevated, #f5f5f5)!important;z-index:5!important}.c100::before{top:0!important;left:0!important;width:100%!important;height:100%!important;background:conic-gradient(var(--clock-color, #8B0000) 0deg,var(--clock-color, #8B0000) calc(var(--clock-deg, 0)*1deg),transparent calc(var(--clock-deg, 0)*1deg),transparent 360deg)!important;z-index:1!important;transition:none!important}.c100[data-second-lap=true]::before{box-shadow:0 0 0 1px var(--kr-bg-elevated, #f5f5f5),0 0 0 5px var(--clock-color, #32CD32),inset 0 0 0 2px var(--clock-color, #32CD32)!important}.c100.p0{--clock-deg:0}.c100.p1{--clock-deg:3.6}.c100.p2{--clock-deg:7.2}.c100.p3{--clock-deg:10.8}.c100.p4{--clock-deg:14.4}.c100.p5{--clock-deg:18}.c100.p6{--clock-deg:21.6}.c100.p7{--clock-deg:25.2}.c100.p8{--clock-deg:28.8}.c100.p9{--clock-deg:32.4}.c100.p10{--clock-deg:36}.c100.p11{--clock-deg:39.6}.c100.p12{--clock-deg:43.2}.c100.p13{--clock-deg:46.8}.c100.p14{--clock-deg:50.4}.c100.p15{--clock-deg:54}.c100.p16{--clock-deg:57.6}.c100.p17{--clock-deg:61.2}.c100.p18{--clock-deg:64.8}.c100.p19{--clock-deg:68.4}.c100.p20{--clock-deg:72}.c100.p21{--clock-deg:75.6}.c100.p22{--clock-deg:79.2}.c100.p23{--clock-deg:82.8}.c100.p24{--clock-deg:86.4}.c100.p25{--clock-deg:90}.c100.p26{--clock-deg:93.6}.c100.p27{--clock-deg:97.2}.c100.p28{--clock-deg:100.8}.c100.p29{--clock-deg:104.4}.c100.p30{--clock-deg:108}.c100.p31{--clock-deg:111.6}.c100.p32{--clock-deg:115.2}.c100.p33{--clock-deg:118.8}.c100.p34{--clock-deg:122.4}.c100.p35{--clock-deg:126}.c100.p36{--clock-deg:129.6}.c100.p37{--clock-deg:133.2}.c100.p38{--clock-deg:136.8}.c100.p39{--clock-deg:140.4}.c100.p40{--clock-deg:144}.c100.p41{--clock-deg:147.6}.c100.p42{--clock-deg:151.2}.c100.p43{--clock-deg:154.8}.c100.p44{--clock-deg:158.4}.c100.p45{--clock-deg:162}.c100.p46{--clock-deg:165.6}.c100.p47{--clock-deg:169.2}.c100.p48{--clock-deg:172.8}.c100.p49{--clock-deg:176.4}.c100.p50{--clock-deg:180}.c100.p51{--clock-deg:183.6}.c100.p52{--clock-deg:187.2}.c100.p53{--clock-deg:190.8}.c100.p54{--clock-deg:194.4}.c100.p55{--clock-deg:198}.c100.p56{--clock-deg:201.6}.c100.p57{--clock-deg:205.2}.c100.p58{--clock-deg:208.8}.c100.p59{--clock-deg:212.4}.c100.p60{--clock-deg:216}.c100.p61{--clock-deg:219.6}.c100.p62{--clock-deg:223.2}.c100.p63{--clock-deg:226.8}.c100.p64{--clock-deg:230.4}.c100.p65{--clock-deg:234}.c100.p66{--clock-deg:237.6}.c100.p67{--clock-deg:241.2}.c100.p68{--clock-deg:244.8}.c100.p69{--clock-deg:248.4}.c100.p70{--clock-deg:252}.c100.p71{--clock-deg:255.6}.c100.p72{--clock-deg:259.2}.c100.p73{--clock-deg:262.8}.c100.p74{--clock-deg:266.4}.c100.p75{--clock-deg:270}.c100.p76{--clock-deg:273.6}.c100.p77{--clock-deg:277.2}.c100.p78{--clock-deg:280.8}.c100.p79{--clock-deg:284.4}.c100.p80{--clock-deg:288}.c100.p81{--clock-deg:291.6}.c100.p82{--clock-deg:295.2}.c100.p83{--clock-deg:298.8}.c100.p84{--clock-deg:302.4}.c100.p85{--clock-deg:306}.c100.p86{--clock-deg:309.6}.c100.p87{--clock-deg:313.2}.c100.p88{--clock-deg:316.8}.c100.p89{--clock-deg:320.4}.c100.p90{--clock-deg:324}.c100.p91{--clock-deg:327.6}.c100.p92{--clock-deg:331.2}.c100.p93{--clock-deg:334.8}.c100.p94{--clock-deg:338.4}.c100.p95{--clock-deg:342}.c100.p96{--clock-deg:345.6}.c100.p97{--clock-deg:349.2}.c100.p98{--clock-deg:352.8}.c100.p99{--clock-deg:356.4}.c100.p100{--clock-deg:360}html[class*=-dark] .c100,html[class*=-dark] .dataTables_filter input,html[class*=-dark] .dataTables_length select,html[class*=-dark] .pagination>li>a,html[class*=-dark] .pagination>li>span,html[class*=-dark] table.dataTable thead td,html[class*=-dark] table.dataTable thead th{background-color:var(--kr-bg-elevated)!important;border-color:var(--kr-border-default)!important;color:var(--kr-text-primary)!important}html[class*=-dark] .c100::after,html[class*=-dark] table.dataTable thead th.sorting,html[class*=-dark] table.dataTable thead th.sorting_asc,html[class*=-dark] table.dataTable thead th.sorting_desc{background-color:var(--kr-bg-elevated)!important}html[class*=-dark] .c100>span{color:var(--kr-text-primary)!important;line-height:80px!important;width:80px!important;height:80px!important}html[class*=-dark] .c100 .slice{border-color:var(--kr-bg-elevated)!important}html[class*=-dark] .c100 .bar{border-color:var(--kr-primary)!important}html[class*=-dark] .c100 .fill{border-color:var(--kr-bg-elevated)!important}html[class*=-dark] .dataTables_paginate,html[class*=-dark] .pagination{background-color:transparent!important}html[class*=-dark] .pagination>li.disabled>a,html[class*=-dark] .pagination>li.disabled>span{background-color:var(--kr-bg-surface)!important;border-color:var(--kr-border-default)!important;color:var(--kr-text-muted)!important;opacity:.6!important}html[class*=-dark] .pagination>li>a:hover,html[class*=-dark] .pagination>li>span:hover{background-color:var(--kr-bg-hover)!important;border-color:var(--kr-border-strong)!important;color:var(--kr-primary)!important}html[class*=-dark] .dataTables_paginate .paginate_button.current,html[class*=-dark] .pagination>.active>a,html[class*=-dark] .pagination>.active>a:hover,html[class*=-dark] .pagination>.active>span,html[class*=-dark] .pagination>.active>span:hover{background-color:var(--kr-primary)!important;border-color:var(--kr-primary)!important;color:var(--kr-text-inverse)!important}html[class*=-dark] .dataTables_paginate .paginate_button{background-color:var(--kr-bg-elevated)!important;border:1px solid var(--kr-border-default)!important;color:var(--kr-text-primary)!important;background-image:none!important;box-shadow:none!important}html[class*=-dark] .dataTables_paginate .paginate_button.disabled,html[class*=-dark] .dataTables_paginate .paginate_button.disabled:hover{background-color:var(--kr-bg-surface)!important;border-color:var(--kr-border-default)!important;color:var(--kr-text-muted)!important;opacity:.6!important;cursor:not-allowed!important}html[class*=-dark] .dataTables_paginate .paginate_button:not(.disabled):hover{background-color:var(--kr-bg-hover)!important;border-color:var(--kr-border-strong)!important;color:var(--kr-primary)!important}html[class*=-dark] .dataTables_paginate .paginate_button.current:hover{background-color:var(--kr-primary)!important;border-color:var(--kr-primary)!important;color:var(--kr-text-inverse)!important}html[class*=-dark] .dataTables_wrapper{color:var(--kr-text-primary)}html[class*=-dark] .dataTables_filter,html[class*=-dark] .dataTables_info,html[class*=-dark] .dataTables_length{color:var(--kr-text-secondary)!important}html[class*=-dark] .dataTables_filter input:focus,html[class*=-dark] .dataTables_length select:focus{background-color:var(--kr-bg-elevated)!important;border-color:var(--kr-primary)!important;outline:0!important}html[class*=-dark] table.dataTable{background-color:transparent!important;color:var(--kr-text-primary)!important}html[class*=-dark] table.dataTable tbody tr,html[class*=-dark] table.dataTable tbody tr.odd{background-color:var(--kr-bg-surface)!important}html[class*=-dark] table.dataTable tbody tr.even,html[class*=-dark] table.dataTable thead th.sorting:hover,html[class*=-dark] table.dataTable thead th.sorting_asc:hover,html[class*=-dark] table.dataTable thead th.sorting_desc:hover{background-color:var(--kr-bg-hover)!important}html[class*=-dark] table.dataTable tbody tr:hover{background-color:var(--kr-bg-active)!important}html[class*=-dark] table.dataTable tbody td{border-color:var(--kr-border-default)!important;color:var(--kr-text-primary)!important}html[class*=-dark] table.dataTable tbody td.dataTables_empty{background-color:var(--kr-bg-surface)!important;color:var(--kr-text-secondary)!important}html[class*=-dark] table.dataTable tfoot td,html[class*=-dark] table.dataTable tfoot th{background-color:var(--kr-bg-elevated)!important;border-color:var(--kr-border-default)!important;color:var(--kr-text-primary)!important}body>div:has([id^=c]){display:block;position:relative;min-height:550px}.kr-mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1040;opacity:0;transition:opacity .3s ease}.kr-mobile-overlay.active{display:block;opacity:1}.kr-mobile-close{position:absolute;top:10px;right:10px;width:40px;height:40px;background:var(--kr-primary);color:#fff;border:0;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;font-size:20px}.kr-mobile-close:hover{background:var(--kr-primary-dark)}.kr-mobile-skills-toggle{position:fixed!important;bottom:90px!important;right:20px!important;z-index:1000!important;width:56px!important;height:56px!important;border-radius:50%!important;padding:0!important;display:none!important;box-shadow:var(--kr-shadow-lg)!important}body.mobile-mode .commerce-category-header{cursor:pointer;user-select:none;-webkit-tap-highlight-color:transparent;position:relative;transition:background-color var(--transition-fast)}body.mobile-mode .commerce-category-header:hover{background-color:var(--kr-bg-hover)}body.mobile-mode .commerce-category-header:active{background-color:var(--kr-bg-active)}body.mobile-mode .commerce-category-header .accordion-icon{position:absolute;right:12px;top:50%;transform:translateY(-50%);transition:transform var(--transition-normal);font-size:14px;color:var(--kr-text-secondary)}body.mobile-mode .building-section-header.expanded .accordion-icon,body.mobile-mode .commerce-category-header.expanded .accordion-icon{transform:translateY(-50%) rotate(-180deg)}body.mobile-mode .commerce-products-container{max-height:5000px;opacity:1;overflow:hidden;transition:max-height var(--transition-normal),opacity var(--transition-normal);display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:8px;padding:8px 0}body.mobile-mode .commerce-products-container.collapsed{max-height:0!important;opacity:0}body.mobile-mode .commerce-products-container>a.list-group-item{display:flex!important;flex-direction:column;padding:8px!important;min-height:120px;border-radius:8px;background-color:var(--kr-bg-surface);border:1px solid var(--kr-border-default);transition:transform var(--transition-fast),box-shadow var(--transition-fast)}body.mobile-mode .commerce-products-container>a.list-group-item:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.3)}body.mobile-mode .commerce-products-container>a.list-group-item .mention{position:absolute;top:4px;right:4px;float:none!important;font-size:10px;line-height:1.2;text-align:right;background-color:rgba(0,0,0,.6);padding:2px 4px;border-radius:4px}body.mobile-mode .commerce-products-container>a.list-group-item .mention .xmini{font-size:9px;opacity:.8}body.mobile-mode .commerce-products-container>a.list-group-item img{float:none!important;display:block;margin:0 auto 8px;width:40px;height:40px}body.mobile-mode .commerce-products-container>a.list-group-item h4{font-size:11px;line-height:1.3;margin:0 0 4px;text-align:center;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;word-break:break-all}body.mobile-mode .commerce-products-container>a.list-group-item p{font-size:9px;line-height:1.2;margin:0;text-align:center;color:var(--kr-text-secondary);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}body.mobile-mode .building-section-header{cursor:pointer;user-select:none;-webkit-tap-highlight-color:transparent;position:relative;transition:background-color var(--transition-fast)}body.mobile-mode .building-section-header:hover{background-color:var(--kr-bg-hover)}body.mobile-mode .building-section-header:active{background-color:var(--kr-bg-active)}body.mobile-mode .building-section-header .accordion-icon{position:absolute;right:12px;top:50%;transform:translateY(-50%);transition:transform var(--transition-normal);font-size:14px;color:var(--kr-text-secondary)}body.mobile-mode .building-section-content{max-height:5000px;opacity:1;overflow:hidden;transition:max-height var(--transition-normal),opacity var(--transition-normal)}body.mobile-mode .building-section-content.collapsed{max-height:0!important;opacity:0}body.mobile-mode .kr-navigation-row{display:table!important;width:100%;table-layout:fixed;margin-bottom:5px;border-collapse:separate;border-spacing:0}body.mobile-mode .kr-navigation-row+.container{padding-top:10px!important}body.mobile-mode .kr-navigation-row>.btn-group{display:table-cell!important;width:1%;vertical-align:middle;float:none!important}body.mobile-mode .kr-direction-link,body.mobile-mode .kr-room-link{display:flex!important;flex-direction:column;align-items:center;justify-content:center;width:100%;height:60px!important;padding:0!important;text-align:center}body.mobile-mode .kr-direction-link{position:relative}body.mobile-mode .kr-direction-link img,body.mobile-mode .kr-room-link img{width:60px;height:60px;display:block}body.mobile-mode .kr-direction-link map{position:absolute;top:0;left:0;width:100%;height:100%}body.mobile-mode .kr-room-link{font-size:10px;line-height:1.2}body.mobile-mode .kr-navigation-row>.btn-group:first-child .kr-direction-link,body.mobile-mode .kr-navigation-row>.btn-group:first-child .kr-room-link{border-radius:4px 0 0 4px}body.mobile-mode .kr-navigation-row>.btn-group:last-child .kr-room-link{border-radius:0 4px 4px 0}body.mobile-mode .kr-navigation-row>.btn-group:not(:first-child) .kr-direction-link,body.mobile-mode .kr-navigation-row>.btn-group:not(:first-child) .kr-room-link{border-left:none}body.mobile-mode .kr-navigation-row>.btn-group:only-child .kr-direction-link,body.mobile-mode .kr-navigation-row>.btn-group:only-child .kr-room-link{border-radius:4px}',ENABLE_KEY:"kr-theme-enabled",VARIANT_KEY:"kr-theme-variant",STATS_DISPLAY_KEY:"kr-stats-display",STYLE_ID:"kraland-theme-style",THEME_VARIANTS:["kraland","empire-brun","paladium","theocratie-seelienne","paradigme-vert","khanat-elmerien","confederation-libre","royaume-ruthvenie","empire-brun-dark","paladium-dark","theocratie-seelienne-dark","paradigme-vert-dark","khanat-elmerien-dark","confederation-libre-dark","royaume-ruthvenie-dark","high-contrast"],LOGO_MAP:{kraland:1,"empire-brun":2,"empire-brun-dark":2,paladium:3,"paladium-dark":3,"theocratie-seelienne":4,"theocratie-seelienne-dark":4,"paradigme-vert":5,"paradigme-vert-dark":5,"khanat-elmerien":6,"khanat-elmerien-dark":6,"confederation-libre":7,"confederation-libre-dark":7,"royaume-ruthvenie":8,"royaume-ruthvenie-dark":8},SKILL_ICONS:{Baratin:"9401","Combat Mains Nues":"9402","Combat Contact":"9403","Combat Distance":"9404",Commerce:"9405","Démolition":"9406","Discrétion":"9407","Éloquence":"9408",Falsification:"9409",Foi:"9410",Informatique:"9411","Médecine":"9412",Observation:"9413",Organisation:"9414",Pouvoir:"9415","Séduction":"9416",Survie:"9417",Vol:"9418"},STAT_ICONS:{FOR:"9402",VOL:"9415",CHA:"9416",INT:"9412",GES:"9405",PER:"9413"}};function safeCall(fn){try{fn()}catch(_e){}}function isThemeEnabled(){return"true"===localStorage.getItem(CONFIG.ENABLE_KEY)}function getVariant(){return localStorage.getItem(CONFIG.VARIANT_KEY)||"kraland"}function getStatsDisplayMode(){return localStorage.getItem(CONFIG.STATS_DISPLAY_KEY)||"icon"}function isPlatoPage(){const path=location?.pathname||"";return 0===path.indexOf("/jouer")&&"/jouer/communaute"!==path&&"/jouer/communaute/membres"!==path}async function applyThemeInline(cssText){if(!isThemeEnabled())return!1;try{let st=document.getElementById(CONFIG.STYLE_ID);st?st.textContent=cssText:(st=document.createElement("style"),st.id=CONFIG.STYLE_ID,st.textContent=cssText,document.head.appendChild(st)),document.documentElement.classList.add("kr-theme-enabled");const variant=getVariant();document.documentElement.classList.toggle("kr-theme-high-contrast","high-contrast"===variant),CONFIG.THEME_VARIANTS.forEach(v=>document.documentElement.classList.remove("kr-theme-variant-"+v)),variant&&"disable"!==variant&&document.documentElement.classList.add("kr-theme-variant-"+variant);const isMembers=0===location?.pathname?.indexOf("/communaute/membres");return document.documentElement.classList.toggle("kr-page-members",isMembers),!0}catch(e){return console.error("Theme apply failed",e),!1}}async function ensureTheme(){isThemeEnabled()&&await applyThemeInline(CONFIG.BUNDLED_CSS)}function applyThemeVariant(variant,skipReload=!1){try{if(!variant||"disable"===variant)return localStorage.setItem(CONFIG.ENABLE_KEY,"false"),void(skipReload||location.reload());const wasDisabled=!isThemeEnabled();if(localStorage.setItem(CONFIG.ENABLE_KEY,"true"),localStorage.setItem(CONFIG.VARIANT_KEY,variant),wasDisabled&&!skipReload)return void location.reload();CONFIG.THEME_VARIANTS.forEach(v=>document.documentElement.classList.remove("kr-theme-variant-"+v)),document.documentElement.classList.add("kr-theme-variant-"+variant),document.documentElement.classList.add("kr-theme-enabled"),safeCall(()=>applyThemeInline(CONFIG.BUNDLED_CSS)),safeCall(()=>replaceNavbarBrand())}catch(e){console.error("applyThemeVariant error",e)}}function applyFooterQuoteOption(){"true"===localStorage.getItem("kr-hide-footer-quote")?document.documentElement.classList.add("kr-hide-footer-quote"):document.documentElement.classList.remove("kr-hide-footer-quote")}function applyDOMTransformations(){isThemeEnabled()&&[markActiveIcons,replaceMcAnchors,replaceSImages,replaceNavbarBrand,reorderBtnGroupXs,ensureSexStrong,ensureFooterSticky,relocateKramailToLeft,restructurePlatoColumns,moveBtnGroupToCols,moveSkillsPanelToCols,transformToBootstrapGrid,nameLeftSidebarDivs,transformSkillsToIcons,transformStatsToNotifications,ensureEditorClasses,ensurePageScoping,ensurePlayerMainPanelRows,addQuickAccessButtons,disableTooltips,modifyNavigationMenus,transformDashboardToFlexCards,applyFooterQuoteOption,handleDualLapClock].forEach(fn=>safeCall(fn))}function disableTooltips(){document.querySelectorAll('[data-toggle="tooltip"]').forEach(el=>{el.removeAttribute("data-toggle"),el.removeAttribute("data-placement"),el.removeAttribute("title"),el.removeAttribute("data-original-title")}),window.$&&window.$.fn&&window.$.fn.tooltip&&(window.$.fn.tooltip=function(){return this})}function transformDashboardToFlexCards(){if(!isPlatoPage())return;const dashboard=document.querySelector(".dashboard");if(!dashboard)return;const panels=dashboard.querySelectorAll(":scope > .panel");if(!panels.length)return;const flexContainer=document.createElement("div");flexContainer.className="dashboard-flex";const groups=[];let firstPlayerPanelFound=!1;panels.forEach(panel=>{const panelBody=panel.querySelector(".panel-body");if(!panelBody)return;if(!panelBody.querySelector("table"))return;const panelTitle=panel.querySelector(".panel-heading .panel-title"),titleText=panelTitle?panelTitle.textContent.trim():"";if(!titleText.toLowerCase().includes("groupe"))return;const groupData=function extractGroupData(panel){const groupData={title:"",groupButtons:[],members:[]},panelHeading=panel.querySelector(".panel-heading");if(panelHeading){const panelTitle=panelHeading.querySelector(".panel-title");panelTitle&&(groupData.title=panelTitle.textContent.trim(),panelTitle.querySelectorAll("a.btn").forEach(btn=>{groupData.groupButtons.push(btn.cloneNode(!0))}))}const panelBody=panel.querySelector(".panel-body");if(!panelBody)return groupData;const table=panelBody.querySelector("table");return table?(table.querySelectorAll("tr").forEach(row=>{const td1=row.querySelector("td:first-child"),td2=row.querySelector("td:last-child");if(!td1||!td2)return;const memberLinks=td1.querySelectorAll("a.list-group-item.ds_game"),actionsDivs=td2.querySelectorAll('div[style*="height:59px"]');memberLinks.forEach((memberLink,index)=>{const memberData=function extractMemberData(memberLink,actionsDiv){const data={originalLink:memberLink,avatar:null,name:"",status:"",isPNJ:!1,worldImage:null,hpInfo:null,pvLevel:null,profileUrl:"",actionsDiv:null},avatar=memberLink.querySelector("img.pull-left");avatar&&(data.avatar=avatar.src);const heading=memberLink.querySelector(".list-group-item-heading"),text=memberLink.querySelector(".list-group-item-text");heading&&(data.name=heading.textContent.trim()),text&&(data.status=text.textContent.trim()),memberLink.querySelector(".btn-danger.xmini")&&(data.isPNJ=!0);const mention=memberLink.querySelector(".mention.pull-right");if(mention){const worldImg=mention.querySelector('img[src*="world"]');worldImg&&(data.worldImage=worldImg.src);const pvImg=mention.querySelector('img[src*="pdv"]');if(pvImg){const match=pvImg.src.match(/pdv(\d)\.png/);match&&(data.pvLevel=parseInt(match[1],10))}const hpDiv=mention.querySelector('div[style*="background"]');if(hpDiv){const match=(hpDiv.getAttribute("style")||"").match(/width:\s*(\d+)%/);match&&(data.hpInfo=parseInt(match[1],10))}}return data.profileUrl=memberLink.href,actionsDiv&&(data.actionsDiv=actionsDiv.cloneNode(!0)),data}(memberLink,actionsDivs[index]||null);groupData.members.push(memberData)})}),groupData):groupData}(panel);if(0===groupData.members.length)return;const isMyGroup=!firstPlayerPanelFound;titleText.toLowerCase().includes("groupe")&&(firstPlayerPanelFound=!0),groups.push({isMyGroup:isMyGroup,title:groupData.title,groupButtons:groupData.groupButtons,members:groupData.members})}),0!==groups.length&&(groups.forEach((group,_index)=>{const groupSection=document.createElement("div");groupSection.className=group.isMyGroup?"dashboard-section dashboard-section-mygroup":"dashboard-section dashboard-section-others";const header=document.createElement("div");if(header.className="dashboard-section-header",group.groupButtons&&group.groupButtons.length>0){const buttonsWrapper=document.createElement("div");buttonsWrapper.className="dashboard-group-buttons",group.groupButtons.forEach(btn=>{buttonsWrapper.appendChild(btn)}),header.appendChild(buttonsWrapper)}const titleSpan=document.createElement("span");if(titleSpan.className="dashboard-group-title",group.isMyGroup){const titleText=group.title.replace(/\s*Groupe\s+/i,"");titleSpan.textContent=titleText||"Mon groupe"}else{const titleText=group.title.replace(/\s*Groupe\s+/i,"");titleSpan.textContent=titleText||`Groupe de ${group.members[0]?.name||"Inconnu"}`}header.appendChild(titleSpan),groupSection.appendChild(header);const cardsContainer=document.createElement("div");cardsContainer.className=group.isMyGroup?"dashboard-cards-grid dashboard-cards-large":"dashboard-cards-grid",group.members.forEach(member=>{cardsContainer.appendChild(function buildCard(memberData,isLargeCard=!1){const card=document.createElement("div");card.className=isLargeCard?"dashboard-card dashboard-card-large":"dashboard-card";const cardLink=memberData.originalLink.cloneNode(!1);cardLink.classList.add("dashboard-card-link");const header=document.createElement("div");if(header.className="dashboard-card-header",memberData.avatar){const avatarWrapper=document.createElement("div");if(avatarWrapper.className="dashboard-card-avatar-wrapper",memberData.pvLevel){const hpCircle=function createHPCircle(pvLevel){if(!pvLevel)return null;const pvConfig={1:{color:"#32CD32",percentage:100},2:{color:"#FFD700",percentage:80},3:{color:"#FF8C00",percentage:60},4:{color:"#DC143C",percentage:40},5:{color:"#8B0000",percentage:20}},config=pvConfig[pvLevel]||pvConfig[1],circumference=2*Math.PI*37,strokeDashoffset=circumference-circumference*config.percentage/100,svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("class","dashboard-card-hp-circle"),svg.setAttribute("width","82"),svg.setAttribute("height","82"),svg.setAttribute("viewBox","0 0 82 82");const bgCircle=document.createElementNS("http://www.w3.org/2000/svg","circle");bgCircle.setAttribute("cx","41"),bgCircle.setAttribute("cy","41"),bgCircle.setAttribute("r",37),bgCircle.setAttribute("fill","none"),bgCircle.setAttribute("stroke","rgba(0,0,0,0.1)"),bgCircle.setAttribute("stroke-width","3");const progressCircle=document.createElementNS("http://www.w3.org/2000/svg","circle");return progressCircle.setAttribute("cx","41"),progressCircle.setAttribute("cy","41"),progressCircle.setAttribute("r",37),progressCircle.setAttribute("fill","none"),progressCircle.setAttribute("stroke",config.color),progressCircle.setAttribute("stroke-width","4"),progressCircle.setAttribute("stroke-linecap","round"),progressCircle.setAttribute("stroke-dasharray",circumference),progressCircle.setAttribute("stroke-dashoffset",strokeDashoffset),progressCircle.setAttribute("transform","rotate(-90 41 41)"),svg.appendChild(bgCircle),svg.appendChild(progressCircle),svg}(memberData.pvLevel);hpCircle&&avatarWrapper.appendChild(hpCircle)}const avatarImg=document.createElement("img");avatarImg.src=memberData.avatar,avatarImg.className="dashboard-card-avatar",avatarImg.alt=memberData.name,5===memberData.pvLevel&&(avatarImg.style.filter="grayscale(100%)",avatarImg.style.opacity="0.7"),avatarWrapper.appendChild(avatarImg),header.appendChild(avatarWrapper)}const nameContainer=document.createElement("div");if(nameContainer.className="dashboard-card-name-container",memberData.worldImage){const worldImg=document.createElement("img");worldImg.src=memberData.worldImage,worldImg.className="dashboard-card-world",worldImg.alt="World",nameContainer.appendChild(worldImg)}const nameDiv=document.createElement("div");nameDiv.className="dashboard-card-name",nameDiv.textContent=memberData.name,nameContainer.appendChild(nameDiv),header.appendChild(nameContainer),cardLink.appendChild(header);const body=document.createElement("div");if(body.className="dashboard-card-body",memberData.status){const statusDiv=document.createElement("div");statusDiv.className="dashboard-card-status",statusDiv.textContent=memberData.status,body.appendChild(statusDiv)}if(cardLink.appendChild(body),card.appendChild(cardLink),null!==memberData.hpInfo){const hpBar=document.createElement("div");hpBar.className="dashboard-card-hp";const hpFill=document.createElement("div");hpFill.className="dashboard-card-hp-fill",hpFill.style.width=memberData.hpInfo+"%",memberData.hpInfo>70?hpFill.style.backgroundColor="#5cb85c":memberData.hpInfo>30?hpFill.style.backgroundColor="#f0ad4e":hpFill.style.backgroundColor="#d9534f",hpBar.appendChild(hpFill),card.appendChild(hpBar)}if(memberData.isPNJ){const pnjBadge=document.createElement("span");pnjBadge.className="dashboard-card-pnj",pnjBadge.textContent="PNJ",card.appendChild(pnjBadge)}if(memberData.actionsDiv){const actionsWrapper=document.createElement("div");actionsWrapper.className="dashboard-card-actions",memberData.actionsDiv.querySelectorAll("a").forEach(link=>{actionsWrapper.appendChild(link.cloneNode(!0))}),card.appendChild(actionsWrapper)}return card}(member,group.isMyGroup))}),groupSection.appendChild(cardsContainer),flexContainer.appendChild(groupSection)}),dashboard.innerHTML="",dashboard.appendChild(flexContainer))}function modifyNavigationMenus(){const menuLinks={Jouer:"jouer/plateau","Règles":"regles/avancees",Monde:"monde/evenements","Communauté":"communaute/membres"};let forumOriginalItem=null;if(document.querySelectorAll(".navbar-nav .dropdown > a.dropdown-toggle").forEach(link=>{const text=link.textContent.trim().replace(/\s*\n.*$/,"");if(text.startsWith("Forum")&&!text.includes("HRP")&&!text.includes("RP"))return void(forumOriginalItem=link.closest("li.dropdown"));const menuKey=Object.keys(menuLinks).find(key=>text.includes(key));menuKey&&menuLinks[menuKey]&&(link.href=menuLinks[menuKey],link.removeAttribute("data-toggle"),link.hasAttribute("data-nav-modified")||(link.setAttribute("data-nav-modified","true"),link.addEventListener("click",function(e){return e.preventDefault(),window.location.href=this.href,!1})))}),forumOriginalItem&&!document.querySelector("[data-forums-added]")){const originalDropdown=forumOriginalItem.querySelector(".dropdown-menu"),forumRpLi=document.createElement("li");forumRpLi.className="dropdown",forumRpLi.setAttribute("data-forums-added","rp"),forumRpLi.innerHTML='\n        <a href="forum/rp" class="dropdown-toggle" role="button" aria-expanded="false" data-nav-modified="true">\n          Forum RP <span class="caret"></span>\n        </a>\n        <ul class="dropdown-menu" role="menu">\n          <li><a href="forum/rp/taverne-10101">Taverne</a></li>\n          <li><a href="forum/rp/marche-10102">Marché</a></li>\n          <li><a href="forum/rp/monde-10103">Monde</a></li>\n          <li class="divider"></li>\n          <li><a href="forum/rp">Autre</a></li>\n        </ul>\n      ';const forumHrpLi=document.createElement("li");if(forumHrpLi.className="dropdown",forumHrpLi.setAttribute("data-forums-added","hrp"),forumHrpLi.innerHTML='\n        <a href="forum/hrp" class="dropdown-toggle" role="button" aria-expanded="false" data-nav-modified="true">\n          Forum HRP <span class="caret"></span>\n        </a>\n      ',originalDropdown){const clonedDropdown=originalDropdown.cloneNode(!0),rpLink=Array.from(clonedDropdown.querySelectorAll("li > a")).find(a=>a.textContent.includes("Jeu (RP)"));rpLink&&rpLink.parentElement.remove(),forumHrpLi.appendChild(clonedDropdown)}forumOriginalItem.parentElement.insertBefore(forumRpLi,forumOriginalItem),forumOriginalItem.parentElement.insertBefore(forumHrpLi,forumOriginalItem),forumOriginalItem.remove();const forumRpLink=forumRpLi.querySelector("a.dropdown-toggle");forumRpLink&&forumRpLink.addEventListener("click",function(e){return e.preventDefault(),window.location.href=this.href,!1});const forumHrpLink=forumHrpLi.querySelector("a.dropdown-toggle");forumHrpLink&&forumHrpLink.addEventListener("click",function(e){return e.preventDefault(),window.location.href=this.href,!1})}const communauteItem=Array.from(document.querySelectorAll(".navbar-nav > li.dropdown")).find(li=>li.querySelector("a.dropdown-toggle")?.textContent.includes("Communauté"));if(communauteItem&&!document.querySelector("[data-stats-menu-added]")){const statsLi=document.createElement("li");statsLi.className="dropdown",statsLi.setAttribute("data-stats-menu-added","true"),statsLi.innerHTML='\n        <a href="monde/citoyens" class="dropdown-toggle" role="button" aria-expanded="false" data-nav-modified="true">\n          Statistiques <span class="caret"></span>\n        </a>\n        <ul class="dropdown-menu" role="menu">\n          <li><a href="communaute/stats">Communautés</a></li>\n          <li><a href="monde/citoyens">Citoyens</a></li>\n        </ul>\n      ',communauteItem.parentElement.insertBefore(statsLi,communauteItem.nextSibling);const statsLink=statsLi.querySelector("a.dropdown-toggle");statsLink&&statsLink.addEventListener("click",function(e){return e.preventDefault(),window.location.href=this.href,!1})}}function markActiveIcons(){const markers=[{text:"Membres actifs",cls:"kr-icon-members"},{text:"Personnages actifs",cls:"kr-icon-characters"},{text:"Personnes en ligne",cls:"kr-icon-online"},{text:"Présentation",cls:"kr-icon-presentation"},{text:"Médailles",cls:"kr-icon-medals"}];markers.forEach(m=>document.querySelectorAll("."+m.cls).forEach(n=>n.classList.remove(m.cls)));const all=Array.from(document.querySelectorAll("*"));markers.forEach(m=>{let best=null;for(const el of all){const txt=(el.textContent||"").trim();if(!txt.includes(m.text))continue;const score=(el.querySelector("i.fa, i.falarge, .glyphicon, svg")?100:0)+Math.max(0,200-Math.min(txt.length,200));(!best||score>best.score)&&(best={el:el,score:score})}best?.el&&best.el.classList.add(m.cls)})}function replaceMcAnchors(){Array.from(document.querySelectorAll("a")).filter(a=>"MC"===(a.textContent||"").trim()).forEach(a=>{a.classList.add("kr-mc-icon");const title=a.getAttribute("data-original-title")||a.getAttribute("title")||(a.classList.contains("open")?"ouvrir le mini-chat":"fermer le mini-chat");title&&a.setAttribute("aria-label",title),a.removeAttribute("aria-hidden")})}function replaceNavbarBrand(){const brand=document.querySelector(".navbar-brand");if(!brand)return;const variant=getVariant(),idx=CONFIG.LOGO_MAP[variant]||1,url=`http://img7.kraland.org/2/world/logo${idx}.gif`,existing=brand.querySelector("img.kr-logo");if(existing?.src?.includes(`logo${idx}.gif`))return;brand.innerHTML="";const img=document.createElement("img");img.className="kr-logo",img.src=url,img.alt="Kraland",img.style.height="28px",img.style.verticalAlign="middle",brand.appendChild(img)}function replaceSImages(){const map={"s1.gif":"♂","s2.gif":"♀","s3.gif":"⚧"};Array.from(document.querySelectorAll("img")).filter(i=>/img7\.kraland\.org\/.+\/(s[123]\.gif)$/.test(i.src)).forEach(img=>{const m=img.src.match(/(s[123]\.gif)$/),key=m?.[1],ch=map[key]||"",span=document.createElement("span");if(span.className="kr-symbol kr-symbol-"+(key||"s"),span.setAttribute("aria-hidden","true"),span.textContent=ch,img.alt){const sr=document.createElement("span");sr.className="kr-sr-only",sr.textContent=img.alt,span.appendChild(sr)}if(img.closest('[id*="sex"]')){const strong=document.createElement("strong");strong.appendChild(span),img.replaceWith(strong)}else img.replaceWith(span)})}function reorderBtnGroupXs(){document.querySelectorAll("span.btn-group-xs").forEach(btn=>{const parent=btn.parentElement;if(!parent)return;const strong=parent.querySelector("strong");if(strong&&strong.parentElement===parent&&btn.nextElementSibling!==strong)return void parent.insertBefore(btn,strong);const textNode=Array.from(parent.childNodes).find(n=>3===n.nodeType&&n.textContent?.trim().length>0);textNode&&btn.nextSibling!==textNode&&parent.insertBefore(btn,textNode)})}function ensureSexStrong(){document.querySelectorAll('[id*="ajax-sex"]').forEach(el=>{if(el.querySelector("strong"))return;const sym=el.querySelector(".kr-symbol");if(sym){const strong=document.createElement("strong");return sym.parentElement.replaceChild(strong,sym),void strong.appendChild(sym)}const tn=Array.from(el.childNodes).find(n=>3===n.nodeType&&n.textContent?.trim().length>0);if(tn){const txt=tn.textContent.trim(),strong=document.createElement("strong");strong.textContent=txt,tn.textContent=tn.textContent.replace(txt,""),tn.parentElement.insertBefore(strong,tn.nextSibling)}})}function ensureFooterSticky(){const footer=document.querySelector("footer, .footer, .contentinfo");if(!footer)return;null!==footer.nextSibling&&document.body.appendChild(footer);const selectors=['a[href="#top"]',"a.to-top",".back-to-top",".scroll-top","a.well.well-sm"];let back=null;for(const s of selectors)if(back=document.querySelector(s),back)break;if(back){back.classList.add("kraland-back-to-top"),back.getAttribute("aria-label")||back.setAttribute("aria-label","Remonter en haut");const whiteContainer=footer.querySelector(".container.white");whiteContainer?whiteContainer.appendChild(back):back.parentElement!==footer&&footer.appendChild(back)}document.body.style.marginBottom||(document.body.style.marginBottom="60px")}function relocateKramailToLeft(){const colT=document.getElementById("col-t"),colLeft=document.getElementById("col-left");if(!colT||!colLeft)return;colT.querySelectorAll('a[href*="kramail"]').forEach(a=>{const container=a.closest("div,section,li,article");container&&container!==colT&&"col-t"!==container.id?container.remove():a.remove()});const selectors=[".ds_users",".ds_characters",".ds_online"].map(c=>`a${c}`);let toMove=[];if(selectors.forEach(sel=>toMove.push(...colT.querySelectorAll(sel))),toMove.length<3&&["Membres actifs","Personnages actifs","Personnes en ligne"].forEach(txt=>{const el=Array.from(colT.querySelectorAll("a, li, div, p")).find(n=>n.textContent?.includes(txt));el&&!toMove.includes(el)&&toMove.push(el)}),toMove=toMove.filter(el=>el&&!colLeft.contains(el)),!toMove.length)return;let container=colLeft.querySelector(".kraland-metrics");container||(container=document.createElement("div"),container.className="kraland-metrics list-group",colLeft.appendChild(container)),toMove.forEach(el=>container.appendChild(el))}function restructurePlatoColumns(){if(!isPlatoPage())return;const colLeft=document.getElementById("col-left"),colRight=document.getElementById("col-right");if(!colLeft||!colRight)return;const parent=colLeft.parentElement;if(!parent?.classList.contains("row"))return;let colLeftest=document.getElementById("col-leftest");colLeftest||(colLeftest=document.createElement("div"),colLeftest.id="col-leftest",colLeftest.className="col-md-1",parent.insertBefore(colLeftest,colLeft)),colRight.classList.contains("col-md-9")&&(colRight.classList.remove("col-md-9"),colRight.classList.add("col-md-8"))}function moveBtnGroupToCols(){if(!isPlatoPage())return;const btnGroupXs=document.querySelector(".btn-group-xs.center"),colLeftest=document.getElementById("col-leftest");if(!btnGroupXs||!colLeftest||colLeftest.contains(btnGroupXs))return;let wrapper=document.getElementById("col-leftest-stats");wrapper||(wrapper=document.createElement("div"),wrapper.id="col-leftest-stats",wrapper.className="panel panel-body",colLeftest.appendChild(wrapper)),wrapper.contains(btnGroupXs)||wrapper.appendChild(btnGroupXs)}function transformToBootstrapGrid(){const colLeftestStats=document.getElementById("col-leftest-stats"),skillsPanel=document.getElementById("skills-panel");if(colLeftestStats&&!colLeftestStats.classList.contains("grid-transformed")){const btnGroup=colLeftestStats.querySelector(".btn-group-xs");if(btnGroup){const buttons=Array.from(btnGroup.querySelectorAll("a.btn"));if(buttons.length>0){colLeftestStats.innerHTML="";const row=document.createElement("div");row.className="row",buttons.forEach(btn=>{const col=document.createElement("div");col.className="col-md-6",col.style.display="flex",col.style.justifyContent="center",col.style.alignItems="center",col.style.marginBottom="8px",col.appendChild(btn),row.appendChild(col)}),colLeftestStats.appendChild(row),colLeftestStats.classList.add("grid-transformed")}}}if(skillsPanel&&!skillsPanel.classList.contains("grid-transformed")){const items=Array.from(skillsPanel.querySelectorAll("a.list-group-item"));if(items.length>0){skillsPanel.innerHTML="";const row=document.createElement("div");row.className="row",items.forEach(item=>{const col=document.createElement("div");col.className="col-md-6",col.style.display="flex",col.style.justifyContent="center",col.style.alignItems="center",col.style.marginBottom="8px",col.appendChild(item),row.appendChild(col)}),skillsPanel.appendChild(row),skillsPanel.classList.add("grid-transformed")}}}function moveSkillsPanelToCols(){const colLeft=document.getElementById("col-left"),colLeftest=document.getElementById("col-leftest");if(!colLeft||!colLeftest)return;const skillsPanelOld=colLeft.querySelector(".panel.panel-default");if(!skillsPanelOld)return;const panelBody=skillsPanelOld.querySelector(".panel-body");panelBody&&!panelBody.id&&(panelBody.id="skills-panel",colLeftest.appendChild(panelBody),skillsPanelOld.remove())}function nameLeftSidebarDivs(){const colLeft=document.getElementById("col-left");if(!colLeft)return;const mainPanel=colLeft.querySelector(".panel.panel-body");mainPanel&&!mainPanel.id&&(mainPanel.id="player-main-panel");const headerSection=colLeft.querySelector(".list-group");headerSection&&!headerSection.id&&(headerSection.id="player-header-section");const vitalsSection=colLeft.querySelector("div.t.row");vitalsSection&&!vitalsSection.id&&(vitalsSection.id="player-vitals-section");const allTDivs=Array.from(colLeft.querySelectorAll("div.t"));if(allTDivs.length>0){const actionsSection=allTDivs[allTDivs.length-1];!actionsSection.id&&actionsSection.querySelector("a.btn-primary")&&(actionsSection.id="player-actions-section")}}function transformSkillsToIcons(){const skillsPanel=document.getElementById("skills-panel");skillsPanel&&!skillsPanel.dataset.iconsTransformed&&(skillsPanel.querySelectorAll(".list-group-item").forEach(item=>{const heading=item.querySelector(".list-group-item-heading"),skillName=heading?.querySelector(".mini")?.textContent||"",level=item.querySelector(".mention")?.textContent||"0",iconCode=CONFIG.SKILL_ICONS[skillName];if(!iconCode)return;const iconUrl=`http://img7.kraland.org/2/mat/94/${iconCode}.gif`,originalClasses=item.className;item.className=originalClasses+" btn btn-default mini",item.innerHTML="";const iconContainer=function createIconContainer(iconUrl,altText,badgeText){const container=document.createElement("div");Object.assign(container.style,{position:"relative",display:"inline-block",width:"32px",height:"32px"});const img=document.createElement("img");return img.src=iconUrl,img.alt=altText,img.title=altText,Object.assign(img.style,{width:"32px",height:"32px",display:"block"}),container.appendChild(img),container.appendChild(function createBadge(text){const badge=document.createElement("span");return badge.className="badge",badge.textContent=text,Object.assign(badge.style,{position:"absolute",top:"25px",right:"-8px",backgroundColor:"#d9534f",color:"#fff",borderRadius:"50%",width:"19px",height:"19px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"bold",border:"2px solid #fff"}),badge}(badgeText)),container}(iconUrl,skillName,level);Object.assign(item.style,{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",width:"40px",height:"40px",minWidth:"40px",minHeight:"40px"}),item.appendChild(iconContainer)}),skillsPanel.dataset.iconsTransformed="1")}function transformStatsToNotifications(){const colLeftestStats=document.getElementById("col-leftest-stats");colLeftestStats&&!colLeftestStats.dataset.badgesTransformed&&(colLeftestStats.querySelectorAll(".col-md-6 > a.btn").forEach(statBtn=>{const text=statBtn.textContent.trim(),match=text.match(/^([A-Z]+)/),cleanStatName=match?match[1]:text,levelMatch=text.match(/(\d+)$/),number=levelMatch?levelMatch[1]:"0";for(;statBtn.firstChild;)statBtn.removeChild(statBtn.firstChild);const originalClasses=statBtn.className;statBtn.className=originalClasses+" list-group-item ds_game",Object.assign(statBtn.style,{padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",minWidth:"40px",minHeight:"40px"}),statBtn.title=cleanStatName;const displayMode=getStatsDisplayMode(),container=document.createElement("div");if(Object.assign(container.style,{position:"relative",display:"inline-block",width:"32px",height:"32px"}),"text"===displayMode){const textSpan=document.createElement("span");textSpan.textContent=cleanStatName.substring(0,3).toUpperCase(),Object.assign(textSpan.style,{fontWeight:"bold",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px"}),container.appendChild(textSpan)}else{const iconCode=CONFIG.STAT_ICONS[cleanStatName];if(iconCode){const iconUrl=`http://img7.kraland.org/2/mat/94/${iconCode}.gif`,img=document.createElement("img");img.src=iconUrl,img.alt=cleanStatName,img.title=cleanStatName,Object.assign(img.style,{display:"block",width:"32px",height:"32px"}),container.appendChild(img)}else{const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("width","32"),svg.setAttribute("height","32"),svg.setAttribute("viewBox","0 0 32 32"),svg.style.display="block";const rect=document.createElementNS("http://www.w3.org/2000/svg","rect");rect.setAttribute("width","32"),rect.setAttribute("height","32"),rect.setAttribute("fill","#f0f0f0"),rect.setAttribute("stroke","#ccc"),svg.appendChild(rect);const svgText=document.createElementNS("http://www.w3.org/2000/svg","text");svgText.setAttribute("x","16"),svgText.setAttribute("y","20"),svgText.setAttribute("text-anchor","middle"),svgText.setAttribute("font-size","14"),svgText.setAttribute("font-weight","bold"),svgText.setAttribute("fill","#333"),svgText.textContent=cleanStatName.substring(0,2).toUpperCase(),svg.appendChild(svgText),container.appendChild(svg)}}container.appendChild(function createStatBadge(text){const badge=document.createElement("span");return badge.className="badge",badge.textContent=text,Object.assign(badge.style,{position:"absolute",top:"25px",right:"-8px",backgroundColor:"#007bff",color:"#fff",borderRadius:"50%",width:"19px",height:"19px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"11px",fontWeight:"bold",border:"2px solid #fff"}),badge}(number)),statBtn.appendChild(container)}),colLeftestStats.dataset.badgesTransformed="1")}function ensureEditorClasses(){document.querySelectorAll(['[id^="ajax-"] form#msg','[id^="ajax-"] textarea',".col-sm-10 form#msg",".col-sm-10 textarea#message",'form[name="post_msg"]',"textarea#message"].join(",")).forEach(el=>{const root="form"===el.tagName?.toLowerCase()?el:el.closest("form")||el.parentElement;root&&!root.classList.contains("editeur-text")&&root.classList.add("editeur-text")})}function ensurePageScoping(){const isMembers=0===location?.pathname?.indexOf("/communaute/membres");document.documentElement.classList.toggle("kr-page-members",isMembers)}function ensurePlayerMainPanelRows(){const panel=document.getElementById("player-main-panel");panel&&Array.from(panel.children).filter(child=>"div"===child.tagName?.toLowerCase()).filter(div=>!div.classList.contains("kr-quick-access-buttons")).forEach(div=>{div.classList.contains("row")||div.classList.add("row")})}function addQuickAccessButtons(){const panel=document.getElementById("player-main-panel");if(!panel)return;if(panel.querySelector(".kr-quick-access-buttons"))return;const container=document.createElement("div");container.className="kr-quick-access-buttons",container.style.marginTop="10px";const row=document.createElement("div");row.className="row",[{label:"Agir",url:"/jouer/plateau",icon:"fa-map"},{label:"Matériel",url:"/jouer/materiel",icon:"fa-box"},{label:"Personnage",url:"/jouer/perso",icon:"fa-user"},{label:"Bâtiments",url:"/jouer/bat",icon:"fa-building"},{label:"Employés",url:"/jouer/pnj",icon:"fa-users"}].forEach(btn=>{const col=document.createElement("div");col.className="col-xs-6 col-sm-6";const link=document.createElement("a");link.href=btn.url,link.className="btn btn-default btn-block mini";const icon=document.createElement("i");icon.className=`fa ${btn.icon}`,link.appendChild(icon),link.appendChild(document.createTextNode(" "+btn.label)),col.appendChild(link),row.appendChild(col)}),container.appendChild(row),panel.appendChild(container)}function insertToggleCSSButton(){if(document.getElementById("kr-toggle-css-btn"))return;const mapBtn=Array.from(document.querySelectorAll("a")).find(a=>a.getAttribute("onclick")?.includes("openMap"));if(!mapBtn)return;const mapLi=mapBtn.closest("li");if(!mapLi?.parentElement)return;const newLi=document.createElement("li"),toggleBtn=document.createElement("a");toggleBtn.href="",toggleBtn.id="kr-toggle-css-btn",toggleBtn.innerHTML='<i class="fa fa-palette"></i>',function updateTitle(){toggleBtn.title=isThemeEnabled()?"Désactiver la surcharge CSS":"Activer la surcharge CSS"}(),toggleBtn.addEventListener("click",e=>(e.preventDefault(),isThemeEnabled()?applyThemeVariant("disable"):applyThemeVariant(getVariant()),!1)),newLi.appendChild(toggleBtn),mapLi.parentElement.insertBefore(newLi,mapLi)}function insertTampermonkeyThemeUI(){if(location?.href?.includes("/profil/interface")&&!tryInsert()){let attempts=0;const id=setInterval(()=>{attempts++,(tryInsert()||attempts>25)&&clearInterval(id)},200)}function tryInsert(){const target=Array.from(document.querySelectorAll("h4, h3, h2")).find(h=>h.textContent?.trim().toLowerCase().includes("thème de base"));if(!target)return!1;if(document.getElementById("kr-tamper-theme"))return!0;const radios=[{value:"disable",flag:"f0",label:"Désactiver la surcharge CSS"},{value:"kraland",flag:"f1",label:"République de Kraland"},{value:"empire-brun",flag:"f2",label:"Empire Brun"},{value:"empire-brun-dark",flag:"f2",label:"Empire Brun (Dark Mode)"},{value:"paladium",flag:"f3",label:"Paladium Corporation"},{value:"paladium-dark",flag:"f3",label:"Paladium Corporation (Dark Mode)"},{value:"theocratie-seelienne",flag:"f4",label:"Théocratie Seelienne"},{value:"theocratie-seelienne-dark",flag:"f4",label:"Théocratie Seelienne (Dark Mode)"},{value:"paradigme-vert",flag:"f5",label:"Paradigme Vert"},{value:"paradigme-vert-dark",flag:"f5",label:"Paradigme Vert (Dark Mode)"},{value:"khanat-elmerien",flag:"f6",label:"Khanat Elmérien"},{value:"khanat-elmerien-dark",flag:"f6",label:"Khanat Elmérien (Dark Mode)"},{value:"confederation-libre",flag:"f7",label:"Confédération Libre"},{value:"confederation-libre-dark",flag:"f7",label:"Confédération Libre (Dark Mode)"},{value:"royaume-ruthvenie",flag:"f8",label:"Royaume de Ruthvénie"},{value:"royaume-ruthvenie-dark",flag:"f8",label:"Royaume de Ruthvénie (Dark Mode)"}].map(opt=>`\n        <div class="radio">\n          <span class="lefticon"><img src="http://img7.kraland.org/2/world/${opt.flag}.png" width="15" height="10"></span>\n          <label><input type="radio" name="kr-theme" value="${opt.value}"> ${opt.label}</label>\n        </div>\n      `).join(""),container=document.createElement("div");container.id="kr-tamper-theme",container.className="well kr-tamper-theme",container.innerHTML=`\n        <h4>Thème Tampermonkey (Activez le thème de base officiel pour éviter les conflits)</h4>\n        <form id="kr-tamper-theme-form" class="form-horizontal">\n          <div class="form-group">\n            <label class="col-sm-3 control-label">Choix du thème</label>\n            <div class="col-sm-9">${radios}</div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-3 control-label">Affichage des caractéristiques</label>\n            <div class="col-sm-9">\n        <div class="radio">\n          <label><input type="radio" name="kr-stats-display" value="icon"> Icônes</label>\n        </div>\n        <div class="radio">\n          <label><input type="radio" name="kr-stats-display" value="text"> Texte</label>\n        </div>\n      </div>\n          </div>\n          <div class="form-group">\n            <label class="col-sm-3 control-label">Options du footer</label>\n            <div class="col-sm-9">\n        <div class="checkbox">\n          <label><input type="checkbox" name="kr-hide-quote" id="kr-hide-quote"> Masquer la citation du footer</label>\n        </div>\n      </div>\n          </div>\n        </form>\n      `,target.parentElement.insertBefore(container,target);const form=container.querySelector("#kr-tamper-theme-form");return form.addEventListener("change",e=>{if("kr-theme"===e.target.name){const sel=form.querySelector('input[name="kr-theme"]:checked');if(!sel)return;const val=sel.value,feedback=document.createElement("div");feedback.className="alert alert-success",feedback.textContent="disable"===val?"Désactivation du thème...":"Application du thème: "+val,container.appendChild(feedback),setTimeout(()=>applyThemeVariant(val),300)}if("kr-stats-display"===e.target.name){const sel=form.querySelector('input[name="kr-stats-display"]:checked');if(!sel)return;const val=sel.value;localStorage.setItem(CONFIG.STATS_DISPLAY_KEY,val);const feedback=document.createElement("div");feedback.className="alert alert-success",feedback.textContent="icon"===val?"Affichage en icônes activé. Rechargez la page pour voir les changements.":"Affichage en texte activé. Rechargez la page pour voir les changements.",container.appendChild(feedback),setTimeout(()=>{feedback.remove()},5e3)}if("kr-hide-quote"===e.target.name){const isChecked=e.target.checked;localStorage.setItem("kr-hide-footer-quote",isChecked.toString()),isChecked?document.documentElement.classList.add("kr-hide-footer-quote"):document.documentElement.classList.remove("kr-hide-footer-quote");const feedback=document.createElement("div");feedback.className="alert alert-success",feedback.textContent=isChecked?"Citation du footer masquée.":"Citation du footer affichée.",container.appendChild(feedback),setTimeout(()=>{feedback.remove()},3e3)}}),function syncUI(){if(isThemeEnabled()){const v=getVariant(),el=form.querySelector(`input[value="${v}"]`);el&&(el.checked=!0)}else{const d=form.querySelector('input[value="disable"]');d&&(d.checked=!0)}const statsMode=getStatsDisplayMode(),statsEl=form.querySelector(`input[name="kr-stats-display"][value="${statsMode}"]`);statsEl&&(statsEl.checked=!0);const hideQuote="true"===localStorage.getItem("kr-hide-footer-quote"),hideQuoteEl=form.querySelector("#kr-hide-quote");hideQuoteEl&&(hideQuoteEl.checked=hideQuote)}(),!0}}function initCharacterModalMobile(){new MutationObserver(mutations=>{mutations.forEach(mutation=>{mutation.addedNodes.forEach(node=>{1===node.nodeType&&node.classList?.contains("bootbox")&&setTimeout(()=>{!function enhanceCharacterModal(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;(function transformOrderModalStructure(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;if(modal.dataset.structureTransformed)return;console.log("[Order Modal] Optimisation structure mobile");const modalBody=modal.querySelector(".bootbox-body, .modal-body");if(!modalBody)return;const selectRow=modalBody.querySelector(".row"),h3Title=modalBody.querySelector("h3");selectRow&&h3Title&&(selectRow.classList.add("kraland-modal-header"),h3Title.classList.add("kraland-character-title"),console.log("[Order Modal] Header marqué"));const panelWithTabs=modalBody.querySelector(".panel.with-nav-tabs");if(panelWithTabs){const panelHeading=panelWithTabs.querySelector(".panel-heading");panelHeading&&(panelHeading.classList.add("kraland-actions-zone"),console.log("[Order Modal] Zone actions identifiée"));const panelBody=panelWithTabs.querySelector(".panel-body.panel-order");panelBody&&(panelBody.classList.add("kraland-form-zone"),console.log("[Order Modal] Zone formulaire identifiée"));const panelFooter=panelWithTabs.querySelector(".panel-footer");panelFooter&&(panelFooter.classList.add("kraland-action-footer"),console.log("[Order Modal] Footer action identifié"))}const modalFooter=modal.querySelector(".modal-footer");modalFooter&&(modalFooter.classList.add("kraland-modal-footer"),console.log("[Order Modal] Footer modal identifié"));const panelInfo=modalBody.querySelector(".panel-info");panelInfo&&(panelInfo.querySelectorAll(".row").forEach(row=>{row.style.marginLeft="",row.style.marginRight=""}),panelInfo.querySelectorAll('[class*="col-"]').forEach(col=>{col.style.paddingLeft="",col.style.paddingRight=""}),console.log("[Order Modal] Styles inline nettoyés du panel-info")),modal.dataset.structureTransformed="true",console.log("[Order Modal] Structure optimisée pour mobile")})(modal),function fixDropdownPosition(modal){if(!modal)return;const dropdownObserver=new MutationObserver(mutations=>{mutations.forEach(mutation=>{if("attributes"===mutation.type&&"class"===mutation.attributeName){const dropdown=mutation.target;if(dropdown.classList.contains("dropdown")&&dropdown.classList.contains("open")){const dropdownMenu=dropdown.querySelector(".dropdown-menu");dropdownMenu&&(dropdownMenu.style.setProperty("position","absolute","important"),dropdownMenu.style.setProperty("bottom","100%","important"),dropdownMenu.style.setProperty("top","auto","important"),dropdownMenu.style.setProperty("left","0","important"),dropdownMenu.style.setProperty("margin-bottom","4px","important"),dropdownMenu.style.setProperty("z-index","10000","important"),console.log("[Order Modal] Dropdown position forcée à absolute"))}}})}),toolbar=modal.querySelector(".btn-toolbar");if(toolbar){const dropdowns=toolbar.querySelectorAll(".dropdown");dropdowns.forEach(dropdown=>{dropdownObserver.observe(dropdown,{attributes:!0,attributeFilter:["class"]})}),console.log(`[Order Modal] Observateur dropdown installé sur ${dropdowns.length} dropdowns`)}}(modal),cleanToolbarWhitespace(modal),function makeAlertCollapsible(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;const alert=modal.querySelector(".alert");if(!alert)return;const toggleBtn=document.createElement("button");toggleBtn.type="button",toggleBtn.className="kr-alert-toggle",toggleBtn.innerHTML='<i class="fas fa-question-circle"></i> Aide',toggleBtn.setAttribute("aria-expanded","false"),toggleBtn.setAttribute("aria-label","Afficher/masquer l'aide");const alertContent=document.createElement("div");for(alertContent.className="kr-alert-content",alertContent.style.display="none";alert.firstChild;)alertContent.appendChild(alert.firstChild);alert.appendChild(toggleBtn),alert.appendChild(alertContent),alert.classList.add("kr-alert-collapsible"),toggleBtn.addEventListener("click",function(){const isExpanded="none"!==alertContent.style.display;alertContent.style.display=isExpanded?"none":"block",toggleBtn.setAttribute("aria-expanded",!isExpanded),toggleBtn.innerHTML=isExpanded?'<i class="fas fa-question-circle"></i> Aide':'<i class="fas fa-times-circle"></i> Masquer l\'aide'}),console.log("[Order Modal] Alerte rendue repliable")}(modal),function enhanceNavTabsFeedback(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;modal.querySelectorAll(".nav.nav-tabs li a").forEach(link=>{link.classList.add("kr-touch-feedback"),link.addEventListener("click",function(){modal.querySelectorAll(".nav.nav-tabs li").forEach(li=>li.classList.remove("active")),this.parentElement.classList.add("active")})}),console.log("[Order Modal] Feedback tactile ajouté aux nav-tabs")}(modal),function enlargeTextarea(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;const textarea=modal.querySelector("textarea#message");textarea&&(textarea.rows=8,textarea.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),console.log("[Order Modal] Textarea agrandi (8 rows + auto-resize)"))}(modal),function formatFooterAsBadges(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;const actionFooter=modal.querySelector(".kraland-action-footer p");if(!actionFooter)return;const text=actionFooter.textContent,costMatch=text.match(/Coût:\s*([^|]+)/),durationMatch=text.match(/Durée:\s*([^|]+)/),potentialMatch=text.match(/Potentiel:\s*(.+)$/);if(!costMatch&&!durationMatch&&!potentialMatch)return;const badgesHTML=`\n      <div class="kr-action-badges">\n        ${costMatch?`<span class="kr-badge kr-badge-cost"><i class="fas fa-coins"></i> ${costMatch[1].trim()}</span>`:""}\n        ${durationMatch?`<span class="kr-badge kr-badge-duration"><i class="far fa-clock"></i> ${durationMatch[1].trim()}</span>`:""}\n        ${potentialMatch?`<span class="kr-badge kr-badge-potential"><i class="fas fa-dice-d20"></i> ${potentialMatch[1].trim()}</span>`:""}\n      </div>\n    `;actionFooter.innerHTML=badgesHTML,console.log("[Order Modal] Footer formaté en badges")}(modal),function enhanceOkButton(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;const modalFooter=modal.querySelector(".kraland-modal-footer");if(!modalFooter)return;const okButton=modalFooter.querySelector(".btn-primary"),cancelButton=modalFooter.querySelector(".btn-default");okButton&&okButton.classList.add("kr-btn-primary-enhanced"),cancelButton&&cancelButton.classList.add("kr-btn-secondary-subtle"),console.log("[Order Modal] Boutons OK/Cancel améliorés")}(modal),function groupSelectOptions(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;const select=modal.querySelector(".kraland-modal-header select");if(!select)return;const options=Array.from(select.options);if(0===options.length)return;const pjOptions=[],pnjOptions=[];if(options.forEach(option=>{const text=option.textContent;text.includes("PNJ")||text.includes("[")||text.match(/\d+ /)||text.includes("Garde")||text.includes("Esclave")?pnjOptions.push(option):pjOptions.push(option)}),0!==pjOptions.length&&0!==pnjOptions.length){if(select.innerHTML="",pjOptions.length>0){const pjGroup=document.createElement("optgroup");pjGroup.label="Personnages Joueurs",pjOptions.forEach(opt=>pjGroup.appendChild(opt)),select.appendChild(pjGroup)}if(pnjOptions.length>0){const pnjGroup=document.createElement("optgroup");pnjGroup.label="Personnages Non-Joueurs",pnjOptions.forEach(opt=>pnjGroup.appendChild(opt)),select.appendChild(pnjGroup)}console.log(`[Order Modal] Select groupé (${pjOptions.length} PJ, ${pnjOptions.length} PNJ)`)}}(modal),forceOrderModalGridLayout(modal);const modalBody=modal.querySelector(".bootbox-body, .modal-body");modalBody&&(new MutationObserver(()=>{console.log("[Order Modal] Contenu Ajax détecté - réapplication du grid"),forceOrderModalGridLayout(modal),cleanToolbarWhitespace(modal)}).observe(modalBody,{childList:!0,subtree:!0}),console.log("[Order Modal] Observer Ajax installé sur modal body")),function mergeColumnsInMobile(modal){if(!modal)return;modal.querySelectorAll(".panel-info, .panel-primary, .panel-default").forEach(panel=>{panel.querySelectorAll(".panel-heading .row, .panel-body .row, .panel-actions .row, .panel-footer .row").forEach(row=>{const columns=row.querySelectorAll('[class*="col-"]');if(columns.length>0){const contents=[];columns.forEach(col=>{const text=col.textContent.trim(),html=col.innerHTML.trim();col.children.length>0?contents.push(html):text&&contents.push(text)});const mergedDiv=document.createElement("div");mergedDiv.className="col-xs-12 merged-columns",mergedDiv.innerHTML=contents.join(" "),columns.forEach(col=>col.remove()),row.appendChild(mergedDiv)}})})}(modal);const charSelect=modal.querySelector('select[onchange*="perso"]');charSelect&&function createCharacterCarousel(modal,select){const options=Array.from(select.options);if(options.length<=1)return;const currentIndex=select.selectedIndex,carouselWrapper=document.createElement("div");carouselWrapper.className="kr-char-selector";const prevBtn=document.createElement("button");prevBtn.type="button",prevBtn.className="kr-char-nav-btn",prevBtn.innerHTML="‹",prevBtn.disabled=0===currentIndex,prevBtn.setAttribute("aria-label","Personnage précédent");const currentDisplay=document.createElement("div");currentDisplay.className="kr-selector-current";const currentAvatar=document.createElement("img");currentAvatar.src=modal.querySelector(".modal-header img")?.src||"",currentAvatar.alt="Avatar";const currentName=document.createElement("span");currentName.className="kr-selector-current-name",currentName.textContent=options[currentIndex].text;const currentCount=document.createElement("span");currentCount.className="kr-selector-current-count",currentCount.textContent=`${currentIndex+1}/${options.length}`,currentDisplay.appendChild(currentAvatar),currentDisplay.appendChild(currentName),currentDisplay.appendChild(currentCount);const nextBtn=document.createElement("button");nextBtn.type="button",nextBtn.className="kr-char-nav-btn",nextBtn.innerHTML="›",nextBtn.disabled=currentIndex===options.length-1,nextBtn.setAttribute("aria-label","Personnage suivant"),carouselWrapper.appendChild(prevBtn),carouselWrapper.appendChild(currentDisplay),carouselWrapper.appendChild(nextBtn),select.parentNode.insertBefore(carouselWrapper,select.nextSibling),prevBtn.addEventListener("click",()=>{select.selectedIndex>0&&(select.selectedIndex--,select.dispatchEvent(new Event("change")))}),nextBtn.addEventListener("click",()=>{select.selectedIndex<options.length-1&&(select.selectedIndex++,select.dispatchEvent(new Event("change")))})}(modal,charSelect),function makeDescriptionCollapsible(modal){const header=modal.querySelector(".modal-header");if(!header)return;const headerDiv=header.querySelector("div");if(!headerDiv)return;const textNodes=Array.from(headerDiv.childNodes).filter(node=>node.nodeType===Node.TEXT_NODE&&node.textContent.trim());if(0===textNodes.length)return;const descWrapper=document.createElement("div");if(descWrapper.className="kr-char-description collapsed",textNodes.slice(1).forEach(node=>{descWrapper.appendChild(node.cloneNode(!0)),node.remove()}),descWrapper.textContent.trim()){headerDiv.appendChild(descWrapper);const toggleBtn=document.createElement("button");toggleBtn.type="button",toggleBtn.className="kr-char-expand-btn",toggleBtn.innerHTML="▼",toggleBtn.setAttribute("aria-label","Afficher/masquer description"),toggleBtn.setAttribute("aria-expanded","false"),header.appendChild(toggleBtn),toggleBtn.addEventListener("click",()=>{descWrapper.classList.contains("collapsed")?(descWrapper.classList.remove("collapsed"),descWrapper.classList.add("expanded"),toggleBtn.classList.add("expanded"),toggleBtn.setAttribute("aria-expanded","true")):(descWrapper.classList.remove("expanded"),descWrapper.classList.add("collapsed"),toggleBtn.classList.remove("expanded"),toggleBtn.setAttribute("aria-expanded","false"))})}}(modal),function enhanceTabsWithSwipe(modal){const tabsContainer=modal.querySelector(".nav-tabs");if(!tabsContainer)return;const tabs=Array.from(tabsContainer.querySelectorAll("li"));if(0===tabs.length)return;const dotsContainer=document.createElement("div");dotsContainer.className="kr-tabs-indicator",tabs.forEach((tab,_index)=>{const dot=document.createElement("span");dot.className="kr-tab-dot",tab.classList.contains("active")&&dot.classList.add("active"),dotsContainer.appendChild(dot)}),tabsContainer.parentNode.insertBefore(dotsContainer,tabsContainer.nextSibling);const tabObserver=new MutationObserver(()=>{const activeDot=tabs.findIndex(tab=>tab.classList.contains("active"));dotsContainer.querySelectorAll(".kr-tab-dot").forEach((dot,idx)=>{dot.classList.toggle("active",idx===activeDot)})});tabs.forEach(tab=>{tabObserver.observe(tab,{attributes:!0,attributeFilter:["class"]})});let touchStartX=0,touchEndX=0;tabsContainer.addEventListener("touchstart",e=>{touchStartX=e.changedTouches[0].screenX},{passive:!0}),tabsContainer.addEventListener("touchend",e=>{touchEndX=e.changedTouches[0].screenX,function handleSwipe(){const diff=touchStartX-touchEndX;if(Math.abs(diff)<50)return;const activeIndex=tabs.findIndex(tab=>tab.classList.contains("active"));diff>0&&activeIndex<tabs.length-1?tabs[activeIndex+1].querySelector("a")?.click():diff<0&&activeIndex>0&&tabs[activeIndex-1].querySelector("a")?.click()}()},{passive:!0});const scrollToActiveTab=()=>{const currentModal=tabsContainer.closest(".bootbox.modal"),allNavTabs=currentModal?.querySelectorAll(".nav-tabs")||[tabsContainer];let activeTab=null;for(const navTab of allNavTabs)if(activeTab=navTab.querySelector("li.active"),activeTab){activeTab.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"});break}};setTimeout(scrollToActiveTab,100);const parentModal=tabsContainer.closest(".bootbox.modal");(parentModal?.querySelectorAll(".nav-tabs")||[tabsContainer]).forEach(navTab=>{Array.from(navTab.querySelectorAll("li")).forEach(tab=>{tab.querySelector("a")?.addEventListener("click",()=>{setTimeout(scrollToActiveTab,100)})})})}(modal),function addCharCounterToTextareas(modal){modal.querySelectorAll("textarea").forEach(textarea=>{const maxLength=textarea.getAttribute("maxlength");if(!maxLength)return;const counter=document.createElement("div");counter.className="kr-char-counter";const updateCounter=()=>{const remaining=maxLength-textarea.value.length;counter.textContent=`${remaining} caractères restants`,counter.classList.remove("warning","error"),remaining<=0?counter.classList.add("error"):remaining<=20&&counter.classList.add("warning")};textarea.parentNode.insertBefore(counter,textarea.nextSibling),textarea.addEventListener("input",updateCounter),updateCounter()})}(modal),function addTouchFeedback(modal){modal.querySelectorAll(".kr-char-nav-btn, .kr-char-expand-btn, .nav-tabs a, .btn, .radio label").forEach(el=>{el.classList.add("kr-touch-feedback"),el.addEventListener("touchstart",()=>{el.classList.add("active"),navigator.vibrate&&navigator.vibrate(10)},{passive:!0}),el.addEventListener("touchend",()=>{setTimeout(()=>{el.classList.remove("active")},600)},{passive:!0}),el.addEventListener("touchcancel",()=>{el.classList.remove("active")},{passive:!0})})}(modal)}(node)},150)})})}).observe(document.body,{childList:!0,subtree:!1})}function forceOrderModalGridLayout(modal){if(!modal)return;if(!modal.classList.contains("bootbox-confirm"))return;const panelHeading=modal.querySelector(".panel-heading");panelHeading&&panelHeading.style.setProperty("display","block","important");const navTabsElements=modal.querySelectorAll(".panel-heading ul.nav-tabs");0!==navTabsElements.length&&(console.log("[Order Modal] Forçage du layout grid pour",navTabsElements.length,"nav-tabs"),navTabsElements.forEach((ul,index)=>{ul.style.setProperty("display","grid","important"),ul.style.setProperty("grid-template-columns","repeat(2, 1fr)","important"),ul.style.setProperty("gap","12px","important"),ul.style.setProperty("padding-left","0","important"),ul.style.setProperty("justify-items","start","important"),ul.style.setProperty("align-items","stretch","important"),ul.style.setProperty("margin-bottom","12px","important"),ul.style.setProperty("border-bottom","none","important"),ul.style.setProperty("border-top","none","important"),ul.style.setProperty("padding-top","0","important");let styleId="grid-pseudo-fix-"+index,styleEl=document.getElementById(styleId);styleEl||(styleEl=document.createElement("style"),styleEl.id=styleId,document.head.appendChild(styleEl)),ul.id||(ul.id="order-modal-nav-"+index),styleEl.textContent=`\n        #${ul.id}::before,\n        #${ul.id}::after {\n          display: none !important;\n          content: none !important;\n        }\n      `;const listItems=ul.querySelectorAll("li");listItems.forEach(li=>{li.style.setProperty("margin","0","important"),li.style.setProperty("padding","0","important"),li.style.setProperty("float","none","important"),li.style.setProperty("display","block","important"),li.style.setProperty("position","static","important"),li.style.setProperty("width","100%","important"),li.style.setProperty("grid-column","auto","important"),li.style.setProperty("grid-row","auto","important"),li.style.setProperty("justify-self","stretch","important"),li.style.setProperty("align-self","stretch","important");const link=li.querySelector("a");link&&(link.style.setProperty("display","block","important"),link.style.setProperty("width","100%","important"),link.style.setProperty("min-height","44px","important"),link.style.setProperty("padding","12px 16px","important"),link.style.setProperty("text-align","center","important"),link.style.setProperty("border-radius","8px","important"),link.style.setProperty("margin","0","important"),link.style.setProperty("box-sizing","border-box","important"))}),console.log(`[Order Modal] Grid appliqué sur nav-tabs #${index+1} (${listItems.length} items)`)}),setTimeout(()=>{navTabsElements.forEach(ul=>{ul.style.setProperty("display","grid","important")})},100))}function cleanToolbarWhitespace(modal){if(!modal)return;if(!document.body.classList.contains("mobile-mode"))return;const toolbar=modal.querySelector(".btn-toolbar");toolbar&&(Array.from(toolbar.childNodes).forEach(node=>{node.nodeType===Node.TEXT_NODE&&/^\s*$/.test(node.textContent)&&toolbar.removeChild(node)}),toolbar.style.setProperty("display","grid","important"),toolbar.style.setProperty("grid-template-columns","repeat(6, 1fr)","important"),toolbar.style.setProperty("gap","4px","important"),toolbar.querySelectorAll(".btn-group, .dropdown, span.dropdown").forEach(wrapper=>{wrapper.style.setProperty("display","contents","important")}),toolbar.querySelectorAll(".btn, span.dropdown > a > .btn, .dropdown > a > .btn, span.dropdown button, .dropdown button").forEach(btn=>{btn.style.setProperty("width","100%","important"),btn.style.setProperty("min-width","0","important"),btn.style.setProperty("max-width","none","important")}),console.log("[Order Modal] Toolbar grid forcé et whitespace nettoyé"))}function handleDualLapClock(){const clockEl=document.querySelector(".c100");if(!clockEl)return;const timeSpan=clockEl.querySelector("span");if(!timeSpan)return;const match=timeSpan.textContent.trim().match(/^(\d{1,2}):(\d{2})$/);if(!match)return;const hours=parseInt(match[1],10),minutes=parseInt(match[2],10);let clockColor;if(clockColor=hours>=24?"#32CD32":hours>=18?"#90EE90":hours>=12?"#FFD700":hours>=6?"#FF8C00":"#8B0000",clockEl.style.setProperty("--clock-color",clockColor),hours>=24){clockEl.setAttribute("data-second-lap","true");const hoursInSecondLap=hours-24,percentInSecondLap=Math.floor((60*hoursInSecondLap+minutes)/1440*100);clockEl.className=clockEl.className.replace(/\bp\d{1,3}\b/g,""),clockEl.className+=" p"+percentInSecondLap}else clockEl.removeAttribute("data-second-lap")}!function injectCSSImmediately(){try{if(!isThemeEnabled())return;const st=document.createElement("style");st.id=CONFIG.STYLE_ID,st.textContent=CONFIG.BUNDLED_CSS,(document.head||document.documentElement).appendChild(st);const variant=getVariant();document.documentElement.classList.add("kr-theme-enabled","kr-theme-variant-"+variant),"high-contrast"===variant&&document.documentElement.classList.add("kr-theme-high-contrast")}catch(e){console.error("CSS injection failed",e)}}(),async function init(){try{const themeEnabled=function getThemeState(){return null===localStorage.getItem(CONFIG.ENABLE_KEY)&&localStorage.setItem(CONFIG.ENABLE_KEY,"false"),isThemeEnabled()}(),existingStyle=document.getElementById(CONFIG.STYLE_ID);!themeEnabled&&existingStyle?.parentElement&&existingStyle.parentElement.removeChild(existingStyle),safeCall(insertToggleCSSButton),safeCall(insertTampermonkeyThemeUI),themeEnabled&&(await ensureTheme(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",applyDOMTransformations,{once:!0}):applyDOMTransformations()),function startObservers(){let domTransformationsApplied=!1;new MutationObserver(()=>{isThemeEnabled()&&(document.getElementById(CONFIG.STYLE_ID)||applyThemeInline(CONFIG.BUNDLED_CSS).catch(()=>{}),domTransformationsApplied||(applyDOMTransformations(),domTransformationsApplied=!0)),safeCall(insertToggleCSSButton)}).observe(document.documentElement||document,{childList:!0,subtree:!0});const wrap=orig=>function(){const ret=orig.apply(this,arguments);return setTimeout(()=>ensureTheme(),250),ret};history.pushState=wrap(history.pushState),history.replaceState=wrap(history.replaceState),window.addEventListener("popstate",()=>setTimeout(()=>ensureTheme(),250))}(),function enableModalBackdropClick(){let scrollBeforeModal={x:0,y:0};new MutationObserver(mutations=>{mutations.forEach(mutation=>{mutation.addedNodes.forEach(node=>{1===node.nodeType&&node.classList?.contains("bootbox")&&(scrollBeforeModal.x=window.scrollX,scrollBeforeModal.y=window.scrollY,setTimeout(()=>{const modalData=$(node).data("bs.modal");modalData&&"static"===modalData.options.backdrop&&(modalData.options.backdrop=!0,$(node).off("click.dismiss.bs.modal").on("click.dismiss.bs.modal",function(e){e.target===this&&$(this).modal("hide")})),window.scrollTo(scrollBeforeModal.x,scrollBeforeModal.y)},100),$(node).one("shown.bs.modal",function(){window.scrollTo(scrollBeforeModal.x,scrollBeforeModal.y)}))})})}).observe(document.body,{childList:!0,subtree:!1})}(),initCharacterModalMobile(),function initMobileFeatures(){const isMobile=window.innerWidth<768;if(!isMobile)return;let resizeTimer;!function createMobileOverlay(){if(document.querySelector(".kr-mobile-overlay"))return;const overlay=document.createElement("div");overlay.className="kr-mobile-overlay",overlay.addEventListener("click",()=>{const skillsPanel=document.getElementById("skills-panel");skillsPanel&&skillsPanel.classList.remove("mobile-open");const miniChat=document.getElementById("flap");miniChat&&miniChat.classList.remove("mobile-open"),overlay.classList.remove("active")}),document.body.appendChild(overlay)}(),function initMobileSkillsPanel(){if(!isPlatoPage())return;const skillsPanel=document.getElementById("skills-panel");if(!skillsPanel)return;const skillsToggle=document.createElement("button");skillsToggle.className="kr-mobile-skills-toggle btn btn-primary",skillsToggle.innerHTML='<i class="fa fa-chart-bar"></i>',skillsToggle.setAttribute("aria-label","Afficher les compétences"),skillsToggle.onclick=()=>{skillsPanel.classList.toggle("mobile-open");const overlay=document.querySelector(".kr-mobile-overlay");overlay&&overlay.classList.toggle("active")},document.body.appendChild(skillsToggle);const closeBtn=document.createElement("button");closeBtn.className="kr-mobile-close",closeBtn.innerHTML="×",closeBtn.setAttribute("aria-label","Fermer"),closeBtn.onclick=()=>{skillsPanel.classList.remove("mobile-open");const overlay=document.querySelector(".kr-mobile-overlay");overlay&&overlay.classList.remove("active")},skillsPanel.insertBefore(closeBtn,skillsPanel.firstChild)}(),function initMobileMiniChat(){const miniChat=document.getElementById("flap");if(!miniChat)return;const chatButton=document.querySelector('a[href*="#flap"]');if(chatButton&&chatButton.addEventListener("click",e=>{e.preventDefault(),miniChat.classList.toggle("mobile-open");const overlay=document.querySelector(".kr-mobile-overlay");overlay&&overlay.classList.toggle("active")}),!miniChat.querySelector(".kr-mobile-close")){const closeBtn=document.createElement("button");closeBtn.className="kr-mobile-close",closeBtn.innerHTML="×",closeBtn.setAttribute("aria-label","Fermer le mini-chat"),closeBtn.onclick=()=>{miniChat.classList.remove("mobile-open");const overlay=document.querySelector(".kr-mobile-overlay");overlay&&overlay.classList.remove("active")};const chatHeader=miniChat.querySelector(".panel-heading")||miniChat.querySelector(".modal-header")||miniChat.firstElementChild;chatHeader?(chatHeader.style.position="relative",chatHeader.appendChild(closeBtn)):miniChat.insertBefore(closeBtn,miniChat.firstChild)}}(),initCharacterModalMobile(),function initModalTabScroll(){new MutationObserver(mutations=>{mutations.forEach(mutation=>{const modal=mutation.target.closest(".bootbox.modal");if(!modal)return;const panelHeading=modal.querySelector(".panel.with-nav-tabs .panel-heading");if(!panelHeading)return;const activeTab=panelHeading.querySelector(".nav-tabs > li.active");activeTab&&setTimeout(()=>{const tabRect=activeTab.getBoundingClientRect(),containerRect=panelHeading.getBoundingClientRect(),scrollLeft=activeTab.offsetLeft-containerRect.width/2+tabRect.width/2;panelHeading.scrollTo({left:Math.max(0,scrollLeft),behavior:"smooth"})},100)})}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class"]})}(),window.addEventListener("resize",()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout(()=>{window.innerWidth<768!==isMobile&&location.reload()},250)})}(),setTimeout(()=>{const st=document.getElementById(CONFIG.STYLE_ID);isThemeEnabled()&&st?.parentElement?st.parentElement.appendChild(st):!isThemeEnabled()&&st?.parentElement&&st.parentElement.removeChild(st)},1e3),setInterval(disableTooltips,2e3)}catch(e){console.error("Kraland theme init failed",e)}}()}();